(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[58],{"572d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("OrderNewGlobal",t._b({attrs:{seat:t.seat,type:t.type}},"OrderNewGlobal",t.$attrs,!1)),a("q-dialog",{attrs:{value:t.m_show,persistent:""}},[a("MenuSelect",{style:t.popup_width,attrs:{type:t.type}})],1)],1)},i=[],n=a("fdfe"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{attrs:{flat:"",square:""}},[!t.seat||t.tab&&"seating"!==t.tab?a("q-card-section",{staticClass:"q-px-none"},[t.quick?[a("QuickOrder",{attrs:{items:t.params.items,price_list:t.params.price_list},on:{item:t.item,done:function(e){t.tab="proceed"}}})]:[a("FilterInputText",{staticClass:"q-mb-xs",attrs:{autofocus:""},on:{text:function(e){t.item_filter=e}}}),a("GroupItemsSelect",{attrs:{selected:t.active_group,filter:t.item_filter,price_list:t.params.price_list,type:t.params.type,item_quantities:t.item_quantities},on:{item:t.item,quantity:t.setQuantity,proceed:function(e){t.tab="proceed"}}})]],2):a("q-card-section",{staticClass:"q-px-none"},[a("SeatSelect",{on:{selected:t.seating}})],1),t.quick?t._e():[a("q-tabs",{staticClass:"fixed-bottom bg-primary",staticStyle:{"z-index":"3001"},attrs:{align:"justify",dense:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[t.seat?a("q-tab",{staticClass:"text-white",attrs:{name:"seating",icon:"event_seat",label:"Seat"}}):t._e(),a("q-tab",{staticClass:"text-white",attrs:{name:"items",icon:"widgets",label:"Items"}}),a("q-tab",{staticClass:"text-white",attrs:{name:"proceed",icon:"forward",label:"Proceed"}})],1),a("GroupStickyButton",{style:{visibility:!t.seat||t.tab&&"seating"!==t.tab?"visible":"hidden"},attrs:{type:t.params.type},model:{value:t.active_group,callback:function(e){t.active_group=e},expression:"active_group"}})],a("q-dialog",{attrs:{persistent:"",value:"proceed"===t.tab},on:{"before-hide":function(e){t.tab="items"}}},[a("OrderNewSummary",t._b({style:t.popup_width(),attrs:{loading:t.loading,payment:t.payment},on:{process:t.process}},"OrderNewSummary",t.params,!1))],1)],2)},o=[],c=(a("a434"),a("ddb0"),a("5ab9")),l=a("47ac"),m=a("40f6"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("FilterInputText",{staticClass:"q-mb-xs",attrs:{label:"Filter Seats"},on:{text:function(e){t.filter=e}}}),a("Masonry",{attrs:{items:t.seats,width:"180"},scopedSlots:t._u([{key:"item",fn:function(e){return[a("SeatSelectItem",{staticClass:"cursor-pointer",attrs:{id:e.id},on:{selected:function(a){return t.$emit("selected",e)}}})]}}])})],1)},p=[],d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{on:{click:function(e){return t.$emit("selected",t.seat)}}},[a("q-card-section",{staticClass:"q-py-xs bg-grey"}),a("CardImageTitle",{attrs:{title:t.seat.name,image:t.src}})],1)},h=[],y=a("b1c1"),b=a("43fa"),v={name:"SeatSelectItem",components:{CardImageTitle:b["a"]},props:["id"],computed:{seat(){return _.get(this.$store.state.seating.data,_.toSafeInteger(this.id))},src(){return Object(y["i"])(this.seat.image)}}},f=v,g=a("2877"),q=a("f09f"),x=a("a370"),S=a("eebe"),w=a.n(S),C=Object(g["a"])(f,d,h,!1,null,null,null),$=C.exports;w()(C,"components",{QCard:q["a"],QCardSection:x["a"]});var k=a("c624"),O={name:"SeatSelect",components:{Masonry:k["a"],FilterInputText:c["a"],SeatSelectItem:$},data(){return{filter:""}},computed:{s_seats(){return _(this.$store.state.seating.data).filter(["status","Active"]).value()},seats(){return this.filter?_.filter(this.s_seats,(t=>Object(y["r"])(t,["id","name","detail"],this.filter))):this.s_seats}},methods:{hKey({id:t}){return Object(y["e"])("seat","select","item",t)}}},N=O,Q=Object(g["a"])(N,u,p,!1,null,null,null),I=Q.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",[a("q-bar",{staticClass:"text-white q-py-lg items-center",class:"bg-"+t.clr},[a("q-icon",{attrs:{name:"receipt",color:"white",left:""}}),a("span",[t._v("Order Summary")]),a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"clear",flat:"",round:"",color:"white"}})],1),a("q-card-section",{staticClass:"q-pa-none"},[a("q-list",{staticStyle:{"font-size":"0.75rem"},attrs:{dense:"",separator:"",bordered:""}},[a("q-item",[a("q-item-section",{attrs:{avatar:""}},[t._v("No")]),a("q-item-section",[t._v("Item")]),a("q-item-section",{attrs:{side:""}},[t._v("Total")]),a("q-item-section",{attrs:{side:""}},[a("q-icon",{attrs:{name:"clear",color:"white",size:"xs"}})],1)],1),t._l(t.items,(function(e,s){return a("q-item",{key:t.h_key("ons-oi",s,"i",e.item)},[a("q-item-section",{attrs:{avatar:""}},[t._v(t._s(s+1))]),a("q-item-section",[a("q-item-label",[t._v(t._s(t.iData(e,"name"))),e.narration?a("span",{staticClass:"text-red text-italic text-caption q-ml-sm",staticStyle:{"font-size":"0.65rem"}},[t._v("("+t._s(e.narration)+")")]):t._e()]),a("q-item-label",{staticStyle:{"font-size":"0.65rem"},attrs:{caption:""}},[t._v(t._s(e.quantity)+" x "+t._s(parseFloat(t.price[e.item]).toFixed(2)))])],1),a("q-popup-edit",{attrs:{value:e.quantity,title:t.iData(e,"name"),"auto-save":""},on:{input:function(e){return t.$emit("process",["quantity",s,e])}}},[a("q-input",{attrs:{type:"number",value:e.quantity,dense:"",outlined:"",autofocus:"",label:"Quantity"},on:{input:function(e){return t.$emit("process",["quantity",s,e])}}}),t.item_narration_enabled?a("q-input",{staticClass:"q-mt-xs",staticStyle:{height:"2.8rem"},attrs:{type:"textarea",value:e.narration,dense:"",outlined:"",label:"Narration"},on:{input:function(e){return t.$emit("process",["item_narration",s,e])}}}):t._e()],1),a("q-item-section",{attrs:{side:""}},[t._v(t._s(parseFloat(t.price[e.item]*e.quantity).toFixed(2)))]),a("q-item-section",{attrs:{side:""}},[a("q-icon",{attrs:{name:"clear",color:"negative",size:"xs"},on:{click:function(e){return t.$emit("process",["remove",s])}}})],1)],1)})),a("q-item",{staticClass:"text-white",attrs:{dense:""}},[a("q-item-section",{attrs:{avatar:""}},[t._v("0")]),a("q-item-section",[a("q-item-label",{staticClass:"text-white"},[t._v("Total")])],1),a("q-item-section",{staticClass:"text-bold",class:"text-"+t.clr,attrs:{side:""}},[t._v(t._s(parseFloat(t.total).toFixed(2)))]),a("q-item-section",{attrs:{side:""}},[a("q-icon",{attrs:{name:"attach_money",color:t.clr,size:"xs"}})],1)],1)],2)],1),t.payment?a("q-card-section",{staticClass:"row q-col-gutter-xs"},[t.order_narration_enabled?a("div",{staticClass:"col-12"},[a("q-input",{staticStyle:{height:"2.8rem"},attrs:{type:"textarea",value:t.narration,dense:"",outlined:"",label:"Narration"},on:{input:function(e){return t.$emit("process",["narration",e])}}})],1):t._e(),a("div",{staticClass:"col-7"},[a("OrderCustomer",{attrs:{get:"id",outlined:"",dense:""},model:{value:t.v_customer,callback:function(e){t.v_customer=e},expression:"v_customer"}})],1),a("div",{staticClass:"col-5"},[a("TaxNatureSelectDropDown",{attrs:{label:"Tax Nature",outlined:"",dense:""},model:{value:t.payments.nature,callback:function(e){t.$set(t.payments,"nature",e)},expression:"payments.nature"}})],1),a("div",{staticClass:"col-3"},[a("PaymentTypeSelectDropDown",{attrs:{outlined:"",dense:""},model:{value:t.payments.advance_type,callback:function(e){t.$set(t.payments,"advance_type",e)},expression:"payments.advance_type"}})],1),a("div",{staticClass:"col-4"},[a("q-input",{attrs:{type:"number",outlined:"",dense:"",label:"Discount"},on:{keyup:t.discount_percent},model:{value:t.payments.discount,callback:function(e){t.$set(t.payments,"discount",t._n(e))},expression:"payments.discount"}})],1),a("div",{staticClass:"col-5"},[a("q-input",{attrs:{type:"number",outlined:"",dense:"",label:"Amount"},model:{value:t.payments.advance_amount,callback:function(e){t.$set(t.payments,"advance_amount",t._n(e))},expression:"payments.advance_amount"}})],1)]):a("q-card-section",[a("OrderCustomer",{attrs:{get:"id",outlined:"",dense:""},model:{value:t.v_customer,callback:function(e){t.v_customer=e},expression:"v_customer"}}),t.order_narration_enabled?a("q-input",{staticClass:"q-mt-xs",staticStyle:{height:"2.8rem"},attrs:{type:"textarea",value:t.narration,dense:"",outlined:"",label:"Narration"},on:{input:function(e){return t.$emit("process",["narration",e])}}}):t._e()],1),a("q-card-actions",{staticClass:"bg-grey-2",attrs:{align:"right"}},[a("q-btn",{attrs:{label:"Submit",color:t.clr,padding:"xs md",loading:t.loading},on:{click:t.submit}})],1)],1)},T=[],D=(a("13d5"),a("ded3")),F=a.n(D),B=a("2f62"),E=a("9708"),P=a("2943"),z=a("9afe"),G=a("232e"),M=a("bf7f"),K={name:"OrderNewSummary",components:{PaymentTypeSelectDropDown:z["a"],TaxNatureSelectDropDown:P["a"],OrderCustomer:E["a"]},props:["items","price_list","customer","color","loading","payment","type"],mixins:[M["a"]],data(){return{payments:{nature:null,advance_type:G["PaymentsTypes"][0],advance_amount:0,discount:0},order_narration_enabled:!0===Object(y["B"])(settings("enable_order_narration")),item_narration_enabled:!0===Object(y["B"])(settings("enable_item_narration"))}},computed:F()(F()({},Object(B["d"])("items",{item_master:"data"})),{},{clr(){return this.color||"accent"},instant_payment(){let t=_.toLower(_.get(this.$route,["meta","me","role"])),e="take_away_instant_payment",a=`take_away_${t}_instant_payment`;return!1!==(void 0===Object(y["B"])(settings(a))?Object(y["B"])(settings(e)):Object(y["B"])(settings(a)))},price(){return _.get(this.$store.getters["prices/items"],_.toInteger(this.price_list))},total(){return _.reduce(this.items,((t,{item:e,quantity:a})=>t+this.price[e]*a),0)},v_customer:{get(){return this.customer},set(t){this.$emit("process",["customer",t])}},narration:{get(){return _.get(this.$attrs,"narration","")},set(t){this.$emit("process",["narration",t])}}}),methods:{h_key:y["e"],iData({item:t},e){return _.get(this.item_master,[_.toInteger(t),e])},discount_percent(t){Object(y["n"])(t.keyCode)&&(this.prv_per||_.includes(_.toString(this.payments.discount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.payments.discount=this.payments.discount*this.total*.01,t.target.blur(),t.target.focus()}))}),250),this.prv_per=Object(y["n"])(t.keyCode)},submit(){if(this.payment&&!this.v_customer)return alert("Select Customer");this.$emit("process",["submit",this.payments])},KPC(t){["Enter","\n"].includes(t.key)&&t.ctrlKey&&!this.loading&&this.submit()}},watch:{"payments.discount":{immediate:!0,handler(t){t=_.toNumber(t),!1===this.instant_payment&&t<=0?this.payments.advance_amount=0:this.payments.advance_amount=_.toNumber(this.total-t)}},total(t){(this.instant_payment||_.toNumber(this.payments.discount))&&(this.payments.advance_amount=_.toNumber(_.toNumber(t)-_.toNumber(this.payments.discount)))}}},A=K,L=a("d847"),J=a("0016"),U=a("2c91"),V=a("9c40"),H=a("1c1c"),R=a("66e5"),W=a("4074"),X=a("0170"),Y=a("42a1"),Z=a("27f9"),tt=a("4b7e"),et=a("7f67"),at=Object(g["a"])(A,j,T,!1,null,null,null),st=at.exports;w()(at,"components",{QCard:q["a"],QBar:L["a"],QIcon:J["a"],QSpace:U["a"],QBtn:V["a"],QCardSection:x["a"],QList:H["a"],QItem:R["a"],QItemSection:W["a"],QItemLabel:X["a"],QPopupEdit:Y["a"],QInput:Z["a"],QCardActions:tt["a"]}),w()(at,"directives",{ClosePopup:et["a"]});var it=a("4064"),nt=a("514b"),rt={name:"OrderNewGlobal",components:{QuickOrder:it["a"],OrderNewSummary:st,SeatSelect:I,GroupStickyButton:m["a"],GroupItemsSelect:l["a"],FilterInputText:c["a"]},mixins:[nt["a"]],data(){return{tab:"",active_group:0,item_filter:"",params:{type:null,seating:null,price_list:null,customer:null,items:[],user:null,narration:null},loading:!1}},props:["seat","after","payment"],computed:{attrs(){return _.pick(this.$attrs,_.keys(this.params))},item_quantities(){return _(this.params.items).mapKeys("item").mapValues((t=>_.toNumber(t.quantity))).value()}},methods:{popup_width:y["y"],item({id:t},e){let a=_.findIndex(this.params.items,{item:t,narration:null});a<0?a=this.params.items.push({item:t,quantity:e||1,delay:0,narration:null})-1:this.params.items[a].quantity++;let s=this.params.items[a];return this.quick||this.$q.notify({type:"positive",message:"Item Updated",html:!0,caption:`${this.params.items.length} x Items <br />${_.sumBy(this.params.items,"quantity")} x Quantities <br />${s.quantity}x ${this.itemName(s.item)}`,group:"items",position:"top-right"}),a},setQuantity({item:t,quantity:e}){t=_.toSafeInteger(t),e=_.toNumber(e);let a=_.findIndex(this.params.items,["item",t]);a<0?this.item({id:t},e):this.quantity(a,e),e<1&&setTimeout(((t,e)=>t.remove(e)),2e3,this,a)},seating({id:t,price_list:e}){this.params.seating=t,this.params.price_list=e,this.tab="items"},init(t){let e=this;_.forEach(t,(function(t,a){e.params[a]=t}))},process(t){this[_.head(t)]["apply"](this,_.tail(t))},quantity(t,e){this.params.items[t]["quantity"]=_.toNumber(e)},remove(t){this.params.items.splice(t,1)},customer(t){this.params.customer=t},narration(t){this.params.narration=t},item_narration(t,e){this.params.items[t]["narration"]=e},submit(t){if(_.isEmpty(this.params.items))return;this.loading=!0;let e=this.payment?Object.assign({},this.params,t):this.params;post("token","create",e).then((()=>{if(this.params.items.splice(0,this.params.items.length),this.item_filter="",this.active_group=0,this.init(this.attrs),this.loading=!1,this.tab="items",this.after)return this.$router.push(_.isObject(this.after)?this.after:{name:this.after});this.seat&&setTimeout((t=>t.tab="seating"),600,this)}))},itemName(t){return _.get(this.$store.state.items.data,[t,"name"])}},watch:{attrs:{immediate:!0,deep:!0,handler:"init"},"params.type":{immediate:!0,handler(t){t&&!this.params.customer&&(this.params.customer=_.get(settings("default_customer",t),"id"))}}}},ot=rt,ct=a("429b"),lt=a("7460"),mt=a("24e8"),ut=Object(g["a"])(ot,r,o,!1,null,null,null),pt=ut.exports;w()(ut,"components",{QCard:q["a"],QCardSection:x["a"],QTabs:ct["a"],QTab:lt["a"],QDialog:mt["a"]});var dt={name:"PageOrderNew",components:{OrderNewGlobal:pt,MenuSelect:n["a"]},props:["seat","type"],computed:{type_menu(){return _.snakeCase([this.type||"Dining","Menu"].join(" "))},popup_width(){return Object(y["y"])()},m_show(){return!_.size(_.get(this.$store.state.public,this.type_menu))}}},_t=dt,ht=a("9989"),yt=Object(g["a"])(_t,s,i,!1,null,null,null);e["default"]=yt.exports;w()(yt,"components",{QPage:ht["a"],QDialog:mt["a"]})}}]);