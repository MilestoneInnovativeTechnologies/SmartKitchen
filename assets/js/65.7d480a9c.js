(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[65],{"6f77":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[e.remote?e._e():t("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"No remote kitchen feature enabled"}}),e.reference?e._e():t("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"Remote Kitchen Reference is missing in subscription"}}),e.client?e._e():t("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"Remote kitchen client is not enabled"}}),e.remote&&e.reference&&e.client?[e.no_data?t("div",{staticClass:"text-center text-negative text-bold"},[e._v("No Data Available")]):0===Object.keys(e.remote_records).length?t("div",{staticClass:"text-center"},[t("q-btn",{attrs:{label:"Load from Server",color:"primary",icon:"file_download",loading:e.loading},on:{click:e.load_data}})],1):t("div",{staticClass:"q-gutter-y-sm"},e._l(e.remote_records,(function(i,a){return t("q-card",{key:a},[t("q-card-section",{staticClass:"text-bold bg-secondary text-white flex justify-between items-center"},[t("div",[t("q-icon",{directives:[{name:"show",rawName:"v-show",value:e.local_records.hasOwnProperty(a),expression:"local_records.hasOwnProperty(ref)"}],attrs:{name:"done_all",color:"white",size:"xs"}}),e._v(" "+e._s(i.name)+" (Auto Accept: "+e._s(i.auto_accept)+")")],1),t("div",[e._v(e._s(i._location))])]),t("q-list",{attrs:{separator:""}},e._l(i.items,(function(i,s){return t("q-item",{key:"rkm-rk-"+a+"-ki-idx-"+s},[t("q-item-section",{attrs:{top:""}},[t("q-item-label",{staticClass:"text-positive text-bold"},[e._v(e._s(i.item))]),t("q-item-label",{attrs:{caption:""}},[t("div",{staticClass:"flex justify-between"},[t("div",[e._v("Auto Process")]),t("div",[e._v(e._s(i.auto_process))])]),t("div",{staticClass:"flex justify-between"},[t("div",[e._v("Auto Complete")]),t("div",[e._v(e._s(i.auto_complete))])]),t("div",{staticClass:"flex justify-between"},[t("div",[e._v("Duration")]),t("div",[e._v(e._s(i.duration))])]),t("div",{staticClass:"flex justify-between"},[t("div",[e._v("Stock")]),t("div",[e._v(e._s(i.stock))])])])],1),t("q-item-section",{staticClass:"text-center",attrs:{side:""}},[t("q-icon",{attrs:{name:"forward",color:"primary"}})],1),t("q-item-section",e._b({},"q-item-section",{top:e.kitchen_item_locally_exists(a,i.id)},!1),[e.kitchen_item_locally_exists(a,i.id)?[t("q-item-label",{staticClass:"text-positive text-bold"},[e._v(e._s(e.kitchen_item_name(a,i.id)))]),t("q-item-label",{attrs:{caption:""}},e._l(e.kitchen_item_prices(a,i.id),(function(i,r,n){return t("div",{key:"rkm-rk-"+a+"-ki-idx-"+s+"-pr-"+n,staticClass:"flex justify-between"},[t("div",[e._v(e._s(r))]),t("div",[e._v(e._s(i))])])})),0)]:t("div",{staticClass:"text-center"},[t("q-btn",{attrs:{label:"Add",color:"secondary"},on:{click:function(t){e.manage={ref:a,item:i}}}})],1)],2),t("q-item-section",{directives:[{name:"show",rawName:"v-show",value:e.kitchen_item_locally_exists(a,i.id),expression:"kitchen_item_locally_exists(ref,item.id)"}],attrs:{side:""}},[t("q-btn",{attrs:{icon:"edit",round:"",dense:"",flat:"",color:"primary"},on:{click:function(t){e.manage={ref:a,item:i}}}})],1)],1)})),1)],1)})),1),t("q-dialog",{attrs:{persistent:""},model:{value:e.manage,callback:function(t){e.manage=t},expression:"manage"}},[t("RemoteKitchenItemManage",e._b({style:e.popup_width(),on:{close:function(t){e.manage=!1}}},"RemoteKitchenItemManage",e.manage_attrs,!1))],1)]:e._e()],2)},s=[],r=(i("14d9"),i("ec70")),n=i("de36"),c=i("2f62"),o=i("b1c1"),l=function(){var e=this,t=e._self._c;return t("q-card",[t("q-card-section",{staticClass:"bg-grey-2 text-bold text-caption justify-between items-center q-px-sm q-py-sm",attrs:{horizontal:""}},[t("div",[e._v("Manage Kitchen Item of Remote")]),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",round:"",dense:"",flat:""}})],1),e.kitchen?t("q-card-section",{staticClass:"q-gutter-y-sm"},[t("q-select",{attrs:{outlined:"",label:"Item Add Type",options:["Map","Create"]},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),"Map"===e.type?t("q-select",{attrs:{options:e.item_master,outlined:""},model:{value:e.map,callback:function(t){e.map=t},expression:"map"}}):t("q-form",{staticClass:"q-gutter-y-sm"},[t("q-input",{attrs:{outlined:"",label:"Name"},model:{value:e.item_params.item,callback:function(t){e.$set(e.item_params,"item",t)},expression:"item_params.item"}}),t("q-input",{staticStyle:{height:"5rem"},attrs:{outlined:"",label:"Detail",type:"textarea"},model:{value:e.item_params.detail,callback:function(t){e.$set(e.item_params,"detail",t)},expression:"item_params.detail"}}),t("div",{staticClass:"text-subtitle2"},[e._v("Prices")]),t("div",{staticClass:"row q-col-gutter-xs"},e._l(e.item_prices,(function({id:i,name:a}){return t("div",{key:"rkim-ip-p-"+i,staticClass:"col-xs-6 col-md-4"},[t("q-input",{attrs:{outlined:"",label:a,type:"number"},model:{value:e.item_params.prices[i],callback:function(t){e.$set(e.item_params.prices,i,e._n(t))},expression:"item_params.prices[id]"}})],1)})),0)],1)],1):t("q-card-section",{staticClass:"text-center q-gutter-y-sm text-primary text-uppercase text-bold"},[e._v("\n    Kitchen not added\n    "),t("q-btn",{attrs:{label:"Click here to add kitchen",color:"primary"},on:{click:function(t){return e.addKitchen()}}})],1),t("q-card-actions",{directives:[{name:"show",rawName:"v-show",value:e.kitchen,expression:"kitchen"}],staticClass:"q-px-md bg-grey-2",attrs:{align:"right"}},[t("q-btn",{attrs:{color:"primary",label:"Save Details"},on:{click:e.addKitchenItem}})],1),t("q-inner-loading",{attrs:{showing:e.loading}},[t("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)},m=[];i("8bd5");const d=["id","item","detail","_location","_monitor","reference","kitchen","status","stock","duration","auto_process","auto_complete","prices"],p=["name","auto_accept","cloud","status","online","users","reference","_location","_monitor"];var u={name:"RemoteKitchenItemManage",props:["local","item","remote"],computed:{...Object(c["d"])({price_lists:e=>e.prices.list,item_master:e=>_.map(e.items.data,(e=>Object.assign({},e,{value:e.id,label:e.name})))}),kitchen_item_id(){return _.get(_.findLast(this.$store.state.remote.data,{item:"kitchen_items",reference:this.item.id}),"local_id")},item_id(){return this.item_params.id||this.$store.getters["remote/item_id_of_kitchen_item"](this.kitchen_item_id)},kitchen(){return this.local?_.get(this.$store.state.kitchens.data,_.get(this.local,"local_id")):null},item_data(){return Object.assign({},this.item,{reference:this.item.id,id:this.item_id,prices:{}})},item_prices(){let e=_.get(this.$store.getters["items/prices"],this.item_id,{});return _.map(this.price_lists,(({name:t,id:i})=>new Object({id:i,name:t,price:_.get(e,i,0)})))},map:{get(){return _.find(this.item_master,{value:this.item_params.id})||null},set(e){this.item_params.id=e.value}},type:{get(){return this.v_type},set(e){this.v_type=e,this.item_params.id=void 0}},kitchen_params(){return _.fromPairs([..._.map(p,(e=>[e,_.get(this.remote,e)])),["reference",this.remote.id]])}},data(){return{loading:!1,v_type:"Map",item_params:_.zipObject(d,Array(d.length).fill(null))}},methods:{addKitchen(){this.loading=!0,post("remote","kitchens",this.kitchen_params).then().catch().finally((()=>setTimeout((e=>e.loading=!1),750,this)))},addKitchenItem(){this.loading=!0,post("remote","kitchen_items",this.item_params).then().catch().finally((()=>setTimeout((e=>e.loading=e.$emit("close")&&!1),750,this)))}},watch:{item:{immediate:!0,handler(){setTimeout((function(e){let t=_.cloneDeep(e.item_data);e.loading=!0,_.forEach(_.cloneDeep(e.item_params),(function(i,a){i!==t[a]&&e.$set(e.item_params,a,t[a])})),_.forEach(_.cloneDeep(e.item_prices),(({id:t,price:i})=>e.$set(e.item_params.prices,t,_.toNumber(i)))),e.loading=!1}),200,this)}}}},h=u,f=i("2877"),v=i("f09f"),g=i("a370"),b=i("9c40"),k=i("ddd8"),x=i("0378"),y=i("27f9"),q=i("4b7e"),C=i("74f7"),w=i("e669"),j=i("7f67"),Q=i("eebe"),K=i.n(Q),O=Object(f["a"])(h,l,m,!1,null,null,null),I=O.exports;K()(O,"components",{QCard:v["a"],QCardSection:g["a"],QBtn:b["a"],QSelect:k["a"],QForm:x["a"],QInput:y["a"],QCardActions:q["a"],QInnerLoading:C["a"],QSpinnerFacebook:w["a"]}),K()(O,"directives",{ClosePopup:j["a"]});var A=i("adfa");const{CC71V:R,DP71V:D,KK99V:N}=i("adfa").FEATURES;var $={name:"PageRemoteKitchenManage",components:{RemoteKitchenItemManage:I,Jumbotron:r["a"]},data(){return{remote:"Yes"===R,reference:_.trim(D),client:"Yes"===N,no_data:!1,loading:!1,remote_records:{},v_manage:null}},computed:{...Object(c["d"])({remotes:e=>e.remote.data,kitchen_master:e=>e.kitchens.data,kitchen_items:e=>e.kitchens.items,item_master:e=>e.items.data,price_master:e=>e.prices.list}),...Object(c["b"])({prices:"items/prices"}),kitchen_item_reference(){return _(this.remotes).filter(["item","kitchen_items"]).mapKeys("local_id").mapValues("reference").value()},local_records(){return _(this.remotes).filter(["item","kitchens"]).mapKeys("reference").mapValues((e=>Object.assign({},e,_.get(this.kitchen_master,e.local_id),{items:this.kitchen_item_details(e.local_id)}))).value()},manage:{get(){return!_.isNull(this.v_manage)},set(e){this.v_manage=e?[e.ref,e.item]:null}},manage_attrs(){let e=this.v_manage;return e?{local:_.get(this.local_records,e[0]),remote:_.get(this.remote_records,e[0]),item:e[1]}:null}},methods:{popup_width:o["y"],load_data(){let e=this;e.loading=!0,Promise.all([Object(n["f"])("kitchens",[{_monitor:!0},{_location:A["BRANCH_CODE"],operand:"!="}],!0),Object(n["f"])("kitchen_items",[{_monitor:!0},{_location:A["BRANCH_CODE"],operand:"!="}],!0)]).then((function(t){let i=t[0],a=t[1];if(e.loading=!1,0===i.size)return e.no_data=!0;i.forEach((t=>e.$set(e.remote_records,t.id,{...t.data(),id:t.id,items:[]}))),a.forEach((t=>e.remote_records[t.get("kitchen")].items.push({...t.data(),id:t.id})))}))},kitchen_item_locally_exists(e,t){return _.has(this.local_records,[e,"items",t])},kitchen_item_details(e){return _(_.get(this.kitchen_items,e)).map((({id:e,item:t})=>Object.assign({},_.get(this.item_master,t),{reference:_.get(this.kitchen_item_reference,e)},{prices:_.mapKeys(_.get(this.prices,t),((e,t)=>_.get(this.price_master,[t,"name"])))}))).mapKeys("reference").value()},kitchen_item_name(e,t){return _.get(this.local_records,[e,"items",t,"name"])},kitchen_item_prices(e,t){return _.get(this.local_records,[e,"items",t,"prices"])}}},P=$,S=i("9989"),M=i("0016"),E=i("1c1c"),J=i("66e5"),z=i("4074"),L=i("0170"),T=i("24e8"),V=Object(f["a"])(P,a,s,!1,null,null,null);t["default"]=V.exports;K()(V,"components",{QPage:S["a"],QBtn:b["a"],QCard:v["a"],QCardSection:g["a"],QIcon:M["a"],QList:E["a"],QItem:J["a"],QItemSection:z["a"],QItemLabel:L["a"],QDialog:T["a"]})}}]);