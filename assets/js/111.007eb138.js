(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[111],{2836:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{attrs:{padding:""}},[e.kitchen?i("KitchenTokens",{attrs:{id:e.kitchen.id,card:!1}}):e._e(),i("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},[i("q-page-sticky",{directives:[{name:"show",rawName:"v-show",value:!e.reset,expression:"!reset"}],key:"ktp-rs-b",staticClass:"lt-md",attrs:{position:"bottom-left",offset:[18,18]}},[i("q-btn",{attrs:{fab:"",icon:"undo",color:"negative",padding:"sm"},on:{click:function(t){e.reset=!0}}})],1),e.cloud?i("q-page-sticky",{directives:[{name:"show",rawName:"v-show",value:!e.offline_order,expression:"!offline_order"}],key:"ktp-aoo-b",attrs:{position:"bottom-right",offset:[18,18]}},[i("q-btn",{staticClass:"flip-horizontal",attrs:{fab:"",icon:"undo",color:"secondary",padding:"sm"},on:{click:function(t){e.offline_order=!0}}})],1):e._e()],1),e.cloud?i("q-dialog",{attrs:{persistent:"",value:e.offline_order},on:{"before-hide":function(t){e.offline_order=!1}}},[i("AddRemoteOrder",{staticStyle:{width:"22rem"},attrs:{kitchen:e.kitchen.id},on:{imported:function(t){e.offline_order=!1}}})],1):e._e()],1)},a=[],n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{attrs:{flat:!e.card}},[e.card?i("q-card-section",{staticClass:"bg-grey-2"},[i("div",{staticClass:"text-bold"},[e._v(e._s(e.kitchen.name))])]):e._e(),i("q-card-section",{directives:[{name:"show",rawName:"v-show",value:0===e.Tokens.length,expression:"Tokens.length === 0"}],staticClass:"text-center"},[e._v("NO TOKENS")]),i("q-card-section",{directives:[{name:"show",rawName:"v-show",value:0!==e.Tokens.length,expression:"Tokens.length !== 0"}],staticClass:"q-pa-none q-ma-none"},[i("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Item"===e.mode,expression:"mode === 'Item'"}]},[i("Masonry",{attrs:{width:"250",items:e.items},scopedSlots:e._u([{key:"item",fn:function(t){return[i("KitchenTokenItem",{attrs:{kitchen:e.id,details:t.item,item:e.getItem(t.item),stock:e.getStock(t.item)}})]}}])})],1),i("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Progress"===e.mode,expression:"mode === 'Progress'"}],staticClass:"row q-col-gutter-sm"},[i("div",{staticClass:"col-xs-12 col-sm-4"},[i("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"New",stock:"true",action:"true"}})],1),i("div",{staticClass:"col-xs-12 col-sm-4"},[i("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"Accepted",action:"true"}})],1),i("div",{staticClass:"col-xs-12 col-sm-4"},[i("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"Processing",action:"true"}})],1)]),i("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Token"===e.mode,expression:"mode === 'Token'"}]},[i("Masonry",{attrs:{width:"320",gutter:"xs",items:e.cloud?e.sTokens:e.Tokens},scopedSlots:e._u([{key:"item",fn:function(t){return[i(e.cloud?"TokenDetailCardRemote":"TokenDetailCard",{tag:"component",attrs:{id:t.id,kitchen:e.kitchen.id,multiple:e.card}})]}}])})],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:e.reset,callback:function(t){e.reset=t},expression:"reset"}},[i("KitchenItemCancel",{style:e.popup_width(),attrs:{kitchen:e.id,cancelling:e.cancelling},on:{cancel:e.doReset}})],1)],1)},r=[],o=(i("5db7"),i("73d9"),i("ded3")),c=i.n(o),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[e.multiple?e._e():i("q-card-section",{staticClass:"q-pa-xs",class:e.dtColor}),i("q-card-section",{staticClass:"bg-grey-2 row justify-between items-center q-py-sm"},[i("div",{staticClass:"text-bold q-py-xs q-px-sm text-white text-weight-bolder rounded-borders",class:e.dtColor},[e._v(e._s(e.id))]),i("div",{staticClass:"text-bold"},[e._v(e._s(e.token_time))])]),i("q-card-section",{staticClass:"row justify-between items-center q-py-xs"},[e.token.waiter?i("q-chip",{attrs:{square:"",color:"cyan-7","text-color":"white"}},[i("q-avatar",{attrs:{"text-color":"white"}},[i("q-icon",{attrs:{name:"local_dining"}})],1),e._v(e._s(e.token.waiter.name))],1):e._e(),e.token.seating?i("q-chip",{attrs:{square:"",color:"amber-9","text-color":"white"}},[i("q-avatar",{attrs:{"text-color":"white"}},[i("q-icon",{attrs:{name:"event_seat"}})],1),e._v(e._s(e.token.seating.name))],1):e._e(),"Dining"!==e.token.type&&e.token.customer?i("q-chip",{attrs:{square:"",color:"accent","text-color":"white"}},[i("q-avatar",{attrs:{"text-color":"white"}},[i("q-icon",{attrs:{name:"person_outline"}})],1),e._v(e._s(e.token.customer.name))],1):e._e(),i("q-chip",{attrs:{square:"",color:"teal-9","text-color":"white"}},[i("q-avatar",{attrs:{"text-color":"white"}},[i("q-icon",{attrs:{name:"rule"}})],1),e._v(e._s(e.token.type))],1)],1),i("q-list",{staticClass:"bg-grey-1",attrs:{bordered:"",separator:""}},e._l(e.token.items,(function(t){return i("TokenDetailCardItem",{key:e.hKey(t),attrs:{token:e.token,item:t,kitchen:e.kitchen}})})),1),i("BrowserPrintCardActions",{attrs:{token:e.token}})],1)},d=[],m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return"Cancelled"!==e.item.progress?i("q-item",{attrs:{disable:!e.eligible}},[i("q-item-section",[e.item.deliver?i("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[e._v("Delivery: "+e._s(e.item.deliver_human))]):e._e(),e.item.say?i("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[i("span",{staticStyle:{visibility:"hidden"}},[e._v("Delivery: ")]),e._v(e._s(e.item.say))]):e._e(),e.eligible&&e.wait?i("q-item-label",{staticClass:"text-weight-bolder text-red",staticStyle:{"font-size":"0.8rem"}},[e._v("Wait "+e._s(e.item.delay-e.now)+" seconds")]):e._e(),e.offline_reference?i("q-item-label",{staticClass:"text-bold text-cyan",staticStyle:{"font-size":"0.65rem"}},[e._v(e._s(e.offline_reference))]):e._e(),i("q-item-label",[i("span",{staticClass:"text-weight-bolder"},[e._v(e._s(e.item.quantity))]),e._v(" x "+e._s(e.name))]),e.eligible&&e.item.narration&&!e.wait?i("q-item-label",{staticClass:"text-weight-bolder text-red",staticStyle:{"font-size":"0.8rem"},attrs:{caption:""}},[e._v(e._s(e.item.narration))]):e._e(),i("q-item-label",{attrs:{caption:"",temp:e.next}},[e._v(e._s(e.time)+" "+e._s(e.unit)+" ago")]),e.item.kitchen&&e.item.kitchen!==e.kitchen?i("q-item-label",{attrs:{caption:""}},[e._v("Kitchen: "+e._s(e.kName(e.item.kitchen)))]):e._e(),e.item.photo?i("q-item-label",{attrs:{caption:""}},[i("q-btn",{attrs:{type:"a",padding:"none",label:"Photo Attached","icon-right":"launch",color:"blue",flat:"",size:"sm"},on:{click:function(t){return e.$emit("photo",e.item.photo)}}})],1):e._e()],1),"Processing"!==e.item.progress||!e.eligible||e.loading||e.wait?e._e():i("q-item-section",{attrs:{side:""}},[i("q-spinner-dots",{attrs:{color:"primary",size:"2em"}})],1),i("q-item-section",{attrs:{side:""}},[i("q-badge",{staticClass:"q-py-xs",attrs:{color:e.color[e.item.progress],label:e.item.progress}})],1),e.eligible&&e.action.hasOwnProperty(e.item.progress)?i("q-item-section",{attrs:{side:""}},[i("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",color:"primary",round:"",size:"sm"},on:{click:e.progress}})],1):i("q-item-section",{attrs:{side:""}},[i("q-btn",{staticClass:"bg-transparent",attrs:{flat:"",round:"",size:"sm"}})],1),e.eligible&&(e.wait||e.loading)?i("q-inner-loading",{attrs:{showing:!0}},[i("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1):e._e()],1):e._e()},u=[],h=i("2f62"),p=i("232e"),k={name:"TokenDetailCardItem",props:["token","item","kitchen","offline_reference"],data(){return{color:p["TokenItemProgressColor"],action:{New:"accept",Accepted:"process",Processing:"complete"},now:_.toInteger((new Date).getTime()/1e3),loading:!1}},computed:c()(c()({},Object(h["d"])({available({kitchens:{items:e}}){return!!_.filter(_.get(e,this.kitchen),["item",this.item.item.id]).length}})),{},{name(){return this.item.item.name},eligible(){var e,t;return(null===(e=this.item)||void 0===e||null===(t=e.kitchen)||void 0===t?void 0:t.id)===this.kitchen||!this.item.kitchen&&this.available},since(){return _.toInteger(_.get(_.last(this.item.progress_timing),"time"))},time(){let e=this.now-this.since,t=e<60?e:e<3600?_.toInteger(e/60):_.toInteger(e/3600);return _.toInteger(t)},unit(){let e=this.now-this.since;return e<60?"seconds":e<3600?"minutes":"hours"},wait(){return this.item.delay>0&&this.now<this.item.delay},next(){this.now;return setTimeout((e=>e.now=_.toInteger((new Date).getTime()/1e3)),this.wait||"seconds"===this.unit?1e3:"minutes"===this.unit?6e4:36e5,this)}}),methods:{kName(e){return _.get(this.$store.state.kitchens.data,[e,"name"])},progress(){this.loading=!0,post("token",this.action[this.item.progress],{id:this.item.id,kitchen:this.kitchen}).then((()=>this.loading=!1))}}},g=k,f=i("2877"),v=i("66e5"),b=i("4074"),q=i("0170"),y=i("9c40"),w=i("8380"),x=i("58a8"),C=i("74f7"),I=i("e669"),T=i("eebe"),Q=i.n(T),O=Object(f["a"])(g,m,u,!1,null,null,null),$=O.exports;Q()(O,"components",{QItem:v["a"],QItemSection:b["a"],QItemLabel:q["a"],QBtn:y["a"],QSpinnerDots:w["a"],QBadge:x["a"],QInnerLoading:C["a"],QSpinnerFacebook:I["a"]});var j=i("b1c1"),S=i("3758"),K=i("36d9"),A={name:"TokenDetailCard",components:{BrowserPrintCardActions:K["a"],TokenDetailCardItem:$},props:["id","kitchen","multiple"],mixins:[S["a"]],computed:{token(){return _.find(this.tokens,["id",this.id])},token_time(){return Object(j["D"])(this.token.date)},dtColor(){return"bg-"+p["DiningTypeColor"][this.token.type]}},methods:{hKey({token:e,item:t,id:i}){return Object(j["e"])("token",e,"item","detail",t,"id",i)}}},B=A,D=i("f09f"),N=i("a370"),P=i("b047"),L=i("cb32"),E=i("0016"),z=i("1c1c"),R=Object(f["a"])(B,l,d,!1,null,null,null),W=R.exports;Q()(R,"components",{QCard:D["a"],QCardSection:N["a"],QChip:P["a"],QAvatar:L["a"],QIcon:E["a"],QList:z["a"]});var F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-card-section",{staticClass:"text-white text-bold",class:e.colClass},[e._v(e._s(e.type))]),i("q-list",{directives:[{name:"show",rawName:"v-show",value:Object.keys(e.dist).length>0,expression:"Object.keys(dist).length > 0"}],attrs:{bordered:"",separator:""}},[i("transition-group",{attrs:{appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut",mode:"out-in"}},e._l(e.dist,(function(t,s){return i("KitchenTokenBundleItem",e._b({key:e.hKey(s),attrs:{identify:s,progress:e.type,"show-stock":e.stock,processing:e.processing.includes(s)},on:{proceed:function(t){e.item=t}}},"KitchenTokenBundleItem",t,!1))})),1)],1),i("q-card-section",{staticClass:"text-center text-bold"},[e._v(e._s(e.total?"Total: "+e.total:"No Items"))]),void 0!==e.action?i("q-dialog",{attrs:{persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("KitchenTokenBundleAction",e._b({staticStyle:{width:"50vw","max-width":"330px"},attrs:{progress:e.type},on:{progress:e.progress}},"KitchenTokenBundleAction",e.dist[e.item],!1))],1):e._e()],1)},M=[],V=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-item",{attrs:{disable:e.wait>0||e.$attrs.processing,clickable:""},on:{click:function(t){return e.$emit("proceed",e.$attrs.identify)}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-avatar",{attrs:{rounded:""}},[i("q-img",{attrs:{src:e.src}})],1)],1),i("q-item-section",[void 0!==e.$attrs["show-stock"]?i("q-item-label",{attrs:{caption:""}},[e._v("Stock: "+e._s(e.$attrs.stock))]):e._e(),i("q-item-label",{staticClass:"text-weight-bold"},[e._v(e._s(e.$attrs.name))]),e.wait?i("q-item-label",{staticClass:"text-bold",attrs:{caption:""}},[e._v("Wait: "+e._s(e.wait))]):e._e(),e.$attrs.narration?i("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[e._v(e._s(e.$attrs.narration))]):e._e()],1),i("q-item-section",{attrs:{side:""}},[i("q-avatar",{staticClass:"text-weight-bold",attrs:{color:e.color,rounded:"","text-color":"white"}},[e._v(e._s(e.$attrs.total))])],1),i("q-inner-loading",{attrs:{showing:e.$attrs.processing,"transition-hide":"fadeOut","transition-show":"fadeIn"}},[i("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)},Y=[],H={name:"KitchenTokenBundleItem",data(){return{wait:_.toInteger(this.$attrs.wait),interval:0,color:p["TokenItemProgressColor"][this.$attrs.progress],src:Object(j["i"])(this.$attrs.image)}},created(){this.wait&&(this.interval=setInterval((e=>e.wait--),1e3,this),setTimeout((e=>clearInterval(e.interval)),1e3*this.wait,this))}},U=H,J=i("068f"),G=Object(f["a"])(U,V,Y,!1,null,null,null),X=G.exports;Q()(G,"components",{QItem:v["a"],QItemSection:b["a"],QAvatar:L["a"],QImg:J["a"],QItemLabel:q["a"],QInnerLoading:C["a"],QSpinnerFacebook:I["a"]});var Z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("CardImageTitle",{attrs:{image:e.image,title:e.$attrs.name}}),e.$attrs.narration?i("q-card-section",{staticClass:"bg-teal text-white"},[i("div",{staticClass:"text-h6"},[e._v(e._s(e.$attrs.narration))])]):e._e(),i("q-card-actions",[i("q-btn",{attrs:{icon:"done_all",glossy:"",push:"",color:"positive",label:"All"},on:{click:e.all}}),i("q-space"),i("q-btn",{attrs:{icon:"done",glossy:"",push:"",color:"deep-orange-7",label:"Invert "},on:{click:e.invert}})],1),i("q-list",{staticClass:"bg-grey-2",attrs:{bordered:"",separator:""}},e._l(e.$attrs.token,(function(t){return i("q-item",{key:e.hKey(t),class:{"bg-grey-4":e.selected.includes(t.id)},attrs:{clickable:""},on:{click:function(i){return e.clicked(t)}}},[i("q-item-section",{attrs:{avatar:""}},[i("transition",{attrs:{mode:"out-in",appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut"}},[e.selected.includes(t.id)?i("q-avatar",{attrs:{icon:"done_all",color:"green","text-color":"grey-2"}}):e._e()],1)],1),i("q-item-section",[i("q-item-label",[e._v("Token: "+e._s(t.token)+" - ("+e._s(e.time(e.Tokens[t.token].date))+")")]),i("q-item-label",{attrs:{caption:""}},[e._v("Type: "+e._s(e.Tokens[t.token].type))]),e.Tokens[t.token].waiter?i("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.Tokens[t.token].waiter.name))]):e._e(),e.Tokens[t.token].seating?i("q-item-label",{attrs:{caption:""}},[e._v("Seat: "+e._s(e.Tokens[t.token].seating.name))]):e._e()],1),i("q-item-section",{attrs:{side:""}},[i("q-avatar",{attrs:{rounded:"","text-color":"white",color:e.color}},[e._v(e._s(t.quantity))])],1)],1)})),1),i("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"left"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"CLOSE"}}),i("q-space"),i("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"q-py-sm q-px-md",attrs:{label:e.total}}),i("q-space"),i("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",disable:!e.selected.length,round:"",color:"positive"},on:{click:function(t){return e.$emit("progress",e.selected)}}})],1)],1)},ee=[],te=(i("ddb0"),i("43fa")),ie={name:"KitchenTokenBundleAction",components:{CardImageTitle:te["a"]},data(){return{image:Object(j["i"])(this.$attrs.image),selected:[],color:p["TokenItemProgressColor"][this.$attrs.progress]}},mixins:[S["a"]],computed:{tkn(){return _.map(this.$attrs.token,"token")},ids(){return _.map(this.$attrs.token,"id")},Tokens(){return _(this.tokens).filter((({id:e})=>this.tkn.includes(e))).keyBy("id").value()},total(){let e=this.selected;return"TOTAL: "+_.sumBy(_.values(this.$attrs.token),(({quantity:t,id:i})=>e.includes(i)?t:0))}},methods:{hKey({id:e,token:t}){return Object(j["e"])("kitchen","token",t,"bundle","action","id",e)},time(e){return Object(j["D"])(e)},clicked({id:e}){this.selected.includes(e)?this.selected=_.difference(this.selected,[e]):this.selected.push(e)},all(){this.selected=this.ids},invert(){_.forEach(this.ids,(e=>this.clicked({id:e})))}}},se=ie,ae=i("4b7e"),ne=i("2c91"),re=i("7f67"),oe=Object(f["a"])(se,Z,ee,!1,null,null,null),ce=oe.exports;Q()(oe,"components",{QCard:D["a"],QCardSection:N["a"],QCardActions:ae["a"],QBtn:y["a"],QSpace:ne["a"],QList:z["a"],QItem:v["a"],QItemSection:b["a"],QAvatar:L["a"],QItemLabel:q["a"],QBadge:x["a"]}),Q()(oe,"directives",{ClosePopup:re["a"]});var le={name:"KitchenTokenBundle",components:{KitchenTokenBundleAction:ce,KitchenTokenBundleItem:X},mixins:[S["a"]],props:["kitchen","type","stock","action"],data(){return{colClass:"bg-"+p["TokenItemProgressColor"][this.type],waits:[],timeout:0,item:null,processing:[],status:{New:"accept",Accepted:"process",Processing:"complete"}}},computed:c()(c()({},Object(h["d"])({kItems({kitchens:{items:e}}){return _.map(e[this.kitchen],(({item:e,stock:t})=>Object.assign({},{item:e,stock:t})))},items(){return _(this.tokens).flatMap("items").filter(this.isAct).value()},dist(){return _(this.items).groupBy(this.crypt).mapValues(this.itmObj).value()},total(){return _.sumBy(Object.values(this.dist),"total")}})),{},{dialog:{get(){return!!this.item},set(e){this.item=e||null}}}),methods:{hKey(e){return Object(j["e"])("kitchen",this.id,"tokens","bundle",e)},isAct({item:e,progress:t,kitchen:i}){return!i&&"New"===t&&"New"===this.type&&_.some(this.kItems,["item",e.id])||i&&i.id===_.toInteger(this.kitchen)&&this.type===t},itmObj(e){let t=e[0];return Object.assign({},this.pure(t),{total:_.sumBy(e,"quantity"),token:_(e).keyBy("token").mapValues((({token:e,id:t,user:i,quantity:s})=>new Object({token:e,id:t,user:i,quantity:s}))).value()})},crypt({delay:e,item:{id:t},narration:i}){return Object(j["c"])([t,this.getWait(e),i].join("|"))+""},pure({item:{id:e,name:t,image:i},delay:s,narration:a}){return{wait:this.getWait(s),narration:a,name:t,image:i,item:e,stock:_.get(_.find(this.kItems,["item",e]),"stock")}},getWait(e){let t=_.toInteger(e)-Object(j["t"])();return t<0?0:(this.waits.includes(t)||this.waits.push(t),t)},progress(e){let t=this.item;e.length&&this.processing.push(t),this.dialog=!1,this.post(0,e,t,this.kitchen)},post(e,t,i,s){if(t.length<=e)return this.processing=_.difference(this.processing,[i]);post("token",this.status[this.type],{id:t[e],kitchen:s}).then((()=>setTimeout(this.post,300,e+1,t,i,s)))}},watch:{waits:{immediate:!0,handler(e){if(!e.length)return;let t=1e3*_.min(e);clearTimeout(this.timeout),this.timeout=setTimeout((e=>e.waits=[]),t,this)}}}},de=le,me=i("24e8"),ue=Object(f["a"])(de,F,M,!1,null,null,null),he=ue.exports;Q()(ue,"components",{QCard:D["a"],QCardSection:N["a"],QList:z["a"],QDialog:me["a"]});var pe=i("3610"),_e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-card-section",{staticClass:"row bg-deep-orange items-center text-white"},[i("div",{staticClass:"text-h6"},[e._v("Reset Item")]),i("q-space"),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"clear"}})],1),i("q-item-section",{staticClass:"q-pa-md"},[i("FilterInputText",{attrs:{lazy:"true"},on:{text:function(t){e.filter=t}}})],1),i("q-list",{attrs:{bordered:"",separator:""}},[e.accepted.length?[i("q-item-label",{attrs:{header:""}},[e._v("Accepted Items")]),e._l(e.accepted,(function(t,s){return i("KitchenItemCancelItem",{key:e.hKey("accepted",s,t),attrs:{item:t,token:e.Tokens[t.token],selected:e.selected},on:{select:e.select}})}))]:e._e(),e.processing.length?[i("q-item-label",{attrs:{header:""}},[e._v("Processing Items")]),e._l(e.processing,(function(t,s){return i("KitchenItemCancelItem",{key:e.hKey("processing",s,t),attrs:{item:t,token:e.Tokens[t.token],selected:e.selected},on:{select:e.select}})}))]:e._e(),e.completed.length?[i("q-item-label",{attrs:{header:""}},[e._v("Completed Items")]),e._l(e.completed,(function(t,s){return i("KitchenItemCancelItem",{key:e.hKey("completed",s,t),attrs:{item:t,token:e.Tokens[t.token],selected:e.selected},on:{select:e.select}})}))]:e._e()],2),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{attrs:{push:"",loading:e.$attrs.cancelling,color:"deep-orange",label:"Reset All Selected"},on:{click:function(t){return e.$emit("cancel",e.selected)}}})],1)],1)},ke=[],ge=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-item",{class:{"bg-pink-1":e.yes},attrs:{clickable:""},on:{click:function(t){return e.$emit("select",e.item.id)}}},[i("q-item-section",{staticClass:"text-bold",attrs:{avatar:""}},[i("q-avatar",{attrs:{color:"pink-6","text-color":"white",rounded:"",size:"md"}},[e._v(e._s(e.i("quantity"))+"x")])],1),i("q-item-section",[i("q-item-label",{staticClass:"text-bold"},[e._v(e._s(e.i("item","name"))+" - ("+e._s(e.time)+")")]),i("q-item-label",{attrs:{caption:""}},[e._v("Token: "+e._s(e.t("id"))+", "+e._s(e.t("type")))]),e.item.narration?i("q-item-label",{staticClass:"text-bold"},[e._v(e._s(e.item.narration)+")")]):e._e(),e.t("seating")?i("q-item-label",{attrs:{caption:""}},[e._v("Seating: "+e._s(e.t("seating","name")))]):e._e(),e.t("waiter")?i("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.t("waiter","name")))]):e._e()],1),i("q-item-section",{attrs:{side:""}},[i("q-btn",{attrs:{icon:"done",round:"",push:"",flat:"",color:e.yes?"positive":"grey-3"}})],1)],1)},fe=[],ve={name:"KitchenItemCancelItem",props:["item","token","selected"],computed:{time(){return Object(j["D"])(this.token.date)},yes(){return this.selected.includes(this.item.id)}},methods:{i(...e){return _.get(this.item,e)},t(...e){return _.get(this.token,e)}}},be=ve,qe=Object(f["a"])(be,ge,fe,!1,null,null,null),ye=qe.exports;Q()(qe,"components",{QItem:v["a"],QItemSection:b["a"],QAvatar:L["a"],QItemLabel:q["a"],QBtn:y["a"]});var we=i("5ab9"),xe={name:"KitchenItemCancel",components:{FilterInputText:we["a"],KitchenItemCancelItem:ye},data(){return{selected:[],filter:""}},props:["kitchen"],mixins:[S["a"]],computed:{Tokens(){return _(this.tokens).filter((({progress:e})=>["New","Processing"].includes(e))).keyBy("id").value()},items(){return _(this.Tokens).flatMap("items").filter(this.isAct).value()},filtered(){return""===this.filter?this.items:_.filter(this.items,(({item:{name:e},token:t})=>_.includes(t+" "+_.toLower(e),_.toLower(this.filter))))},accepted(){return _.filter(this.filtered,["progress","Accepted"])},processing(){return _.filter(this.filtered,["progress","Processing"])},completed(){return _.filter(this.filtered,["progress","Completed"])}},methods:{hKey(e,t,{id:i}){return Object(j["e"])("kitchen","item","cancel",e,i,t)},isAct({kitchen:e,progress:t}){return e&&e.id===_.toInteger(this.kitchen)&&["Accepted","Processing","Completed"].includes(t)},select(e){if(this.selected.includes(e))return this.selected=_.difference(this.selected,[e]);this.selected.push(e)}}},Ce=xe,Ie=Object(f["a"])(Ce,_e,ke,!1,null,null,null),Te=Ie.exports;Q()(Ie,"components",{QCard:D["a"],QCardSection:N["a"],QSpace:ne["a"],QBtn:y["a"],QItemSection:b["a"],QList:z["a"],QItemLabel:q["a"],QCardActions:ae["a"]}),Q()(Ie,"directives",{ClosePopup:re["a"]});var Qe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-card-section",{staticClass:"q-py-xs bg-teal"}),i("CardImageTitle",{attrs:{title:e.item.name,image:e.src}}),i("q-list",{attrs:{bordered:"",dense:""}},[e._l(e.data,(function(t,s){return[i("transition-group",{attrs:{appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut",mode:"out-in"}},e._l(t,(function(t,a){return i("KitchenTokenItemLine",e._b({key:e.hKey(a),attrs:{progress:s},on:{action:function(i){e.selected=[s,t]}}},"KitchenTokenItemLine",t,!1))})),1)]}))],2),i("q-card-section",{staticClass:"row items-center q-py-xs"},[i("div",{staticClass:"text-primary"},[e._v("Stock")]),i("q-space"),i("q-avatar",{attrs:{size:"sm","text-color":"white",rounded:"",color:"primary"}},[e._v(e._s(e.iStock))]),i("q-space"),i("div",{staticClass:"text-primary"},[e._v("Total")]),i("q-space"),i("q-avatar",{attrs:{size:"sm","text-color":"white",rounded:"",color:"primary"}},[e._v(e._s(e.total))])],1),i("q-dialog",{attrs:{persistent:"",value:!!e.selected.length}},[i("KitchenTokenItemAction",e._b({staticStyle:{width:"50vw","max-width":"330px"},on:{progress:e.progress}},"KitchenTokenItemAction",e.selected[1],!1))],1)],1)},Oe=[],$e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"bg-grey-1",attrs:{clickable:""},on:{click:function(t){return e.$emit("action")}}},[i("q-item-section",[i("q-item-label",{staticClass:"text-bold",class:"text-"+e.color},[e._v(e._s(e.progress))]),i("q-item-label",{directives:[{name:"show",rawName:"v-show",value:e.Wait,expression:"Wait"}],staticClass:"text-red text-bold",attrs:{caption:""}},[e._v("Wait: "+e._s(e.Wait))]),e.prop("narration")?i("q-item-label",{staticClass:"text-bold",attrs:{caption:""}},[e._v(e._s(e.prop("narration")))]):e._e(),e._l(e.tCount,(function(t,s){return i("q-item-label",{key:e.hKey(e.progress,s,t),attrs:{caption:""}},[e._v(e._s(s)+": "+e._s(t))])}))],2),i("q-item-section",{attrs:{side:""}},[i("q-avatar",{attrs:{size:"md",rounded:"","text-color":"white",color:e.color}},[e._v(e._s(e.prop("total")))])],1),i("q-inner-loading",{attrs:{showing:e.showing,"transition-hide":"fadeOut","transition-show":"fadeIn"}},[i("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)},je=[];var Se={name:"KitchenTokenItemLine",props:["progress","wait"],data(){return{since:0}},computed:{color(){return p["TokenItemProgressColor"][this.progress]},Wait(){let e=_.toInteger(this.wait);return e<=this.since?0:e-this.since},tTokens(){return _.keys(this.prop("token"))},tCount(){return _(this.prop("token")).groupBy("type").mapValues((e=>_.sumBy(e,"quantity"))).value()},showing:{get(){return!!this.Wait},set(){this.since=parseInt(this.wait)}}},methods:{prop(e){return _.get(this.$attrs,e)},hKey(e,t,i){return _.kebabCase(Object(j["e"])(e,t,i))}},watch:{since:{immediate:!0,handler(){return this.Wait?setTimeout((e=>e.since++),1e3,this):null}}}},Ke=Se,Ae=i("714f"),Be=Object(f["a"])(Ke,$e,je,!1,null,null,null),De=Be.exports;Q()(Be,"components",{QItem:v["a"],QItemSection:b["a"],QAvatar:L["a"],QItemLabel:q["a"],QInnerLoading:C["a"],QSpinnerFacebook:I["a"]}),Q()(Be,"directives",{Ripple:Ae["a"]});var Ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-card-section",{staticClass:"bg-teal text-white"},[e.$attrs.narration?i("div",{staticClass:"text-h6 text-center"},[e._v(e._s(e.$attrs.narration))]):i("div",{staticClass:"text-h6 text-center"},[e._v(e._s(e.$attrs.name))])]),i("q-card-actions",[i("q-btn",{attrs:{icon:"done_all",glossy:"",push:"",color:"positive",label:"All"},on:{click:e.all}}),i("q-space"),i("q-btn",{attrs:{icon:"done",glossy:"",push:"",color:"deep-orange-7",label:"Invert "},on:{click:e.invert}})],1),i("q-list",{staticClass:"bg-grey-2",attrs:{bordered:"",separator:""}},e._l(e.$attrs.token,(function(t){return i("q-item",{key:e.hKey(t),class:{"bg-grey-4":e.selected.includes(t.id)},attrs:{clickable:""},on:{click:function(i){return e.clicked(t)}}},[i("q-item-section",{attrs:{avatar:""}},[i("transition",{attrs:{mode:"out-in",appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut"}},[e.selected.includes(t.id)?i("q-avatar",{key:"trg-"+t.token+t.id+"uns",attrs:{icon:"done_all",color:"indigo-7","text-color":"grey-2"}}):e._e()],1)],1),i("q-item-section",[i("q-item-label",[e._v("Token: "+e._s(t.token)+" - ("+e._s(e.time(e.Tokens[t.token].date))+")")]),i("q-item-label",{attrs:{caption:""}},[e._v("Type: "+e._s(t.type))]),e.Tokens[t.token].waiter?i("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.Tokens[t.token].waiter.name))]):e._e(),e.Tokens[t.token].seating?i("q-item-label",{attrs:{caption:""}},[e._v("Seat: "+e._s(e.Tokens[t.token].seating.name))]):e._e()],1),i("q-item-section",{attrs:{side:""}},[i("q-avatar",{attrs:{rounded:"","text-color":"white",color:e.typeColor[t.type]}},[e._v(e._s(t.quantity))])],1)],1)})),1),i("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"left"}},[i("q-btn",{attrs:{flat:"",label:"CLOSE"},on:{click:function(t){return e.$emit("progress")}}}),i("q-space"),i("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"q-py-sm q-px-md",attrs:{label:e.total}}),i("q-space"),i("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",disable:!e.selected.length,round:"",color:"positive"},on:{click:function(t){return e.$emit("progress",e.selected)}}})],1)],1)},Pe=[],Le={name:"KitchenTokenItemAction",components:{CardImageTitle:te["a"]},data(){return{selected:[],typeColor:p["DiningTypeColor"]}},mixins:[S["a"]],computed:{tkn(){return _.map(this.$attrs.token,"token")},ids(){return _.map(this.$attrs.token,"id")},Tokens(){return _(this.tokens).filter((({id:e})=>this.tkn.includes(e))).keyBy("id").value()},total(){let e=this.selected;return"TOTAL: "+_.sumBy(_.values(this.$attrs.token),(({quantity:t,id:i})=>e.includes(i)?t:0))}},methods:{hKey({id:e,token:t}){return Object(j["e"])("kitchen","token",t,"bundle","action","id",e)},time(e){return Object(j["D"])(e)},clicked({id:e}){this.selected.includes(e)?this.selected=_.difference(this.selected,[e]):this.selected.push(e)},all(){this.selected=this.ids},invert(){_.forEach(this.ids,(e=>this.clicked({id:e})))}}},Ee=Le,ze=Object(f["a"])(Ee,Ne,Pe,!1,null,null,null),Re=ze.exports;Q()(ze,"components",{QCard:D["a"],QCardSection:N["a"],QCardActions:ae["a"],QBtn:y["a"],QSpace:ne["a"],QList:z["a"],QItem:v["a"],QItemSection:b["a"],QAvatar:L["a"],QItemLabel:q["a"],QBadge:x["a"]});let We=null;var Fe={name:"KitchenTokenItem",components:{KitchenTokenItemAction:Re,KitchenTokenItemLine:De,CardImageTitle:te["a"]},data(){return{src:Object(j["i"])(this.item.image),selected:[],waits:[],showing:!0,status:{New:"accept",Accepted:"process",Processing:"complete"}}},props:["details","item","kitchen","stock"],computed:{data(){this.waits.length;return _.mapValues(_.groupBy(this.details,"progress"),this.dist)},iStock(){return _.get(this.stock,this.kitchen)},total(){return _.sumBy(this.details,"quantity")}},methods:{hKey(e){return Object(j["e"])("kitchen",this.kitchen,"token","item","line",e)},dist(e){return _(e).groupBy(this.crypt).mapValues(this.itmObj).value()},itmObj(e){let t=e[0];return Object.assign({},this.pure(t),{total:_.sumBy(e,"quantity"),token:_(e).keyBy("token").mapValues((({token:e,id:t,user:i,quantity:s,type:a})=>new Object({token:e,id:t,user:i,quantity:s,type:a}))).value()})},pure({item:{id:e,name:t},delay:i,narration:s}){return{wait:this.getWait(i),narration:s,name:t,item:e}},crypt({delay:e,item:{id:t},narration:i}){return Object(j["c"])([t,this.getWait(e),i].join("|"))+""},getWait(e){let t=_.toInteger(e)-Object(j["t"])();return t<0?0:(this.waits.includes(t)||this.waits.push(t),t)},bgClrCls(e){return"bg-"+p["TokenItemProgressColor"][e]},progress(e){this.post(this.selected[0],0,e,this.kitchen)},post(e,t,i,s){if(!i||i.length<=t)return this.selected=[];post("token",this.status[e],{id:i[t],kitchen:s}).then((()=>setTimeout(this.post,300,e,t+1,i,s)))}},watch:{waits(e){return e.length?We=setTimeout((e=>e.waits=[]),1e3*_.min(this.waits),this,clearTimeout(We)):null}}},Me=Fe,Ve=Object(f["a"])(Me,Qe,Oe,!1,null,null,null),Ye=Ve.exports;Q()(Ve,"components",{QCard:D["a"],QCardSection:N["a"],QSpace:ne["a"],QAvatar:L["a"],QList:z["a"],QItem:v["a"],QItemSection:b["a"],QIcon:E["a"],QItemLabel:q["a"],QDialog:me["a"]});var He=i("c624"),Ue=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[e.multiple?e._e():i("q-card-section",{staticClass:"q-pa-xs",class:e.dtColor}),i("q-card-section",{staticClass:"bg-grey-2 row justify-between items-center q-py-sm"},[i("div",{staticClass:"text-bold text-white text-weight-bolder q-gutter-x-xs"},[i("q-badge",{staticClass:"q-py-sm q-px-sm",class:e.dtColor,attrs:{label:e.remote_token.location}}),i("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.token_ref,expression:"token_ref"}],staticClass:"q-py-sm q-px-sm",class:e.dtColor,attrs:{label:e.token_ref}})],1),i("div",{staticClass:"text-bold"},[e._v(e._s(e.token_time))])]),i("q-list",{staticClass:"bg-grey-1",attrs:{bordered:"",separator:""}},e._l(e.items,(function(t){return i("TokenDetailCardItem",{key:e.hKey(t),attrs:{token:e.token,item:t,kitchen:e.kitchen,offline_reference:e.items_offline_reference[t.id]},on:{photo:e.photo}})})),1),i("q-dialog",{attrs:{persistent:""},model:{value:e.view_image,callback:function(t){e.view_image=t},expression:"view_image"}},[i("q-card",{staticStyle:{"min-width":"75vw"},attrs:{flat:""}},[i("q-bar",{staticClass:"bg-secondary text-white"},[i("q-space"),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[i("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[e._v("Close")])],1)],1),i("q-card-section",[i("q-img",{attrs:{src:e.image_url}})],1)],1)],1)],1)},Je=[],Ge=i("8808"),Xe=i("de36"),Ze={name:"TokenDetailCardRemote",components:{TokenDetailCardItem:$},props:["id","kitchen","multiple"],data(){return{view_image:!1,image_url:""}},computed:c()(c()({},Object(h["d"])({token:function({tokens:{data:e,items:t},seating:i,users:s,customers:a}){let n=_.get(e,this.id);return Object.assign({},n,{waiter:_.get(s,["data",n.user,"name"]),seat:_.get(i,["data",n.seating,"name"]),items:t[n.id],customer:_.get(a,["data",n.customer])})},remote_token:function({remote:{data:e}}){return _.find(e,(({local_id:e,item:t})=>"tokens"===t&&_.toInteger(e)===_.toInteger(this.id)))||{}},rtk:function(e){return _.filter(e.remote.data,{item:"tokens"})},img_cache:function({tokens:{img:e}}){return e}})),{},{token_time(){return this.token.date_human},token_ref(){return this.remote_token.reference},items(){return _(this.token.items).map((e=>Object.assign({},e,et(e)))).value()},items_offline_reference(){return _(this.items).mapKeys((({id:e})=>_.toInteger(e))).mapValues((({id:e})=>_.get(_.find(this.$store.state.remote.data,{local_id:parseInt(e),item:"token_items"}),["extra","offline_reference"]))).value()},dtColor(){return"bg-"+this.items[0].say_color}}),methods:{hKey({token:e,item:t,id:i}){return Object(j["e"])("token",e,"item","detail",t,"id",i)},photo(e){if(_.has(this.img_cache,e))return this.view_image=!!(this.image_url=this.img_cache[e]);Object(Xe["j"])(e).then((t=>this.photo(e,this.$store.commit("tokens/image",{name:e,url:t},{root:!0}))))}}};function et({deliver:e}){return Object(Ge["f"])(e)}var tt=Ze,it=i("d847"),st=i("05c0"),at=Object(f["a"])(tt,Ue,Je,!1,null,null,null),nt=at.exports;Q()(at,"components",{QCard:D["a"],QCardSection:N["a"],QBadge:x["a"],QList:z["a"],QDialog:me["a"],QBar:it["a"],QSpace:ne["a"],QBtn:y["a"],QTooltip:st["a"],QImg:J["a"]}),Q()(at,"directives",{ClosePopup:re["a"]});var rt={name:"KitchenTokens",mixins:[S["a"]],components:{TokenDetailCardRemote:nt,Masonry:He["a"],KitchenTokenItem:Ye,KitchenItemCancel:Te,KitchenTokenDisplayMode:pe["a"],KitchenTokenBundle:he,TokenDetailCard:W},props:["id","card"],data(){return{processing:["Accepted","Processing"],cancelling:!1}},computed:c()(c()(c()({},Object(h["d"])({kitchen({kitchens:{data:e}}){return _.get(e,_.toInteger(this.id))},kItems({kitchens:{items:e}}){return _.map(e[this.kitchen.id],"item")}})),{},{cloud(){return"Yes"===this.kitchen.cloud},mode(){return _.get(this.$store.state,["public","mode"],"Token")},reset:{get(){return _.get(this.$store.state,["public","reset"],!1)},set(e){return this.$store.commit("public",{reset:!!e})}}},Object(h["b"])("kitchens",["stock"])),{},{pView(){return this.$q.screen.width>799},Tokens(){return _(this.tokens).filter((({progress:e,items:t})=>["New","Processing"].includes(e)&&_.some(t,this.isAct))).value()},items(){return _(this.Tokens).flatMap((({items:e,type:t})=>_(e).filter(this.isAct).map((e=>Object.assign({},e,{type:t}))).value())).groupBy("item.id").value()},sTokens(){return _.sortBy(this.Tokens,(({items:e})=>Object(Ge["j"])(e)))}}),methods:{popup_width:j["y"],hKey({id:e},t){return Object(j["e"])("kitchen",this.id,t,"detail",e)},isAct({item:{id:e},progress:t,kitchen:i}){return"New"===t&&_.includes(this.kItems,e)||i&&i.id===this.kitchen.id&&this.processing.includes(t)},doReset(e){e.length&&(this.cancelling=!0),this.post(0,e,this.id)},getItem(e){return _.get(e,[0,"item"])},getStock(e){return _.get(this.stock,this.getItem(e)["id"])},post(e,t,i){if(!t||0===t.length||t.length<=e)return this.reset=this.cancelling=!1;post("token","reset",{id:t[e],kitchen:i}).then((()=>setTimeout(this.post,300,e+1,t,i)))}},watch:{Tokens(e,t){(!t||e.length>t.length)&&Object(j["b"])()}}},ot=rt,ct=Object(f["a"])(ot,n,r,!1,null,null,null),lt=ct.exports;Q()(ct,"components",{QCard:D["a"],QCardSection:N["a"],QDialog:me["a"]});var dt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-bar",{staticClass:"text-grey-1",class:"bg-"+e.color+"-7"},[i("span",{staticClass:"text-caption"},[e._v("Add Remote Order - Offline")]),i("q-space"),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",dense:""}})],1),e.reference?[i("q-card-section",{staticClass:"q-py-md bg-grey-1 text-center",class:"text-"+e.color},[i("div",{staticClass:"text-h5 text-bold"},[e._v(e._s(e.r_ref))])]),i("q-card-section",{staticClass:"q-gutter-y-xs q-pt-none q-pb-xs"},[i("div",{staticClass:"row q-col-gutter-xs"},[i("q-input",{staticClass:"col-12",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Token",value:e.reference.token_date_code}}),i("q-input",{staticClass:"col",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Item",value:e.reference.server[1].item}}),i("q-input",{staticClass:"col",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Quantity",value:e.reference.server[1].quantity}})],1),i("q-input",{attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Delivery",value:e.reference.server[1].deliver}}),i("q-input",{staticStyle:{height:"6rem"},attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Narration",value:e.reference.server[1].narration,type:"textarea"}})],1)]:i("q-card-section",{staticClass:"q-gutter-y-xs q-pb-xs"},[i("q-file",{attrs:{clearable:"",outlined:"",dense:"","input-class":"text"+e.color,label:"Import File","bottom-slots":"","hide-bottom-space":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"cloud",color:e.color}})]},proxy:!0}]),model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),i("div",{staticClass:"row q-gutter-xs"},[i("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Token Code"},model:{value:e.params.token_date_code,callback:function(t){e.$set(e.params,"token_date_code",t)},expression:"params.token_date_code"}}),i("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Location"},model:{value:e.ti_location,callback:function(t){e.ti_location=t},expression:"ti_location"}}),i("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"ID",type:"number"},model:{value:e.ti_id,callback:function(t){e.ti_id=e._n(t)},expression:"ti_id"}})],1),i("div",{staticClass:"row q-gutter-x-xs"},[i("q-select",{staticClass:"col-9",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Select Item",options:e.items,"option-label":"name"},model:{value:e.params.item,callback:function(t){e.$set(e.params,"item",t)},expression:"params.item"}}),i("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Quantity",type:"number"},model:{value:e.params.quantity,callback:function(t){e.$set(e.params,"quantity",e._n(t))},expression:"params.quantity"}})],1),i("DateTime",{attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Delivery"},model:{value:e.params.deliver,callback:function(t){e.$set(e.params,"deliver",t)},expression:"params.deliver"}}),i("q-input",{staticStyle:{height:"6rem"},attrs:{outlined:"","input-class":"text-"+e.color,label:"Narration",type:"textarea"},model:{value:e.params.narration,callback:function(t){e.$set(e.params,"narration",t)},expression:"params.narration"}})],1),i("q-card-actions",{staticClass:"q-px-md q-pt-none"},[e.reference?i("q-btn",{attrs:{label:"Clear Upload",color:"red",dense:"",flat:"",size:"sm"},on:{click:function(t){e.file=null}}}):e._e(),i("q-space"),i("q-btn",{attrs:{label:e.reference?"Import Data":"Add Order",color:e.color,glossy:"",padding:"sm xl",loading:e.loading},on:{click:e.addOrder}})],1),i("q-dialog",{attrs:{persistent:"",value:!0!==e.verified},on:{"before-hide":function(t){e.file=null}}},[i("q-card",{staticClass:"bg-red text-white",staticStyle:{"min-width":"65vw"}},[i("q-card-section",{staticClass:"bg-red-7"},[i("div",{staticClass:"text-h6"},[e._v("Error")])]),i("q-card-section",{staticClass:"text-caption"},[e._v("\n          The uploaded file is not valid because of any of the following reason.\n          "),i("li",{class:{"text-bold":0===e.verified}},[e._v("The uploaded data is corrupted")]),i("li",{class:{"text-bold":1===e.verified}},[e._v("The uploaded data is not for this kitchen")]),i("li",{class:{"text-bold":2===e.verified}},[e._v("The items are not processing in this kitchen")]),i("li",{class:{"text-bold":3===e.verified}},[e._v("The reference name is not provided")]),i("li",{class:{"text-bold":4===e.verified}},[e._v("The item is already present in this kitchen")])]),i("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Clear File",color:"red-6"}})],1)],1)],1)],2)},mt=[],ut=(i("4d90"),i("5dee")),ht=i("adfa"),pt={name:"AddRemoteOrder",components:{DateTime:ut["a"]},props:["kitchen"],data(){return{color:"light-blue",ti_location:"",ti_id:"",loading:!1,params:{name:null,item:null,quantity:null,deliver:null,narration:null,token_date_code:""},file:null,reference:null,verified:!0}},computed:c()(c()(c()({},Object(h["b"])("remote",["item_id_of_kitchen_item"])),Object(h["d"])({items({items:e,remote:t}){return _(t.data).filter({item:"kitchen_items",location:ht["BRANCH_CODE"]}).map((e=>Object.assign({},{kitchen_item_id:e.local_id,kitchen_item_reference:e.reference,kitchen_item_location:e.location,item_id:this.item_id_of_kitchen_item(e.local_id)}))).map((t=>Object.assign({},t,_.get(e.data,t.item_id)))).value()},offline_remotes({remote:e}){return _(e.data).filter((({extra:e})=>_.has(e,"r_ref"))).keyBy("extra.r_ref").value()}})),{},{kitchen_reference(){return _.get(_.find(this.$store.state.remote.data,{item:"kitchens",local_id:this.kitchen}),"reference")},kitchen_item_references(){return _.map(this.items,"kitchen_item_reference")},r_ref(){return _.get(this.reference,"name")},ref_make(){return this.ti_location+"TI"+_.padStart(this.ti_id,6,0)},reference_exists(){return this.reference?_.has(this.offline_remotes,this.reference.name)&&this.offline_remotes[this.reference.name].reference===this.reference.token_item_reference:null},kitchen_remote(){return _.find(this.$store.state.remote.data,{item:"kitchens",local_id:parseInt(this.kitchen)})}}),methods:{setReference(e){this.reference=e?JSON.parse(_.get(e,["target","result"])):null,e&&this.verifyReference()},verifyReference(){return this.reference?this.kitchen_reference!==_.get(this.reference,["server",1,"kitchen"])?this.verified=1:this.reference.kitchen_item_location===ht["BRANCH_CODE"]&&this.kitchen_item_references.includes(this.reference.kitchen_item_reference)?this.reference.name?this.reference_exists?this.verified=4:void 0:this.verified=3:this.verified=2:this.verified=0},addOrder(){if(this.reference)this.loading=!0,this.$store.dispatch("remote/addOffline",{offline_reference:this.reference.name,data:this.reference,kitchen:this.kitchen},{root:!0});else{if(!_.every(_.pick(this.params,["name","item","quantity","deliver","token_date_code"])))return this.$q.notify({textColor:"white",message:"All except narration is mandatory, please fill them all..",type:"negative",position:"center",closeBtn:"Try Again"});{let e=[{date:Object(j["E"])("YYYY-MM-DD HH:mm:ss",new Date),narration:this.params.narration,progress:"New"},{quantity:1,narration:this.params.narration,deliver:this.params.deliver,photo:null,progress:"Accepted",kitchen:this.kitchen_remote.reference,item:this.params.item.name,kitchen_item_reference:_.get(this.params,["item","kitchen_item_reference"]),kitchen_item_location:_.get(this.params,["item","kitchen_item_location"]),token:null,detail:this.params.item.detail,status:this.params.item.status}],t={token_source_location:this.ti_location,token_reference:null,token_item_reference:null,token_item_source_id:this.ti_id,name:this.params.name,server:e,token_date:_t(this.params.token_date_code),token_date_code:this.params.token_date_code};this.$store.dispatch("remote/addOffline",{offline_reference:this.params.name,data:t,kitchen:this.kitchen},{root:!0})}}setTimeout((function(e){e.loading=!1,e.$emit("imported")}),1e3,this)}},watch:{file(e){if(!e)return this.setReference(e);let t=new FileReader;t.onload=this.setReference,t.readAsText(e)},ref_make(e){this.params.name=e},ti_location(e){_.toUpper(e)!==e&&(this.ti_location=_.toUpper(e))}}};function _t(e){let t={4:"-",6:"-",8:" ",10:":",12:":"},i=e.split(""),s="";for(let a in i)s+=(_.has(t,a)?t[a]:"")+i[a];return s}var kt=pt,gt=i("27f9"),ft=i("7d53"),vt=i("ddd8"),bt=Object(f["a"])(kt,dt,mt,!1,null,null,null),qt=bt.exports;Q()(bt,"components",{QCard:D["a"],QBar:it["a"],QSpace:ne["a"],QBtn:y["a"],QCardSection:N["a"],QInput:gt["a"],QFile:ft["a"],QIcon:E["a"],QSelect:vt["a"],QCardActions:ae["a"],QDialog:me["a"]}),Q()(bt,"directives",{ClosePopup:re["a"]});const{SK85W:yt}=i("adfa").FEATURES;var wt={name:"PageTokens",components:{AddRemoteOrder:qt,KitchenTokens:lt},data(){return{offline_order:!1}},computed:{kitchen(){return _.get(this.$store.state.kitchens.data,_.toInteger(this.$store.state.public.kitchen),null)},cloud(){return"Yes"===_.get(this.kitchen,"cloud")&&"Yes"===yt},reset:{get(){return!!_.get(this.$store.state,["public","reset"],!1)},set(e){this.$store.commit("public",{reset:!!e})}}}},xt=wt,Ct=i("9989"),It=i("de5e"),Tt=Object(f["a"])(xt,s,a,!1,null,null,null);t["default"]=Tt.exports;Q()(Tt,"components",{QPage:Ct["a"],QPageSticky:It["a"],QBtn:y["a"],QDialog:me["a"]})}}]);