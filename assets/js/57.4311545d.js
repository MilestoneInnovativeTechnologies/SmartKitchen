(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[57],{"458d":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("q-page",{directives:[{name:"scroll",rawName:"v-scroll",value:e.scrolled,expression:"scrolled"}],attrs:{padding:""}},[t("Masonry",{attrs:{width:"280",items:e.showing},scopedSlots:e._u([{key:"item",fn:function(e){return[t("OrderSummaryWaiterOrder",{attrs:{token:e}})]}}])}),t("Pagination",{attrs:{records:e.Tokens},model:{value:e.showing,callback:function(t){e.showing=t},expression:"showing"}}),t("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[t("q-page-sticky",{directives:[{name:"show",rawName:"v-show",value:e.fab||!e.Tokens.length,expression:"fab || !Tokens.length"}],attrs:{position:"bottom-right",offset:e.offset}},[t("q-fab",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:e.move,expression:"move",modifiers:{prevent:!0,mouse:!0}}],attrs:{icon:"add",color:"primary",glossy:"",to:{name:"order_new",params:{seat:!0,user:e.$route.meta.me.id,type:"Dining"}}}})],1)],1)],1)},s=[],i=(a("caad"),a("b1c1")),r=a("1c16"),o=a("c624"),l=a("1799"),c=a("58d1"),d=function(){var e=this,t=e._self._c;return t("q-card",[t("CardImageTitle",{attrs:{image:e.src,title:e.seat.name}}),t("q-card-actions",[t("q-badge",{staticClass:"q-py-sm q-px-sm",attrs:{label:e.token.id}}),t("q-badge",{staticClass:"q-py-sm q-ml-sm",attrs:{label:e.token.progress}}),t("q-space"),t("div",{staticClass:"q-gutter-x-xs"},[t("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.token_items_selected.length,expression:"token_items_selected.length"}],attrs:{loading:e.TIS_loading,icon:"how_to_reg",color:"primary",size:"sm",padding:"xs"},on:{click:e.serve_selected_token_items}}),e.can_generate_bill&&!e.bill?t("q-btn",{attrs:{icon:"receipt_long",color:"secondary",size:"sm",padding:"xs"},on:{click:function(t){e.bill_generate_mode=!0}}}):e._e(),e.can_make_payment&&e.can_pay?t("q-btn",{attrs:{icon:"payments",color:"green-10",size:"sm",padding:"xs"},on:{click:function(t){e.collect_payment_mode=!0}}}):e._e(),e.can_update?t("q-btn",{attrs:{icon:"rule",color:"warning",size:"sm",padding:"xs"},on:{click:function(t){e.manage_mode=!0}}}):e._e()],1)],1),t("OrderSummaryWaiterOrderItemsList",{attrs:{token:e.token,selected:e.token_items_selected},on:{select:e.token_item_select}}),t("BrowserPrintCardActions",{attrs:{token:e.token}}),t("q-dialog",{attrs:{persistent:""},model:{value:e.bill_generate_mode,callback:function(t){e.bill_generate_mode=t},expression:"bill_generate_mode"}},[t("div",{style:e.popup_width()},[t("TokenBillGenerate",{attrs:{token:e.token,close:!0},on:{generated:function(t){e.bill_generate_mode=!1}}})],1)]),t("q-dialog",{attrs:{persistent:""},model:{value:e.collect_payment_mode,callback:function(t){e.collect_payment_mode=t},expression:"collect_payment_mode"}},[t("PaymentCollectCard",{style:e.popup_width(),attrs:{bill:e.token.bill},on:{paid:function(t){e.collect_payment_mode=!1}}})],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.manage_mode,callback:function(t){e.manage_mode=t},expression:"manage_mode"}},[t("OrderSummaryItemsManage",{style:e.popup_width(),attrs:{token:e.token},on:{close:function(t){e.manage_mode=!1},done:function(t){e.manage_mode=!1}}})],1)],1)},m=[],u=a("a861"),p=a("43fa"),g=a("ba49"),b=a("4092"),h=a("1379"),k=a("626b"),f=a("36d9"),y={name:"OrderSummaryWaiterOrder",components:{BrowserPrintCardActions:f["a"],OrderSummaryItemsManage:h["a"],PaymentCollectCard:b["a"],TokenBillGenerate:g["a"],CardImageTitle:p["a"],OrderSummaryWaiterOrderItemsList:u["a"]},props:["token"],data(){return{manage_mode:!1,bill_generate_mode:!1,collect_payment_mode:!1}},mixins:[k["a"]],computed:{seat(){return _.get(this.token,"seating")},src(){return Object(i["i"])(this.seat.image)},can_generate_bill(){return!1!==Object(i["B"])(settings("waiter_generate_bills"))},can_make_payment(){return!1!==Object(i["B"])(settings("waiter_make_payments"))},filter_progress(){return _.concat(!1!==Object(i["B"])(settings("waiter_generate_bills"))?["Completed"]:[],!1!==Object(i["B"])(settings("waiter_make_payments"))?["Pending","Partial"]:[])},bill(){return _.get(this.token,"bill")},can_pay(){return this.bill&&"Paid"!==_.get(this.bill,"progress")},can_update(){return!this.bill||(!0===Object(i["B"])(settings("enable_billed_dining_token_update"))||!1!==Object(i["B"])(settings("enable_billed_dining_token_update"))&&!0===Object(i["B"])(settings("enable_billed_token_update")))}},methods:{popup_width:i["y"]}},w=y,v=a("2877"),O=a("f09f"),q=a("4b7e"),x=a("58a8"),P=a("2c91"),B=a("9c40"),C=a("24e8"),j=a("eebe"),S=a.n(j),T=Object(v["a"])(w,d,m,!1,null,null,null),I=T.exports;S()(T,"components",{QCard:O["a"],QCardActions:q["a"],QBadge:x["a"],QSpace:P["a"],QBtn:B["a"],QDialog:C["a"]});var Q={name:"PageDiningOrders",components:{OrderSummaryWaiterOrder:I,Pagination:l["a"],Masonry:o["a"]},mixins:[c["a"]],data(){return{fab:!0,timeout:0,offset:[24,24],showing:null,progress_includes:{Billed:[],Paid:["Pending","Partial"]}}},computed:{settings_progress(){let e=settings("keep_tokens_in_waiter_orders_until");return void 0!==e?e:settings("keep_tokens_in_orders_until")||"Billed"},progresses(){return _.concat(["New","Processing","Completed"],this.progress_includes[this.settings_progress])},Tokens(){return _(this.tokens).filter(this.mine).map((e=>Object.assign({},e,{bill:this.token_bill[e.id]}))).reverse().value()},me(){return _.get(this.$route,["meta","me","id"])},receptionists(){return _(this.$store.state.users.data).filter(["role","Receptionist"]).map((e=>_.toSafeInteger(e.id))).value()},allowable_users(){return _.concat(null,this.me,this.receptionists)}},methods:{mine({progress:e,type:t,user:a}){return"Dining"===t&&this.progresses.includes(e)&&_.includes(this.allowable_users,a)},hKey({id:e}){Object(i["e"])("order","summary","order",e)},scrolled:Object(r["a"])((function(){this.fab=!1}),500,!0),move(e){this.offset=[this.offset[0]-e.delta.x,this.offset[1]-e.delta.y]}},watch:{fab:{immediate:!0,handler:function(e){e||(clearTimeout(this.timeout),this.timeout=setTimeout((e=>e.fab=!0),1500,this))}}}},N=Q,W=a("9989"),z=a("de5e"),D=a("c294"),M=a("4396"),A=a("75c3"),$=Object(v["a"])(N,n,s,!1,null,null,null);t["default"]=$.exports;S()($,"components",{QPage:W["a"],QPageSticky:z["a"],QFab:D["a"]}),S()($,"directives",{Scroll:M["a"],TouchPan:A["a"]})}}]);