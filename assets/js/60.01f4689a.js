(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[60],{"6f77":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[e.remote?e._e():i("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"No remote kitchen feature enabled"}}),e.reference?e._e():i("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"Remote Kitchen Reference is missing in subscription"}}),e.client?e._e():i("Jumbotron",{staticClass:"text-center text-red",attrs:{text:"Remote kitchen client is not enabled"}}),e.remote&&e.reference&&e.client?[0===Object.keys(e.remote_records).length?i("div",{staticClass:"text-center"},[i("q-btn",{attrs:{label:"Load from Server",color:"primary",icon:"file_download"},on:{click:e.load_data}})],1):i("div",{staticClass:"q-gutter-y-sm"},e._l(e.remote_records,(function(t,a){return i("q-card",{key:a},[i("q-card-section",{staticClass:"text-bold bg-secondary text-white flex justify-between items-center"},[i("div",[i("q-icon",{directives:[{name:"show",rawName:"v-show",value:e.local_records.hasOwnProperty(a),expression:"local_records.hasOwnProperty(ref)"}],attrs:{name:"done_all",color:"white",size:"xs"}}),e._v(" "+e._s(t.name)+" (Auto Accept: "+e._s(t.auto_accept)+")")],1),i("div",[e._v(e._s(t._location))])]),i("q-list",{attrs:{separator:""}},e._l(t.items,(function(t,s){return i("q-item",{key:"rkm-rk-"+a+"-ki-idx-"+s},[i("q-item-section",{attrs:{top:""}},[i("q-item-label",{staticClass:"text-positive text-bold"},[e._v(e._s(t.item))]),i("q-item-label",{attrs:{caption:""}},[i("div",{staticClass:"flex justify-between"},[i("div",[e._v("Auto Process")]),i("div",[e._v(e._s(t.auto_process))])]),i("div",{staticClass:"flex justify-between"},[i("div",[e._v("Auto Complete")]),i("div",[e._v(e._s(t.auto_complete))])]),i("div",{staticClass:"flex justify-between"},[i("div",[e._v("Duration")]),i("div",[e._v(e._s(t.duration))])]),i("div",{staticClass:"flex justify-between"},[i("div",[e._v("Stock")]),i("div",[e._v(e._s(t.stock))])])])],1),i("q-item-section",{staticClass:"text-center",attrs:{side:""}},[i("q-icon",{attrs:{name:"forward",color:"primary"}})],1),i("q-item-section",{attrs:{"v-bind":{top:e.local_records.hasOwnProperty(a)}}},[e.local_records.hasOwnProperty(a)?[i("q-item-label",{staticClass:"text-positive text-bold"},[e._v(e._s(e.kitchen_item_name(a,t.id)))]),i("q-item-label",{attrs:{caption:""}},e._l(e.kitchen_item_prices(a,t.id),(function(t,r,n){return i("div",{key:"rkm-rk-"+a+"-ki-idx-"+s+"-pr-"+n,staticClass:"flex justify-between"},[i("div",[e._v(e._s(r))]),i("div",[e._v(e._s(t))])])})),0)]:i("div",{staticClass:"text-center"},[i("q-btn",{attrs:{label:"Add",color:"secondary"},on:{click:function(i){e.manage={ref:a,item:t}}}})],1)],2),i("q-item-section",{directives:[{name:"show",rawName:"v-show",value:e.local_records.hasOwnProperty(a),expression:"local_records.hasOwnProperty(ref)"}],attrs:{side:""}},[i("q-btn",{attrs:{icon:"edit",round:"",dense:"",flat:"",color:"primary"},on:{click:function(i){e.manage={ref:a,item:t}}}})],1)],1)})),1)],1)})),1),i("q-dialog",{attrs:{persistent:""},model:{value:e.manage,callback:function(t){e.manage=t},expression:"manage"}},[i("RemoteKitchenItemManage",e._b({style:e.popup_width(),on:{close:function(t){e.manage=!1}}},"RemoteKitchenItemManage",e.manage_attrs,!1))],1)]:e._e()],2)},s=[],r=(i("e6cf"),i("498a"),i("ddb0"),i("ded3")),n=i.n(r),c=i("ec70"),o=i("de36"),l=i("2f62"),m=i("b1c1"),d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",[i("q-card-section",{staticClass:"bg-grey-2 text-bold text-caption justify-between items-center q-px-sm q-py-sm",attrs:{horizontal:""}},[i("div",[e._v("Manage Kitchen Item of Remote")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",round:"",dense:"",flat:""}})],1),e.kitchen?i("q-card-section",{staticClass:"q-gutter-y-sm"},[i("q-select",{attrs:{outlined:"",label:"Item Add Type",options:["Map","Create"]},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),"Map"===e.type?i("q-select",{attrs:{options:e.item_master,outlined:""},model:{value:e.map,callback:function(t){e.map=t},expression:"map"}}):i("q-form",{staticClass:"q-gutter-y-sm"},[i("q-input",{attrs:{outlined:"",label:"Name"},model:{value:e.item_params.item,callback:function(t){e.$set(e.item_params,"item",t)},expression:"item_params.item"}}),i("q-input",{staticStyle:{height:"5rem"},attrs:{outlined:"",label:"Detail",type:"textarea"},model:{value:e.item_params.detail,callback:function(t){e.$set(e.item_params,"detail",t)},expression:"item_params.detail"}}),i("div",{staticClass:"text-subtitle2"},[e._v("Prices")]),i("div",{staticClass:"row q-col-gutter-xs"},e._l(e.item_prices,(function(t){var a=t.id,s=t.name;return i("div",{key:"rkim-ip-p-"+a,staticClass:"col-xs-6 col-md-4"},[i("q-input",{attrs:{outlined:"",label:s,type:"number"},model:{value:e.item_params.prices[a],callback:function(t){e.$set(e.item_params.prices,a,e._n(t))},expression:"item_params.prices[id]"}})],1)})),0)],1)],1):i("q-card-section",{staticClass:"text-center q-gutter-y-sm text-primary text-uppercase text-bold"},[e._v("\n    Kitchen not added\n    "),i("q-btn",{attrs:{label:"Click here to add kitchen",color:"primary"},on:{click:function(t){return e.addKitchen()}}})],1),i("q-card-actions",{directives:[{name:"show",rawName:"v-show",value:e.kitchen,expression:"kitchen"}],staticClass:"q-px-md bg-grey-2",attrs:{align:"right"}},[i("q-btn",{attrs:{color:"primary",label:"Save Details"},on:{click:e.addKitchenItem}})],1),i("q-inner-loading",{attrs:{showing:e.loading}},[i("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)},p=[];i("a79d");const u=["id","item","detail","_location","_monitor","reference","kitchen","status","stock","duration","auto_process","auto_complete","prices"],h=["name","auto_accept","cloud","status","online","users","reference","_location","_monitor"];var f={name:"RemoteKitchenItemManage",props:["local","item","remote"],computed:n()(n()({},Object(l["d"])({price_lists:e=>e.prices.list,item_master:e=>_.map(e.items.data,(e=>Object.assign({},e,{value:e.id,label:e.name})))})),{},{kitchen_item_id(){return _.get(_.findLast(this.$store.state.remote.data,{item:"kitchen_items",reference:this.item.id}),"local_id")},item_id(){return this.item_params.id||this.$store.getters["remote/item_id_of_kitchen_item"](this.kitchen_item_id)},kitchen(){return this.local?_.get(this.$store.state.kitchens.data,_.get(this.local,"local_id")):null},item_data(){return Object.assign({},this.item,{reference:this.item.id,id:this.item_id,prices:{}})},item_prices(){let e=_.get(this.$store.getters["items/prices"],this.item_id,{});return _.map(this.price_lists,(({name:t,id:i})=>new Object({id:i,name:t,price:_.get(e,i,0)})))},map:{get(){return _.find(this.item_master,{value:this.item_params.id})||null},set(e){this.item_params.id=e.value}},type:{get(){return this.v_type},set(e){this.v_type=e,this.item_params.id=void 0}},kitchen_params(){return _.fromPairs([..._.map(h,(e=>[e,_.get(this.remote,e)])),["reference",this.remote.id]])}}),data(){return{loading:!1,v_type:"Map",item_params:_.zipObject(u,Array(u.length).fill(null))}},methods:{addKitchen(){this.loading=!0,post("remote","kitchens",this.kitchen_params).then().catch().finally((()=>setTimeout((e=>e.loading=!1),750,this)))},addKitchenItem(){this.loading=!0,post("remote","kitchen_items",this.item_params).then().catch().finally((()=>setTimeout((e=>e.loading=e.$emit("close")&&!1),750,this)))}},watch:{item:{immediate:!0,handler(){setTimeout((function(e){let t=_.cloneDeep(e.item_data);e.loading=!0,_.forEach(_.cloneDeep(e.item_params),(function(i,a){i!==t[a]&&e.$set(e.item_params,a,t[a])})),_.forEach(_.cloneDeep(e.item_prices),(({id:t,price:i})=>e.$set(e.item_params.prices,t,_.toNumber(i)))),e.loading=!1}),200,this)}}}},v=f,g=i("2877"),b=i("f09f"),k=i("a370"),y=i("9c40"),x=i("ddd8"),q=i("0378"),w=i("27f9"),C=i("4b7e"),j=i("74f7"),O=i("e669"),Q=i("7f67"),K=i("eebe"),I=i.n(K),P=Object(g["a"])(v,d,p,!1,null,null,null),$=P.exports;I()(P,"components",{QCard:b["a"],QCardSection:k["a"],QBtn:y["a"],QSelect:x["a"],QForm:q["a"],QInput:w["a"],QCardActions:C["a"],QInnerLoading:j["a"],QSpinnerFacebook:O["a"]}),I()(P,"directives",{ClosePopup:Q["a"]});const{CC71V:R,DP71V:A,KK99V:N}=i("adfa").FEATURES;var S={name:"PageRemoteKitchenManage",components:{RemoteKitchenItemManage:$,Jumbotron:c["a"]},data(){return{remote:"Yes"===R,reference:_.trim(A),client:"Yes"===N,remote_records:{},v_manage:null}},computed:n()(n()(n()({},Object(l["d"])({remotes:e=>e.remote.data,kitchen_master:e=>e.kitchens.data,kitchen_items:e=>e.kitchens.items,item_master:e=>e.items.data,price_master:e=>e.prices.list})),Object(l["b"])({prices:"items/prices"})),{},{kitchen_item_reference(){return _(this.remotes).filter(["item","kitchen_items"]).mapKeys("local_id").mapValues("reference").value()},local_records(){return _(this.remotes).filter(["item","kitchens"]).mapKeys("reference").mapValues((e=>Object.assign({},e,_.get(this.kitchen_master,e.local_id),{items:this.kitchen_item_details(e.local_id)}))).value()},manage:{get(){return!_.isNull(this.v_manage)},set(e){this.v_manage=e?[e.ref,e.item]:null}},manage_attrs(){let e=this.v_manage;return e?{local:_.get(this.local_records,e[0]),remote:_.get(this.remote_records,e[0]),item:e[1]}:null}}),methods:{popup_width:m["x"],load_data(){let e=this;Promise.all([Object(o["remote_query"])("kitchens",[{_monitor:!0},{_location:_BRANCH,operand:"!="}],!0),Object(o["remote_query"])("kitchen_items",[{_monitor:!0},{_location:_BRANCH,operand:"!="}],!0)]).then((function(t){let i=t[0],a=t[1];i.forEach((t=>e.$set(e.remote_records,t.id,n()(n()({},t.data()),{},{id:t.id,items:[]})))),a.forEach((t=>e.remote_records[t.get("kitchen")].items.push(n()(n()({},t.data()),{},{id:t.id}))))}))},kitchen_item_details(e){return _(_.get(this.kitchen_items,e)).map((({id:e,item:t})=>Object.assign({},_.get(this.item_master,t),{reference:_.get(this.kitchen_item_reference,e)},{prices:_.mapKeys(_.get(this.prices,t),((e,t)=>_.get(this.price_master,[t,"name"])))}))).mapKeys("reference").value()},kitchen_item_name(e,t){return _.get(this.local_records,[e,"items",t,"name"])},kitchen_item_prices(e,t){return _.get(this.local_records,[e,"items",t,"prices"])}}},M=S,D=i("9989"),E=i("0016"),J=i("1c1c"),L=i("66e5"),T=i("4074"),V=i("0170"),z=i("24e8"),B=Object(g["a"])(M,a,s,!1,null,null,null);t["default"]=B.exports;I()(B,"components",{QPage:D["a"],QBtn:y["a"],QCard:b["a"],QCardSection:k["a"],QIcon:E["a"],QList:J["a"],QItem:L["a"],QItemSection:T["a"],QItemLabel:V["a"],QDialog:z["a"]})}}]);