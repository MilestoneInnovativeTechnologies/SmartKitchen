(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[55],{d71e:function(e,t,s){"use strict";s.r(t);s("caad");var a=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[t("q-card",[t("q-card-section",{staticClass:"bg-grey-2 text-bold flex justify-between items-center"},[e._v("Data Count"),t("q-space"),t("q-btn",{staticClass:"q-mr-xs",attrs:{icon:"file_download",label:"Local",outline:"",padding:"xs sm",size:"sm",dense:"",color:"primary"},on:{click:e.loadLocal}}),t("q-btn",{attrs:{icon:"file_download",label:"Server",outline:"",padding:"xs sm",size:"sm",dense:"",color:"primary",loading:e.loading},on:{click:e.loadServer}})],1),t("q-list",{attrs:{dense:"",separator:"",bordered:"",padding:""}},[t("q-item",{staticClass:"text-primary text-bold"},[t("q-item-section",[t("q-item-label",[e._v("Item")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v("Local")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v("Server")])],1)],1),t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Groups")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Groups.local.length||0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Groups.server.length||0))])],1)],1),t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Menus")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Menus.local.length||0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Menus.server.length||0))])],1)],1),t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Items")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Items.local.length||0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Items.server.length||0))])],1)],1),t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Seats")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Seats.local.length||0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.Seats.server.length||0))])],1)],1),t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Price Lists")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.uniqBy(e.Prices.local,"list").length||0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.uniqBy(e.Prices.server,"list").length||0))])],1)],1),e._l(e.MenuGroups.local,(function(s,a){return t("q-item",{key:"om-sd-dl-mg-m-"+a},[t("q-item-section",[t("q-item-label",{staticClass:"text-bold text-primary"},[e._v("Menu "+e._s(a)+" Groups")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.MenuGroups.local&&e.MenuGroups.local[a]?e.MenuGroups.local[a].length:0))])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-center"},[e._v(e._s(e.MenuGroups.server&&e.MenuGroups.server[a]?e.MenuGroups.server[a].length:0))])],1)],1)}))],2),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{icon:"file_upload",label:"Sync to Server",outline:"",size:"md",dense:"",color:"primary",disable:!e.sync_ready,loading:e.loading},on:{click:e.sync}})],1)],1),t("q-card",[t("q-card-section",{staticClass:"bg-grey-2 text-bold flex justify-between items-center"},[e._v("Item Images"),t("q-space"),t("q-btn",{staticClass:"q-mr-xs",attrs:{disabled:!!e.Items.local.length,icon:"file_download",label:"Load Data",outline:"",padding:"xs sm",size:"sm",dense:"",color:"primary"},on:{click:e.loadLocal}}),t("q-btn",{attrs:{disabled:!e.Items.local.length,icon:"file_download",label:"Load Server Images",outline:"",padding:"xs sm",size:"sm",dense:"",color:"primary",loading:e.loading_all_images},on:{click:e.loadAllServerImages}})],1),t("q-card-section",{staticClass:"q-px-md q-my-sm",attrs:{horizontal:""}},[e.no_img_upload?t("div",{staticClass:"col-4 text-center"},[t("q-spinner",{staticClass:"q-mt-sm",attrs:{size:"4rem"}})],1):null===e.no_image_url?t("q-btn",{staticClass:"col-4",attrs:{icon:"cloud_download",label:"Download Current","no-caps":"",dense:""},on:{click:e.getNoImage}}):t("q-img",{staticClass:"col-4",attrs:{src:e.no_image_url}}),t("q-card-section",{staticClass:"col-grow"},[e._v("\n        Default display image for items with no image\n        "),t("q-input",{key:"om-sd-ni-fk-"+e.fuKey,staticClass:"q-mt-sm",attrs:{outlined:"",dense:"",type:"file"},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"attach_file"}})]},proxy:!0}]),model:{value:e.no_image,callback:function(t){e.no_image=t},expression:"no_image"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false && no_img_upload"}],staticClass:"text-caption"},[e._v("Uploading..")])],1)],1),t("q-list",{attrs:{dense:"",separator:"",bordered:""}},[t("q-item",[t("q-item-section",[t("q-btn",{attrs:{label:"Invert Selection",flat:"",color:"primary",dense:"","no-caps":""},on:{click:e.selection_invert}})],1),t("q-item-section",[t("q-btn",{attrs:{label:"Select having no images on server",flat:"",color:"primary",dense:"","no-caps":""},on:{click:e.selection_image_less}})],1)],1),e._l(e.Items.local,(function(s){return t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"olm-im-l-i-"+s.id,attrs:{tag:"label"}},[t("q-item-section",{attrs:{avatar:""}},[t("q-checkbox",{attrs:{val:s.id,color:"positive"},model:{value:e.im_ids,callback:function(t){e.im_ids=t},expression:"im_ids"}})],1),t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",{attrs:{rounded:""}},[t("img",{attrs:{src:e.image(s.image)}})])],1),t("q-item-section",[t("q-item-label",[e._v(e._s(s.name))])],1),t("q-item-section",{directives:[{name:"show",rawName:"v-show",value:e.uploading===s.id,expression:"uploading === item.id"}]},[t("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.progress_text))]),t("q-item-label",[t("q-linear-progress",{attrs:{color:"warning",stripe:"",value:e.progress}})],1)],1),t("q-item-section",{directives:[{name:"show",rawName:"v-show",value:e.error.includes(s.id),expression:"error.includes(item.id)"}]},[t("q-item-label",{attrs:{caption:""}},[e._v("Upload error")])],1),t("q-item-section",{attrs:{avatar:""}},[e.server_images[s.id]?t("q-avatar",{attrs:{rounded:""}},[t("img",{attrs:{src:e.server_images[s.id]}})]):e._e()],1)],1)}))],2),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{icon:"file_upload",label:`Upload Selected ${e.im_ids.length} Items Image`,outline:"",size:"md",dense:"",color:"primary",disable:!e.im_ids.length,loading:e.loading},on:{click:e.uploadImages}})],1)],1)],1)},i=[],l=(s("5319"),s("14d9"),s("bc3a")),n=s.n(l),r=s("3e26"),o=s("b1c1");const{JI36A:c}=s("adfa").FEATURES;var m={name:"PageOnlineMenuSyncData",data(){return{Groups:{local:[],server:[]},Items:{local:[],server:[]},Seats:{local:[],server:[]},Prices:{local:[],server:[]},loading:!1,sync_ready:!1,no_image_url:null,no_img_upload:!1,fuKey:0,im_ids:[],uploading:!1,progress_text:"",progress:0,error:[],server_images:{},loading_all_images:!1}},computed:{Menus(){return _(this.Groups).mapValues((e=>_(e).flatMap("menus").uniq().value())).value()},MenuGroups(){return _(this.Menus).mapValues(((e,t)=>_(e).mapKeys().mapValues((e=>this.getMenuGroups(t,e))).value())).value()},no_image:{get(){return null},set(e){this.no_img_upload=!0,Object(r["j"])(c,"0",e[0]).then((e=>this.no_img_upload=(this.no_image_url=e)&&this.fuKey++&&!1))}}},methods:{uniqBy:_.uniqBy,image:o["i"],getMenuGroups(e,t){return _.filter(this.Groups[e],(({menus:e})=>e.includes(t)))},loadLocal(){let e=LOGIN.replace("login","assets/online/menu.js?_="+Math.random());this.loadFromUrl(e,"local").then((()=>this.sync_ready=!0))},loadServer(){this.loading=!0,Object(r["b"])(c).then((e=>this.loadFromUrl(e,"server").then((()=>this.loading=!1)))).catch((e=>alert((this.loading=!1)||"No server data found!!")))},loadFromUrl(e,t){const s=this;return new Promise((function(a){n.a.get(e).then((function({data:e}){a(s.putAssets(t,e))}))}))},putAssets(e,t){return _.forEach(t,((t,s)=>this.$set(this[s],e,t)))},sync(){if(!this.sync_ready)return;this.loading=!0;const e=this,t=_(["Groups","Items","Seats","Prices"]).mapKeys().mapValues((e=>_.get(this,[e,"local"]))).value();Object(r["i"])(c,t).then((function(t){e.putAssets("server",t),e.loading=e.sync_ready=!1}))},uploadImages(){if(!this.im_ids.length)return this.uploading=!1;this.uploading=this.im_ids.splice(0,1)[0];const e=this.image(_.get(_.find(this.Items.local,["id",this.uploading]),"image"));this.progress_text="Getting Image",fetch(e).then((e=>{this.progress_text="Image fetched, making blob",e.blob().then((e=>{this.progress_text="Uploading";const t=Object(r["k"])(c,this.uploading,e);t.on("state_changed",(e=>{this.progress=e.bytesTransferred/e.totalBytes,this.progress_text+="."}),(()=>{this.error.push(this.uploading),this.uploadImages()}),(()=>{Object(r["c"])(c,this.uploading).then((e=>{this.$set(this.server_images,this.uploading,e),this.uploadImages()}))}))}))}))},getNoImage(){this.no_img_upload=!0,Object(r["c"])(c,0).then((e=>this.no_image_url=e)).catch((()=>alert("No image uploaded!!"))).finally((()=>this.no_img_upload=!1))},loadAllServerImages(){this.loading_all_images=!0,Object(r["a"])(c).then((e=>{_.forEach(e,((e,t)=>this.$set(this.server_images,t,e))),this.loading_all_images=!1}))},selection_invert(){this.im_ids=_.difference(_.map(this.Items.local,"id"),this.im_ids)},selection_image_less(){this.im_ids=_.difference(_.map(this.Items.local,"id"),_.map(_.keys(this.server_images),_.toInteger))}}},d=m,u=s("2877"),g=s("9989"),p=s("f09f"),h=s("a370"),q=s("2c91"),v=s("9c40"),b=s("1c1c"),f=s("66e5"),x=s("4074"),y=s("0170"),C=s("4b7e"),I=s("0d59"),w=s("068f"),S=s("27f9"),k=s("0016"),G=s("8f8e"),M=s("cb32"),Q=s("6b1d"),j=s("714f"),L=s("eebe"),O=s.n(L),A=Object(u["a"])(d,a,i,!1,null,null,null);t["default"]=A.exports;O()(A,"components",{QPage:g["a"],QCard:p["a"],QCardSection:h["a"],QSpace:q["a"],QBtn:v["a"],QList:b["a"],QItem:f["a"],QItemSection:x["a"],QItemLabel:y["a"],QCardActions:C["a"],QSpinner:I["a"],QImg:w["a"],QInput:S["a"],QIcon:k["a"],QCheckbox:G["a"],QAvatar:M["a"],QLinearProgress:Q["a"]}),O()(A,"directives",{Ripple:j["a"]})}}]);