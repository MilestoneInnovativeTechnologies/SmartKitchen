(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[112],{2836:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("q-page",{attrs:{padding:""}},[e.kitchen?t("KitchenTokens",{attrs:{id:e.kitchen.id,card:!1}}):e._e(),t("transition-group",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},[t("q-page-sticky",{directives:[{name:"show",rawName:"v-show",value:!e.reset,expression:"!reset"}],key:"ktp-rs-b",staticClass:"lt-md",attrs:{position:"bottom-left",offset:[18,18]}},[t("q-btn",{attrs:{fab:"",icon:"undo",color:"negative",padding:"sm"},on:{click:function(t){e.reset=!0}}})],1),e.cloud?t("q-page-sticky",{directives:[{name:"show",rawName:"v-show",value:!e.offline_order,expression:"!offline_order"}],key:"ktp-aoo-b",attrs:{position:"bottom-right",offset:[18,18]}},[t("q-btn",{staticClass:"flip-horizontal",attrs:{fab:"",icon:"undo",color:"secondary",padding:"sm"},on:{click:function(t){e.offline_order=!0}}})],1):e._e()],1),e.cloud?t("q-dialog",{attrs:{persistent:"",value:e.offline_order},on:{"before-hide":function(t){e.offline_order=!1}}},[t("AddRemoteOrder",{staticStyle:{width:"22rem"},attrs:{kitchen:e.kitchen.id},on:{imported:function(t){e.offline_order=!1}}})],1):e._e()],1)},a=[],n=function(){var e=this,t=e._self._c;return t("q-card",{attrs:{flat:!e.card}},[e.card?t("q-card-section",{staticClass:"bg-grey-2"},[t("div",{staticClass:"text-bold"},[e._v(e._s(e.kitchen.name))])]):e._e(),t("q-card-section",{directives:[{name:"show",rawName:"v-show",value:0===e.Tokens.length,expression:"Tokens.length === 0"}],staticClass:"text-center"},[e._v("NO TOKENS")]),t("q-card-section",{directives:[{name:"show",rawName:"v-show",value:0!==e.Tokens.length,expression:"Tokens.length !== 0"}],staticClass:"q-pa-none q-ma-none"},[t("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Item"===e.mode,expression:"mode === 'Item'"}]},[t("Masonry",{attrs:{width:"250",items:e.items},scopedSlots:e._u([{key:"item",fn:function(i){return[t("KitchenTokenItem",{attrs:{kitchen:e.id,details:i.item,item:e.getItem(i.item),stock:e.getStock(i.item)}})]}}])})],1),t("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Progress"===e.mode,expression:"mode === 'Progress'"}],staticClass:"row q-col-gutter-sm"},[t("div",{staticClass:"col-xs-12 col-sm-4"},[t("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"New",stock:"true",action:"true"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"Accepted",action:"true"}})],1),t("div",{staticClass:"col-xs-12 col-sm-4"},[t("KitchenTokenBundle",{attrs:{kitchen:e.id,type:"Processing",action:"true"}})],1)]),t("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"Token"===e.mode,expression:"mode === 'Token'"}]},[t("Masonry",{attrs:{width:"320",gutter:"xs",items:e.cloud?e.sTokens:e.Tokens},scopedSlots:e._u([{key:"item",fn:function(i){return[t(e.cloud?"TokenDetailCardRemote":"TokenDetailCard",{tag:"component",attrs:{id:i.id,kitchen:e.kitchen.id,multiple:e.card}})]}}])})],1)],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.reset,callback:function(t){e.reset=t},expression:"reset"}},[t("KitchenItemCancel",{style:e.popup_width(),attrs:{kitchen:e.id,cancelling:e.cancelling},on:{cancel:e.doReset}})],1)],1)},r=[],o=(i("caad"),function(){var e=this,t=e._self._c;return t("q-card",[e.multiple?e._e():t("q-card-section",{staticClass:"q-pa-xs",class:e.dtColor}),t("q-card-section",{staticClass:"bg-grey-2 row justify-between items-center q-py-sm"},[t("div",{staticClass:"text-bold q-py-xs q-px-sm text-white text-weight-bolder rounded-borders",class:e.dtColor},[e._v(e._s(e.id))]),t("div",{staticClass:"text-bold"},[e._v(e._s(e.token_time))])]),t("q-card-section",{staticClass:"row justify-between items-center q-py-xs"},[e.token.waiter?t("q-chip",{attrs:{square:"",color:"cyan-7","text-color":"white"}},[t("q-avatar",{attrs:{"text-color":"white"}},[t("q-icon",{attrs:{name:"local_dining"}})],1),e._v(e._s(e.token.waiter.name))],1):e._e(),e.token.seating?t("q-chip",{attrs:{square:"",color:"amber-9","text-color":"white"}},[t("q-avatar",{attrs:{"text-color":"white"}},[t("q-icon",{attrs:{name:"event_seat"}})],1),e._v(e._s(e.token.seating.name))],1):e._e(),"Dining"!==e.token.type&&e.token.customer?t("q-chip",{attrs:{square:"",color:"accent","text-color":"white"}},[t("q-avatar",{attrs:{"text-color":"white"}},[t("q-icon",{attrs:{name:"person_outline"}})],1),e._v(e._s(e.token.customer.name))],1):e._e(),t("q-chip",{attrs:{square:"",color:"teal-9","text-color":"white"}},[t("q-avatar",{attrs:{"text-color":"white"}},[t("q-icon",{attrs:{name:"rule"}})],1),e._v(e._s(e.token.type))],1)],1),t("q-list",{staticClass:"bg-grey-1",attrs:{bordered:"",separator:""}},e._l(e.token.items,(function(i){return t("TokenDetailCardItem",{key:e.hKey(i),attrs:{token:e.token,item:i,kitchen:e.kitchen}})})),1),t("BrowserPrintCardActions",{attrs:{token:e.token}})],1)}),c=[],l=function(){var e=this,t=e._self._c;return"Cancelled"!==e.item.progress?t("q-item",{attrs:{disable:!e.eligible}},[t("q-item-section",[e.item.deliver?t("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[e._v("Delivery: "+e._s(e.item.deliver_human))]):e._e(),e.item.say?t("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[t("span",{staticStyle:{visibility:"hidden"}},[e._v("Delivery: ")]),e._v(e._s(e.item.say))]):e._e(),e.eligible&&e.wait?t("q-item-label",{staticClass:"text-weight-bolder text-red",staticStyle:{"font-size":"0.8rem"}},[e._v("Wait "+e._s(e.item.delay-e.now)+" seconds")]):e._e(),e.offline_reference?t("q-item-label",{staticClass:"text-bold text-cyan",staticStyle:{"font-size":"0.65rem"}},[e._v(e._s(e.offline_reference))]):e._e(),t("q-item-label",[t("span",{staticClass:"text-weight-bolder"},[e._v(e._s(e.item.quantity))]),e._v(" x "+e._s(e.name))]),e.eligible&&e.item.narration&&!e.wait?t("q-item-label",{staticClass:"text-weight-bolder text-red",staticStyle:{"font-size":"0.8rem"},attrs:{caption:""}},[e._v(e._s(e.item.narration))]):e._e(),t("q-item-label",{attrs:{caption:"",temp:e.next}},[e._v(e._s(e.time)+" "+e._s(e.unit)+" ago")]),e.item.kitchen&&e.item.kitchen!==e.kitchen?t("q-item-label",{attrs:{caption:""}},[e._v("Kitchen: "+e._s(e.kName(e.item.kitchen)))]):e._e(),e.item.photo?t("q-item-label",{attrs:{caption:""}},[t("q-btn",{attrs:{type:"a",padding:"none",label:"Photo Attached","icon-right":"launch",color:"blue",flat:"",size:"sm"},on:{click:function(t){return e.$emit("photo",e.item.photo)}}})],1):e._e()],1),"Processing"!==e.item.progress||!e.eligible||e.loading||e.wait?e._e():t("q-item-section",{attrs:{side:""}},[t("q-spinner-dots",{attrs:{color:"primary",size:"2em"}})],1),t("q-item-section",{attrs:{side:""}},[t("q-badge",{staticClass:"q-py-xs",attrs:{color:e.color[e.item.progress],label:e.item.progress}})],1),e.eligible&&e.action.hasOwnProperty(e.item.progress)?t("q-item-section",{attrs:{side:""}},[t("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",color:"primary",round:"",size:"sm"},on:{click:e.progress}})],1):t("q-item-section",{attrs:{side:""}},[t("q-btn",{staticClass:"bg-transparent",attrs:{flat:"",round:"",size:"sm"}})],1),e.eligible&&(e.wait||e.loading)?t("q-inner-loading",{attrs:{showing:!0}},[t("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1):e._e()],1):e._e()},d=[],m=i("2f62"),u=i("232e"),h={name:"TokenDetailCardItem",props:["token","item","kitchen","offline_reference"],data(){return{color:u["TokenItemProgressColor"],action:{New:"accept",Accepted:"process",Processing:"complete"},now:_.toInteger((new Date).getTime()/1e3),loading:!1}},computed:{...Object(m["d"])({available({kitchens:{items:e}}){return!!_.filter(_.get(e,this.kitchen),["item",this.item.item.id]).length}}),name(){return this.item.item.name},eligible(){var e,t;return(null===(e=this.item)||void 0===e||null===(t=e.kitchen)||void 0===t?void 0:t.id)===this.kitchen||!this.item.kitchen&&this.available},since(){return _.toInteger(_.get(_.last(this.item.progress_timing),"time"))},time(){let e=this.now-this.since,t=e<60?e:e<3600?_.toInteger(e/60):_.toInteger(e/3600);return _.toInteger(t)},unit(){let e=this.now-this.since;return e<60?"seconds":e<3600?"minutes":"hours"},wait(){return this.item.delay>0&&this.now<this.item.delay},next(){this.now;return setTimeout((e=>e.now=_.toInteger((new Date).getTime()/1e3)),this.wait||"seconds"===this.unit?1e3:"minutes"===this.unit?6e4:36e5,this)}},methods:{kName(e){return _.get(this.$store.state.kitchens.data,[e,"name"])},progress(){this.loading=!0,post("token",this.action[this.item.progress],{id:this.item.id,kitchen:this.kitchen}).then((()=>this.loading=!1))}}},p=h,k=i("2877"),g=i("66e5"),f=i("4074"),v=i("0170"),b=i("9c40"),q=i("8380"),y=i("58a8"),w=i("74f7"),x=i("e669"),C=i("eebe"),I=i.n(C),T=Object(k["a"])(p,l,d,!1,null,null,null),Q=T.exports;I()(T,"components",{QItem:g["a"],QItemSection:f["a"],QItemLabel:v["a"],QBtn:b["a"],QSpinnerDots:q["a"],QBadge:y["a"],QInnerLoading:w["a"],QSpinnerFacebook:x["a"]});var O=i("b1c1"),j=i("3758"),S=i("36d9"),$={name:"TokenDetailCard",components:{BrowserPrintCardActions:S["a"],TokenDetailCardItem:Q},props:["id","kitchen","multiple"],mixins:[j["a"]],computed:{token(){return _.find(this.tokens,["id",this.id])},token_time(){return Object(O["D"])(this.token.date)},dtColor(){return"bg-"+u["DiningTypeColor"][this.token.type]}},methods:{hKey({token:e,item:t,id:i}){return Object(O["e"])("token",e,"item","detail",t,"id",i)}}},K=$,A=i("f09f"),B=i("a370"),D=i("b047"),N=i("cb32"),P=i("0016"),L=i("1c1c"),z=Object(k["a"])(K,o,c,!1,null,null,null),R=z.exports;I()(z,"components",{QCard:A["a"],QCardSection:B["a"],QChip:D["a"],QAvatar:N["a"],QIcon:P["a"],QList:L["a"]});var W=function(){var e=this,t=e._self._c;return t("q-card",[t("q-card-section",{staticClass:"text-white text-bold",class:e.colClass},[e._v(e._s(e.type))]),t("q-list",{directives:[{name:"show",rawName:"v-show",value:Object.keys(e.dist).length>0,expression:"Object.keys(dist).length > 0"}],attrs:{bordered:"",separator:""}},[t("transition-group",{attrs:{appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut",mode:"out-in"}},e._l(e.dist,(function(i,s){return t("KitchenTokenBundleItem",e._b({key:e.hKey(s),attrs:{identify:s,progress:e.type,"show-stock":e.stock,processing:e.processing.includes(s)},on:{proceed:function(t){e.item=t}}},"KitchenTokenBundleItem",i,!1))})),1)],1),t("q-card-section",{staticClass:"text-center text-bold"},[e._v(e._s(e.total?"Total: "+e.total:"No Items"))]),void 0!==e.action?t("q-dialog",{attrs:{persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t("KitchenTokenBundleAction",e._b({staticStyle:{width:"50vw","max-width":"330px"},attrs:{progress:e.type},on:{progress:e.progress}},"KitchenTokenBundleAction",e.dist[e.item],!1))],1):e._e()],1)},E=[],F=(i("14d9"),function(){var e=this,t=e._self._c;return t("q-item",{attrs:{disable:e.wait>0||e.$attrs.processing,clickable:""},on:{click:function(t){return e.$emit("proceed",e.$attrs.identify)}}},[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",{attrs:{rounded:""}},[t("q-img",{attrs:{src:e.src}})],1)],1),t("q-item-section",[void 0!==e.$attrs["show-stock"]?t("q-item-label",{attrs:{caption:""}},[e._v("Stock: "+e._s(e.$attrs.stock))]):e._e(),t("q-item-label",{staticClass:"text-weight-bold"},[e._v(e._s(e.$attrs.name))]),e.wait?t("q-item-label",{staticClass:"text-bold",attrs:{caption:""}},[e._v("Wait: "+e._s(e.wait))]):e._e(),e.$attrs.narration?t("q-item-label",{staticClass:"text-red text-bold",attrs:{caption:""}},[e._v(e._s(e.$attrs.narration))]):e._e()],1),t("q-item-section",{attrs:{side:""}},[t("q-avatar",{staticClass:"text-weight-bold",attrs:{color:e.color,rounded:"","text-color":"white"}},[e._v(e._s(e.$attrs.total))])],1),t("q-inner-loading",{attrs:{showing:e.$attrs.processing,"transition-hide":"fadeOut","transition-show":"fadeIn"}},[t("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)}),M=[],V={name:"KitchenTokenBundleItem",data(){return{wait:_.toInteger(this.$attrs.wait),interval:0,color:u["TokenItemProgressColor"][this.$attrs.progress],src:Object(O["i"])(this.$attrs.image)}},created(){this.wait&&(this.interval=setInterval((e=>e.wait--),1e3,this),setTimeout((e=>clearInterval(e.interval)),1e3*this.wait,this))}},Y=V,H=i("068f"),U=Object(k["a"])(Y,F,M,!1,null,null,null),J=U.exports;I()(U,"components",{QItem:g["a"],QItemSection:f["a"],QAvatar:N["a"],QImg:H["a"],QItemLabel:v["a"],QInnerLoading:w["a"],QSpinnerFacebook:x["a"]});var G=function(){var e=this,t=e._self._c;return t("q-card",[t("CardImageTitle",{attrs:{image:e.image,title:e.$attrs.name}}),e.$attrs.narration?t("q-card-section",{staticClass:"bg-teal text-white"},[t("div",{staticClass:"text-h6"},[e._v(e._s(e.$attrs.narration))])]):e._e(),t("q-card-actions",[t("q-btn",{attrs:{icon:"done_all",glossy:"",push:"",color:"positive",label:"All"},on:{click:e.all}}),t("q-space"),t("q-btn",{attrs:{icon:"done",glossy:"",push:"",color:"deep-orange-7",label:"Invert "},on:{click:e.invert}})],1),t("q-list",{staticClass:"bg-grey-2",attrs:{bordered:"",separator:""}},e._l(e.$attrs.token,(function(i){return t("q-item",{key:e.hKey(i),class:{"bg-grey-4":e.selected.includes(i.id)},attrs:{clickable:""},on:{click:function(t){return e.clicked(i)}}},[t("q-item-section",{attrs:{avatar:""}},[t("transition",{attrs:{mode:"out-in",appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut"}},[e.selected.includes(i.id)?t("q-avatar",{attrs:{icon:"done_all",color:"green","text-color":"grey-2"}}):e._e()],1)],1),t("q-item-section",[t("q-item-label",[e._v("Token: "+e._s(i.token)+" - ("+e._s(e.time(e.Tokens[i.token].date))+")")]),t("q-item-label",{attrs:{caption:""}},[e._v("Type: "+e._s(e.Tokens[i.token].type))]),e.Tokens[i.token].waiter?t("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.Tokens[i.token].waiter.name))]):e._e(),e.Tokens[i.token].seating?t("q-item-label",{attrs:{caption:""}},[e._v("Seat: "+e._s(e.Tokens[i.token].seating.name))]):e._e()],1),t("q-item-section",{attrs:{side:""}},[t("q-avatar",{attrs:{rounded:"","text-color":"white",color:e.color}},[e._v(e._s(i.quantity))])],1)],1)})),1),t("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"left"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"CLOSE"}}),t("q-space"),t("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"q-py-sm q-px-md",attrs:{label:e.total}}),t("q-space"),t("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",disable:!e.selected.length,round:"",color:"positive"},on:{click:function(t){return e.$emit("progress",e.selected)}}})],1)],1)},X=[],Z=i("43fa"),ee={name:"KitchenTokenBundleAction",components:{CardImageTitle:Z["a"]},data(){return{image:Object(O["i"])(this.$attrs.image),selected:[],color:u["TokenItemProgressColor"][this.$attrs.progress]}},mixins:[j["a"]],computed:{tkn(){return _.map(this.$attrs.token,"token")},ids(){return _.map(this.$attrs.token,"id")},Tokens(){return _(this.tokens).filter((({id:e})=>this.tkn.includes(e))).keyBy("id").value()},total(){let e=this.selected;return"TOTAL: "+_.sumBy(_.values(this.$attrs.token),(({quantity:t,id:i})=>e.includes(i)?t:0))}},methods:{hKey({id:e,token:t}){return Object(O["e"])("kitchen","token",t,"bundle","action","id",e)},time(e){return Object(O["D"])(e)},clicked({id:e}){this.selected.includes(e)?this.selected=_.difference(this.selected,[e]):this.selected.push(e)},all(){this.selected=this.ids},invert(){_.forEach(this.ids,(e=>this.clicked({id:e})))}}},te=ee,ie=i("4b7e"),se=i("2c91"),ae=i("7f67"),ne=Object(k["a"])(te,G,X,!1,null,null,null),re=ne.exports;I()(ne,"components",{QCard:A["a"],QCardSection:B["a"],QCardActions:ie["a"],QBtn:b["a"],QSpace:se["a"],QList:L["a"],QItem:g["a"],QItemSection:f["a"],QAvatar:N["a"],QItemLabel:v["a"],QBadge:y["a"]}),I()(ne,"directives",{ClosePopup:ae["a"]});var oe={name:"KitchenTokenBundle",components:{KitchenTokenBundleAction:re,KitchenTokenBundleItem:J},mixins:[j["a"]],props:["kitchen","type","stock","action"],data(){return{colClass:"bg-"+u["TokenItemProgressColor"][this.type],waits:[],timeout:0,item:null,processing:[],status:{New:"accept",Accepted:"process",Processing:"complete"}}},computed:{...Object(m["d"])({kItems({kitchens:{items:e}}){return _.map(e[this.kitchen],(({item:e,stock:t})=>Object.assign({},{item:e,stock:t})))},items(){return _(this.tokens).flatMap("items").filter(this.isAct).value()},dist(){return _(this.items).groupBy(this.crypt).mapValues(this.itmObj).value()},total(){return _.sumBy(Object.values(this.dist),"total")}}),dialog:{get(){return!!this.item},set(e){this.item=e||null}}},methods:{hKey(e){return Object(O["e"])("kitchen",this.id,"tokens","bundle",e)},isAct({item:e,progress:t,kitchen:i}){return!i&&"New"===t&&"New"===this.type&&_.some(this.kItems,["item",e.id])||i&&i.id===_.toInteger(this.kitchen)&&this.type===t},itmObj(e){let t=e[0];return Object.assign({},this.pure(t),{total:_.sumBy(e,"quantity"),token:_(e).keyBy("token").mapValues((({token:e,id:t,user:i,quantity:s})=>new Object({token:e,id:t,user:i,quantity:s}))).value()})},crypt({delay:e,item:{id:t},narration:i}){return Object(O["c"])([t,this.getWait(e),i].join("|"))+""},pure({item:{id:e,name:t,image:i},delay:s,narration:a}){return{wait:this.getWait(s),narration:a,name:t,image:i,item:e,stock:_.get(_.find(this.kItems,["item",e]),"stock")}},getWait(e){let t=_.toInteger(e)-Object(O["t"])();return t<0?0:(this.waits.includes(t)||this.waits.push(t),t)},progress(e){let t=this.item;e.length&&this.processing.push(t),this.dialog=!1,this.post(0,e,t,this.kitchen)},post(e,t,i,s){if(t.length<=e)return this.processing=_.difference(this.processing,[i]);post("token",this.status[this.type],{id:t[e],kitchen:s}).then((()=>setTimeout(this.post,300,e+1,t,i,s)))}},watch:{waits:{immediate:!0,handler(e){if(!e.length)return;let t=1e3*_.min(e);clearTimeout(this.timeout),this.timeout=setTimeout((e=>e.waits=[]),t,this)}}}},ce=oe,le=i("24e8"),de=Object(k["a"])(ce,W,E,!1,null,null,null),me=de.exports;I()(de,"components",{QCard:A["a"],QCardSection:B["a"],QList:L["a"],QDialog:le["a"]});var ue=i("3610"),he=function(){var e=this,t=e._self._c;return t("q-card",[t("q-card-section",{staticClass:"row bg-deep-orange items-center text-white"},[t("div",{staticClass:"text-h6"},[e._v("Reset Item")]),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"clear"}})],1),t("q-item-section",{staticClass:"q-pa-md"},[t("FilterInputText",{attrs:{lazy:"true"},on:{text:function(t){e.filter=t}}})],1),t("q-list",{attrs:{bordered:"",separator:""}},[e.accepted.length?[t("q-item-label",{attrs:{header:""}},[e._v("Accepted Items")]),e._l(e.accepted,(function(i,s){return t("KitchenItemCancelItem",{key:e.hKey("accepted",s,i),attrs:{item:i,token:e.Tokens[i.token],selected:e.selected},on:{select:e.select}})}))]:e._e(),e.processing.length?[t("q-item-label",{attrs:{header:""}},[e._v("Processing Items")]),e._l(e.processing,(function(i,s){return t("KitchenItemCancelItem",{key:e.hKey("processing",s,i),attrs:{item:i,token:e.Tokens[i.token],selected:e.selected},on:{select:e.select}})}))]:e._e(),e.completed.length?[t("q-item-label",{attrs:{header:""}},[e._v("Completed Items")]),e._l(e.completed,(function(i,s){return t("KitchenItemCancelItem",{key:e.hKey("completed",s,i),attrs:{item:i,token:e.Tokens[i.token],selected:e.selected},on:{select:e.select}})}))]:e._e()],2),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{attrs:{push:"",loading:e.$attrs.cancelling,color:"deep-orange",label:"Reset All Selected"},on:{click:function(t){return e.$emit("cancel",e.selected)}}})],1)],1)},pe=[],_e=function(){var e=this,t=e._self._c;return t("q-item",{class:{"bg-pink-1":e.yes},attrs:{clickable:""},on:{click:function(t){return e.$emit("select",e.item.id)}}},[t("q-item-section",{staticClass:"text-bold",attrs:{avatar:""}},[t("q-avatar",{attrs:{color:"pink-6","text-color":"white",rounded:"",size:"md"}},[e._v(e._s(e.i("quantity"))+"x")])],1),t("q-item-section",[t("q-item-label",{staticClass:"text-bold"},[e._v(e._s(e.i("item","name"))+" - ("+e._s(e.time)+")")]),t("q-item-label",{attrs:{caption:""}},[e._v("Token: "+e._s(e.t("id"))+", "+e._s(e.t("type")))]),e.item.narration?t("q-item-label",{staticClass:"text-bold"},[e._v(e._s(e.item.narration)+")")]):e._e(),e.t("seating")?t("q-item-label",{attrs:{caption:""}},[e._v("Seating: "+e._s(e.t("seating","name")))]):e._e(),e.t("waiter")?t("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.t("waiter","name")))]):e._e()],1),t("q-item-section",{attrs:{side:""}},[t("q-btn",{attrs:{icon:"done",round:"",push:"",flat:"",color:e.yes?"positive":"grey-3"}})],1)],1)},ke=[],ge={name:"KitchenItemCancelItem",props:["item","token","selected"],computed:{time(){return Object(O["D"])(this.token.date)},yes(){return this.selected.includes(this.item.id)}},methods:{i(...e){return _.get(this.item,e)},t(...e){return _.get(this.token,e)}}},fe=ge,ve=Object(k["a"])(fe,_e,ke,!1,null,null,null),be=ve.exports;I()(ve,"components",{QItem:g["a"],QItemSection:f["a"],QAvatar:N["a"],QItemLabel:v["a"],QBtn:b["a"]});var qe=i("5ab9"),ye={name:"KitchenItemCancel",components:{FilterInputText:qe["a"],KitchenItemCancelItem:be},data(){return{selected:[],filter:""}},props:["kitchen"],mixins:[j["a"]],computed:{Tokens(){return _(this.tokens).filter((({progress:e})=>["New","Processing"].includes(e))).keyBy("id").value()},items(){return _(this.Tokens).flatMap("items").filter(this.isAct).value()},filtered(){return""===this.filter?this.items:_.filter(this.items,(({item:{name:e},token:t})=>_.includes(t+" "+_.toLower(e),_.toLower(this.filter))))},accepted(){return _.filter(this.filtered,["progress","Accepted"])},processing(){return _.filter(this.filtered,["progress","Processing"])},completed(){return _.filter(this.filtered,["progress","Completed"])}},methods:{hKey(e,t,{id:i}){return Object(O["e"])("kitchen","item","cancel",e,i,t)},isAct({kitchen:e,progress:t}){return e&&e.id===_.toInteger(this.kitchen)&&["Accepted","Processing","Completed"].includes(t)},select(e){if(this.selected.includes(e))return this.selected=_.difference(this.selected,[e]);this.selected.push(e)}}},we=ye,xe=Object(k["a"])(we,he,pe,!1,null,null,null),Ce=xe.exports;I()(xe,"components",{QCard:A["a"],QCardSection:B["a"],QSpace:se["a"],QBtn:b["a"],QItemSection:f["a"],QList:L["a"],QItemLabel:v["a"],QCardActions:ie["a"]}),I()(xe,"directives",{ClosePopup:ae["a"]});var Ie=function(){var e=this,t=e._self._c;return t("q-card",[t("q-card-section",{staticClass:"q-py-xs bg-teal"}),t("CardImageTitle",{attrs:{title:e.item.name,image:e.src}}),t("q-list",{attrs:{bordered:"",dense:""}},[e._l(e.data,(function(i,s){return[t("transition-group",{attrs:{appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut",mode:"out-in"}},e._l(i,(function(i,a){return t("KitchenTokenItemLine",e._b({key:e.hKey(a),attrs:{progress:s},on:{action:function(t){e.selected=[s,i]}}},"KitchenTokenItemLine",i,!1))})),1)]}))],2),t("q-card-section",{staticClass:"row items-center q-py-xs"},[t("div",{staticClass:"text-primary"},[e._v("Stock")]),t("q-space"),t("q-avatar",{attrs:{size:"sm","text-color":"white",rounded:"",color:"primary"}},[e._v(e._s(e.iStock))]),t("q-space"),t("div",{staticClass:"text-primary"},[e._v("Total")]),t("q-space"),t("q-avatar",{attrs:{size:"sm","text-color":"white",rounded:"",color:"primary"}},[e._v(e._s(e.total))])],1),t("q-dialog",{attrs:{persistent:"",value:!!e.selected.length}},[t("KitchenTokenItemAction",e._b({staticStyle:{width:"50vw","max-width":"330px"},on:{progress:e.progress}},"KitchenTokenItemAction",e.selected[1],!1))],1)],1)},Te=[],Qe=function(){var e=this,t=e._self._c;return t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"bg-grey-1",attrs:{clickable:""},on:{click:function(t){return e.$emit("action")}}},[t("q-item-section",[t("q-item-label",{staticClass:"text-bold",class:"text-"+e.color},[e._v(e._s(e.progress))]),t("q-item-label",{directives:[{name:"show",rawName:"v-show",value:e.Wait,expression:"Wait"}],staticClass:"text-red text-bold",attrs:{caption:""}},[e._v("Wait: "+e._s(e.Wait))]),e.prop("narration")?t("q-item-label",{staticClass:"text-bold",attrs:{caption:""}},[e._v(e._s(e.prop("narration")))]):e._e(),e._l(e.tCount,(function(i,s){return t("q-item-label",{key:e.hKey(e.progress,s,i),attrs:{caption:""}},[e._v(e._s(s)+": "+e._s(i))])}))],2),t("q-item-section",{attrs:{side:""}},[t("q-avatar",{attrs:{size:"md",rounded:"","text-color":"white",color:e.color}},[e._v(e._s(e.prop("total")))])],1),t("q-inner-loading",{attrs:{showing:e.showing,"transition-hide":"fadeOut","transition-show":"fadeIn"}},[t("q-spinner-facebook",{attrs:{color:"primary",size:"2em"}})],1)],1)},Oe=[];var je={name:"KitchenTokenItemLine",props:["progress","wait"],data(){return{since:0}},computed:{color(){return u["TokenItemProgressColor"][this.progress]},Wait(){let e=_.toInteger(this.wait);return e<=this.since?0:e-this.since},tTokens(){return _.keys(this.prop("token"))},tCount(){return _(this.prop("token")).groupBy("type").mapValues((e=>_.sumBy(e,"quantity"))).value()},showing:{get(){return!!this.Wait},set(){this.since=parseInt(this.wait)}}},methods:{prop(e){return _.get(this.$attrs,e)},hKey(e,t,i){return _.kebabCase(Object(O["e"])(e,t,i))}},watch:{since:{immediate:!0,handler(){return this.Wait?setTimeout((e=>e.since++),1e3,this):null}}}},Se=je,$e=i("714f"),Ke=Object(k["a"])(Se,Qe,Oe,!1,null,null,null),Ae=Ke.exports;I()(Ke,"components",{QItem:g["a"],QItemSection:f["a"],QAvatar:N["a"],QItemLabel:v["a"],QInnerLoading:w["a"],QSpinnerFacebook:x["a"]}),I()(Ke,"directives",{Ripple:$e["a"]});var Be=function(){var e=this,t=e._self._c;return t("q-card",[t("q-card-section",{staticClass:"bg-teal text-white"},[e.$attrs.narration?t("div",{staticClass:"text-h6 text-center"},[e._v(e._s(e.$attrs.narration))]):t("div",{staticClass:"text-h6 text-center"},[e._v(e._s(e.$attrs.name))])]),t("q-card-actions",[t("q-btn",{attrs:{icon:"done_all",glossy:"",push:"",color:"positive",label:"All"},on:{click:e.all}}),t("q-space"),t("q-btn",{attrs:{icon:"done",glossy:"",push:"",color:"deep-orange-7",label:"Invert "},on:{click:e.invert}})],1),t("q-list",{staticClass:"bg-grey-2",attrs:{bordered:"",separator:""}},e._l(e.$attrs.token,(function(i){return t("q-item",{key:e.hKey(i),class:{"bg-grey-4":e.selected.includes(i.id)},attrs:{clickable:""},on:{click:function(t){return e.clicked(i)}}},[t("q-item-section",{attrs:{avatar:""}},[t("transition",{attrs:{mode:"out-in",appear:"","enter-active-class":"animated bounceIn","leave-active-class":"animated bounceOut"}},[e.selected.includes(i.id)?t("q-avatar",{key:"trg-"+i.token+i.id+"uns",attrs:{icon:"done_all",color:"indigo-7","text-color":"grey-2"}}):e._e()],1)],1),t("q-item-section",[t("q-item-label",[e._v("Token: "+e._s(i.token)+" - ("+e._s(e.time(e.Tokens[i.token].date))+")")]),t("q-item-label",{attrs:{caption:""}},[e._v("Type: "+e._s(i.type))]),e.Tokens[i.token].waiter?t("q-item-label",{attrs:{caption:""}},[e._v("Waiter: "+e._s(e.Tokens[i.token].waiter.name))]):e._e(),e.Tokens[i.token].seating?t("q-item-label",{attrs:{caption:""}},[e._v("Seat: "+e._s(e.Tokens[i.token].seating.name))]):e._e()],1),t("q-item-section",{attrs:{side:""}},[t("q-avatar",{attrs:{rounded:"","text-color":"white",color:e.typeColor[i.type]}},[e._v(e._s(i.quantity))])],1)],1)})),1),t("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"left"}},[t("q-btn",{attrs:{flat:"",label:"CLOSE"},on:{click:function(t){return e.$emit("progress")}}}),t("q-space"),t("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"q-py-sm q-px-md",attrs:{label:e.total}}),t("q-space"),t("q-btn",{staticClass:"flip-horizontal",attrs:{icon:"reply_all",disable:!e.selected.length,round:"",color:"positive"},on:{click:function(t){return e.$emit("progress",e.selected)}}})],1)],1)},De=[],Ne={name:"KitchenTokenItemAction",components:{CardImageTitle:Z["a"]},data(){return{selected:[],typeColor:u["DiningTypeColor"]}},mixins:[j["a"]],computed:{tkn(){return _.map(this.$attrs.token,"token")},ids(){return _.map(this.$attrs.token,"id")},Tokens(){return _(this.tokens).filter((({id:e})=>this.tkn.includes(e))).keyBy("id").value()},total(){let e=this.selected;return"TOTAL: "+_.sumBy(_.values(this.$attrs.token),(({quantity:t,id:i})=>e.includes(i)?t:0))}},methods:{hKey({id:e,token:t}){return Object(O["e"])("kitchen","token",t,"bundle","action","id",e)},time(e){return Object(O["D"])(e)},clicked({id:e}){this.selected.includes(e)?this.selected=_.difference(this.selected,[e]):this.selected.push(e)},all(){this.selected=this.ids},invert(){_.forEach(this.ids,(e=>this.clicked({id:e})))}}},Pe=Ne,Le=Object(k["a"])(Pe,Be,De,!1,null,null,null),ze=Le.exports;I()(Le,"components",{QCard:A["a"],QCardSection:B["a"],QCardActions:ie["a"],QBtn:b["a"],QSpace:se["a"],QList:L["a"],QItem:g["a"],QItemSection:f["a"],QAvatar:N["a"],QItemLabel:v["a"],QBadge:y["a"]});let Re=null;var We={name:"KitchenTokenItem",components:{KitchenTokenItemAction:ze,KitchenTokenItemLine:Ae,CardImageTitle:Z["a"]},data(){return{src:Object(O["i"])(this.item.image),selected:[],waits:[],showing:!0,status:{New:"accept",Accepted:"process",Processing:"complete"}}},props:["details","item","kitchen","stock"],computed:{data(){this.waits.length;return _.mapValues(_.groupBy(this.details,"progress"),this.dist)},iStock(){return _.get(this.stock,this.kitchen)},total(){return _.sumBy(this.details,"quantity")}},methods:{hKey(e){return Object(O["e"])("kitchen",this.kitchen,"token","item","line",e)},dist(e){return _(e).groupBy(this.crypt).mapValues(this.itmObj).value()},itmObj(e){let t=e[0];return Object.assign({},this.pure(t),{total:_.sumBy(e,"quantity"),token:_(e).keyBy("token").mapValues((({token:e,id:t,user:i,quantity:s,type:a})=>new Object({token:e,id:t,user:i,quantity:s,type:a}))).value()})},pure({item:{id:e,name:t},delay:i,narration:s}){return{wait:this.getWait(i),narration:s,name:t,item:e}},crypt({delay:e,item:{id:t},narration:i}){return Object(O["c"])([t,this.getWait(e),i].join("|"))+""},getWait(e){let t=_.toInteger(e)-Object(O["t"])();return t<0?0:(this.waits.includes(t)||this.waits.push(t),t)},bgClrCls(e){return"bg-"+u["TokenItemProgressColor"][e]},progress(e){this.post(this.selected[0],0,e,this.kitchen)},post(e,t,i,s){if(!i||i.length<=t)return this.selected=[];post("token",this.status[e],{id:i[t],kitchen:s}).then((()=>setTimeout(this.post,300,e,t+1,i,s)))}},watch:{waits(e){return e.length?Re=setTimeout((e=>e.waits=[]),1e3*_.min(this.waits),this,clearTimeout(Re)):null}}},Ee=We,Fe=Object(k["a"])(Ee,Ie,Te,!1,null,null,null),Me=Fe.exports;I()(Fe,"components",{QCard:A["a"],QCardSection:B["a"],QSpace:se["a"],QAvatar:N["a"],QList:L["a"],QItem:g["a"],QItemSection:f["a"],QIcon:P["a"],QItemLabel:v["a"],QDialog:le["a"]});var Ve=i("c624"),Ye=function(){var e=this,t=e._self._c;return t("q-card",[e.multiple?e._e():t("q-card-section",{staticClass:"q-pa-xs",class:e.dtColor}),t("q-card-section",{staticClass:"bg-grey-2 row justify-between items-center q-py-sm"},[t("div",{staticClass:"text-bold text-white text-weight-bolder q-gutter-x-xs"},[t("q-badge",{staticClass:"q-py-sm q-px-sm",class:e.dtColor,attrs:{label:e.remote_token.location}}),t("q-badge",{directives:[{name:"show",rawName:"v-show",value:e.token_ref,expression:"token_ref"}],staticClass:"q-py-sm q-px-sm",class:e.dtColor,attrs:{label:e.token_ref}})],1),t("div",{staticClass:"text-bold"},[e._v(e._s(e.token_time))])]),t("q-list",{staticClass:"bg-grey-1",attrs:{bordered:"",separator:""}},e._l(e.items,(function(i){return t("TokenDetailCardItem",{key:e.hKey(i),attrs:{token:e.token,item:i,kitchen:e.kitchen,offline_reference:e.items_offline_reference[i.id]},on:{photo:e.photo}})})),1),t("q-dialog",{attrs:{persistent:""},model:{value:e.view_image,callback:function(t){e.view_image=t},expression:"view_image"}},[t("q-card",{staticStyle:{"min-width":"75vw"},attrs:{flat:""}},[t("q-bar",{staticClass:"bg-secondary text-white"},[t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[t("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[e._v("Close")])],1)],1),t("q-card-section",[t("q-img",{attrs:{src:e.image_url}})],1)],1)],1)],1)},He=[],Ue=i("8808"),Je=i("de36"),Ge={name:"TokenDetailCardRemote",components:{TokenDetailCardItem:Q},props:["id","kitchen","multiple"],data(){return{view_image:!1,image_url:""}},computed:{...Object(m["d"])({token:function({tokens:{data:e,items:t},seating:i,users:s,customers:a}){let n=_.get(e,this.id);return Object.assign({},n,{waiter:_.get(s,["data",n.user,"name"]),seat:_.get(i,["data",n.seating,"name"]),items:t[n.id],customer:_.get(a,["data",n.customer])})},remote_token:function({remote:{data:e}}){return _.find(e,(({local_id:e,item:t})=>"tokens"===t&&_.toInteger(e)===_.toInteger(this.id)))||{}},rtk:function(e){return _.filter(e.remote.data,{item:"tokens"})},img_cache:function({tokens:{img:e}}){return e}}),token_time(){return this.token.date_human},token_ref(){return this.remote_token.reference},items(){return _(this.token.items).map((e=>Object.assign({},e,Xe(e)))).value()},items_offline_reference(){return _(this.items).mapKeys((({id:e})=>_.toInteger(e))).mapValues((({id:e})=>_.get(_.find(this.$store.state.remote.data,{local_id:parseInt(e),item:"token_items"}),["extra","offline_reference"]))).value()},dtColor(){return"bg-"+this.items[0].say_color}},methods:{hKey({token:e,item:t,id:i}){return Object(O["e"])("token",e,"item","detail",t,"id",i)},photo(e){if(_.has(this.img_cache,e))return this.view_image=!!(this.image_url=this.img_cache[e]);Object(Je["j"])(e).then((t=>this.photo(e,this.$store.commit("tokens/image",{name:e,url:t},{root:!0}))))}}};function Xe({deliver:e}){return Object(Ue["f"])(e)}var Ze=Ge,et=i("d847"),tt=i("05c0"),it=Object(k["a"])(Ze,Ye,He,!1,null,null,null),st=it.exports;I()(it,"components",{QCard:A["a"],QCardSection:B["a"],QBadge:y["a"],QList:L["a"],QDialog:le["a"],QBar:et["a"],QSpace:se["a"],QBtn:b["a"],QTooltip:tt["a"],QImg:H["a"]}),I()(it,"directives",{ClosePopup:ae["a"]});var at={name:"KitchenTokens",mixins:[j["a"]],components:{TokenDetailCardRemote:st,Masonry:Ve["a"],KitchenTokenItem:Me,KitchenItemCancel:Ce,KitchenTokenDisplayMode:ue["a"],KitchenTokenBundle:me,TokenDetailCard:R},props:["id","card"],data(){return{processing:["Accepted","Processing"],cancelling:!1}},computed:{...Object(m["d"])({kitchen({kitchens:{data:e}}){return _.get(e,_.toInteger(this.id))},kItems({kitchens:{items:e}}){return _.map(e[this.kitchen.id],"item")}}),cloud(){return"Yes"===this.kitchen.cloud},mode(){return _.get(this.$store.state,["public","mode"],"Token")},reset:{get(){return _.get(this.$store.state,["public","reset"],!1)},set(e){return this.$store.commit("public",{reset:!!e})}},...Object(m["b"])("kitchens",["stock"]),pView(){return this.$q.screen.width>799},Tokens(){return _(this.tokens).filter((({progress:e,items:t})=>["New","Processing"].includes(e)&&_.some(t,this.isAct))).value()},items(){return _(this.Tokens).flatMap((({items:e,type:t})=>_(e).filter(this.isAct).map((e=>Object.assign({},e,{type:t}))).value())).groupBy("item.id").value()},sTokens(){return _.sortBy(this.Tokens,(({items:e})=>Object(Ue["j"])(e)))}},methods:{popup_width:O["y"],hKey({id:e},t){return Object(O["e"])("kitchen",this.id,t,"detail",e)},isAct({item:{id:e},progress:t,kitchen:i}){return"New"===t&&_.includes(this.kItems,e)||i&&i.id===this.kitchen.id&&this.processing.includes(t)},doReset(e){e.length&&(this.cancelling=!0),this.post(0,e,this.id)},getItem(e){return _.get(e,[0,"item"])},getStock(e){return _.get(this.stock,this.getItem(e)["id"])},post(e,t,i){if(!t||0===t.length||t.length<=e)return this.reset=this.cancelling=!1;post("token","reset",{id:t[e],kitchen:i}).then((()=>setTimeout(this.post,300,e+1,t,i)))}},watch:{Tokens(e,t){(!t||e.length>t.length)&&Object(O["b"])()}}},nt=at,rt=Object(k["a"])(nt,n,r,!1,null,null,null),ot=rt.exports;I()(rt,"components",{QCard:A["a"],QCardSection:B["a"],QDialog:le["a"]});var ct=function(){var e=this,t=e._self._c;return t("q-card",[t("q-bar",{staticClass:"text-grey-1",class:"bg-"+e.color+"-7"},[t("span",{staticClass:"text-caption"},[e._v("Add Remote Order - Offline")]),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",dense:""}})],1),e.reference?[t("q-card-section",{staticClass:"q-py-md bg-grey-1 text-center",class:"text-"+e.color},[t("div",{staticClass:"text-h5 text-bold"},[e._v(e._s(e.r_ref))])]),t("q-card-section",{staticClass:"q-gutter-y-xs q-pt-none q-pb-xs"},[t("div",{staticClass:"row q-col-gutter-xs"},[t("q-input",{staticClass:"col-12",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Token",value:e.reference.token_date_code}}),t("q-input",{staticClass:"col",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Item",value:e.reference.server[1].item}}),t("q-input",{staticClass:"col",attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Quantity",value:e.reference.server[1].quantity}})],1),t("q-input",{attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Delivery",value:e.reference.server[1].deliver}}),t("q-input",{staticStyle:{height:"6rem"},attrs:{outlined:"",readonly:"","input-class":"text-"+e.color,label:"Narration",value:e.reference.server[1].narration,type:"textarea"}})],1)]:t("q-card-section",{staticClass:"q-gutter-y-xs q-pb-xs"},[t("q-file",{attrs:{clearable:"",outlined:"",dense:"","input-class":"text"+e.color,label:"Import File","bottom-slots":"","hide-bottom-space":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"cloud",color:e.color}})]},proxy:!0}]),model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),t("div",{staticClass:"row q-gutter-xs"},[t("q-input",{staticClass:"col-12",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Token Code"},model:{value:e.params.token_date_code,callback:function(t){e.$set(e.params,"token_date_code",t)},expression:"params.token_date_code"}}),t("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Location"},model:{value:e.ti_location,callback:function(t){e.ti_location=t},expression:"ti_location"}}),t("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"ID",type:"number"},model:{value:e.ti_id,callback:function(t){e.ti_id=e._n(t)},expression:"ti_id"}})],1),t("div",{staticClass:"row q-gutter-x-xs"},[t("q-select",{staticClass:"col-9",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Select Item",options:e.items,"option-label":"name"},model:{value:e.params.item,callback:function(t){e.$set(e.params,"item",t)},expression:"params.item"}}),t("q-input",{staticClass:"col",attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Quantity",type:"number"},model:{value:e.params.quantity,callback:function(t){e.$set(e.params,"quantity",e._n(t))},expression:"params.quantity"}})],1),t("DateTime",{attrs:{outlined:"",dense:"","input-class":"text-"+e.color,label:"Delivery"},model:{value:e.params.deliver,callback:function(t){e.$set(e.params,"deliver",t)},expression:"params.deliver"}}),t("q-input",{staticStyle:{height:"6rem"},attrs:{outlined:"","input-class":"text-"+e.color,label:"Narration",type:"textarea"},model:{value:e.params.narration,callback:function(t){e.$set(e.params,"narration",t)},expression:"params.narration"}})],1),t("q-card-actions",{staticClass:"q-px-md q-pt-none"},[e.reference?t("q-btn",{attrs:{label:"Clear Upload",color:"red",dense:"",flat:"",size:"sm"},on:{click:function(t){e.file=null}}}):e._e(),t("q-space"),t("q-btn",{attrs:{label:e.reference?"Import Data":"Add Order",color:e.color,glossy:"",padding:"sm xl",loading:e.loading},on:{click:e.addOrder}})],1),t("q-dialog",{attrs:{persistent:"",value:!0!==e.verified},on:{"before-hide":function(t){e.file=null}}},[t("q-card",{staticClass:"bg-red text-white",staticStyle:{"min-width":"65vw"}},[t("q-card-section",{staticClass:"bg-red-7"},[t("div",{staticClass:"text-h6"},[e._v("Error")])]),t("q-card-section",{staticClass:"text-caption"},[e._v("\n          The uploaded file is not valid because of any of the following reason.\n          "),t("li",{class:{"text-bold":0===e.verified}},[e._v("The uploaded data is corrupted")]),t("li",{class:{"text-bold":1===e.verified}},[e._v("The uploaded data is not for this kitchen")]),t("li",{class:{"text-bold":2===e.verified}},[e._v("The items are not processing in this kitchen")]),t("li",{class:{"text-bold":3===e.verified}},[e._v("The reference name is not provided")]),t("li",{class:{"text-bold":4===e.verified}},[e._v("The item is already present in this kitchen")])]),t("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Clear File",color:"red-6"}})],1)],1)],1)],2)},lt=[],dt=i("5dee"),mt=i("adfa"),ut={name:"AddRemoteOrder",components:{DateTime:dt["a"]},props:["kitchen"],data(){return{color:"light-blue",ti_location:"",ti_id:"",loading:!1,params:{name:null,item:null,quantity:null,deliver:null,narration:null,token_date_code:""},file:null,reference:null,verified:!0}},computed:{...Object(m["b"])("remote",["item_id_of_kitchen_item"]),...Object(m["d"])({items({items:e,remote:t}){return _(t.data).filter({item:"kitchen_items",location:mt["BRANCH_CODE"]}).map((e=>Object.assign({},{kitchen_item_id:e.local_id,kitchen_item_reference:e.reference,kitchen_item_location:e.location,item_id:this.item_id_of_kitchen_item(e.local_id)}))).map((t=>Object.assign({},t,_.get(e.data,t.item_id)))).value()},offline_remotes({remote:e}){return _(e.data).filter((({extra:e})=>_.has(e,"r_ref"))).keyBy("extra.r_ref").value()}}),kitchen_reference(){return _.get(_.find(this.$store.state.remote.data,{item:"kitchens",local_id:this.kitchen}),"reference")},kitchen_item_references(){return _.map(this.items,"kitchen_item_reference")},r_ref(){return _.get(this.reference,"name")},ref_make(){return this.ti_location+"TI"+_.padStart(this.ti_id,6,0)},reference_exists(){return this.reference?_.has(this.offline_remotes,this.reference.name)&&this.offline_remotes[this.reference.name].reference===this.reference.token_item_reference:null},kitchen_remote(){return _.find(this.$store.state.remote.data,{item:"kitchens",local_id:parseInt(this.kitchen)})}},methods:{setReference(e){this.reference=e?JSON.parse(_.get(e,["target","result"])):null,e&&this.verifyReference()},verifyReference(){return this.reference?this.kitchen_reference!==_.get(this.reference,["server",1,"kitchen"])?this.verified=1:this.reference.kitchen_item_location===mt["BRANCH_CODE"]&&this.kitchen_item_references.includes(this.reference.kitchen_item_reference)?this.reference.name?this.reference_exists?this.verified=4:void 0:this.verified=3:this.verified=2:this.verified=0},addOrder(){if(this.reference)this.loading=!0,this.$store.dispatch("remote/addOffline",{offline_reference:this.reference.name,data:this.reference,kitchen:this.kitchen},{root:!0});else{if(!_.every(_.pick(this.params,["name","item","quantity","deliver","token_date_code"])))return this.$q.notify({textColor:"white",message:"All except narration is mandatory, please fill them all..",type:"negative",position:"center",closeBtn:"Try Again"});{let e=[{date:Object(O["E"])("YYYY-MM-DD HH:mm:ss",new Date),narration:this.params.narration,progress:"New"},{quantity:1,narration:this.params.narration,deliver:this.params.deliver,photo:null,progress:"Accepted",kitchen:this.kitchen_remote.reference,item:this.params.item.name,kitchen_item_reference:_.get(this.params,["item","kitchen_item_reference"]),kitchen_item_location:_.get(this.params,["item","kitchen_item_location"]),token:null,detail:this.params.item.detail,status:this.params.item.status}],t={token_source_location:this.ti_location,token_reference:null,token_item_reference:null,token_item_source_id:this.ti_id,name:this.params.name,server:e,token_date:ht(this.params.token_date_code),token_date_code:this.params.token_date_code};this.$store.dispatch("remote/addOffline",{offline_reference:this.params.name,data:t,kitchen:this.kitchen},{root:!0})}}setTimeout((function(e){e.loading=!1,e.$emit("imported")}),1e3,this)}},watch:{file(e){if(!e)return this.setReference(e);let t=new FileReader;t.onload=this.setReference,t.readAsText(e)},ref_make(e){this.params.name=e},ti_location(e){_.toUpper(e)!==e&&(this.ti_location=_.toUpper(e))}}};function ht(e){let t={4:"-",6:"-",8:" ",10:":",12:":"},i=e.split(""),s="";for(let a in i)s+=(_.has(t,a)?t[a]:"")+i[a];return s}var pt=ut,_t=i("27f9"),kt=i("7d53"),gt=i("ddd8"),ft=Object(k["a"])(pt,ct,lt,!1,null,null,null),vt=ft.exports;I()(ft,"components",{QCard:A["a"],QBar:et["a"],QSpace:se["a"],QBtn:b["a"],QCardSection:B["a"],QInput:_t["a"],QFile:kt["a"],QIcon:P["a"],QSelect:gt["a"],QCardActions:ie["a"],QDialog:le["a"]}),I()(ft,"directives",{ClosePopup:ae["a"]});const{SK85W:bt}=i("adfa").FEATURES;var qt={name:"PageTokens",components:{AddRemoteOrder:vt,KitchenTokens:ot},data(){return{offline_order:!1}},computed:{kitchen(){return _.get(this.$store.state.kitchens.data,_.toInteger(this.$store.state.public.kitchen),null)},cloud(){return"Yes"===_.get(this.kitchen,"cloud")&&"Yes"===bt},reset:{get(){return!!_.get(this.$store.state,["public","reset"],!1)},set(e){this.$store.commit("public",{reset:!!e})}}}},yt=qt,wt=i("9989"),xt=i("de5e"),Ct=Object(k["a"])(yt,s,a,!1,null,null,null);t["default"]=Ct.exports;I()(Ct,"components",{QPage:wt["a"],QPageSticky:xt["a"],QBtn:b["a"],QDialog:le["a"]})}}]);