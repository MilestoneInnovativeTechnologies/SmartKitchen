(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[63],{"797e":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("q-page",[t("div",{staticClass:"q-pa-md"},[t("FilterInputText",{attrs:{label:"Filter Orders",lazy:""},on:{text:function(t){e.filter=t}}})],1),t("Masonry",{attrs:{items:e.Tokens,width:e.min_width},scopedSlots:e._u([{key:"item",fn:function(s){return[t("q-list",e._l(s.item,(function(i,a){return t("q-expansion-item",{key:"token-"+i.id,attrs:{group:"token",popup:"","header-class":e.header_class(i)},on:{show:function(t){return e.show(s.identity,a)}},scopedSlots:e._u([{key:"header",fn:function(){return[t("q-item-section",{attrs:{side:"",avatar:""}},[t("q-badge",{staticClass:"q-px-sm q-py-sm",staticStyle:{"font-size":"0.70rem"},attrs:{color:i.balance?"primary":"positive","text-color":"white",label:i.id}})],1),t("q-item-section",[t("q-item-label",{staticStyle:{"font-size":"0.75rem"}},[e._v(e._s(e.lget(i,["customer","name"],"No Customer")))]),i.bill?t("q-item-label",{staticClass:"text-primary text-weight-bold",staticStyle:{"font-size":"0.70rem"},attrs:{caption:""}},[e._v("Items: "+e._s(i.items.length)+", Total: "+e._s(i.bill.payable))]):e._e(),t("q-item-label",{staticStyle:{"font-size":"0.70rem"},attrs:{caption:"",lines:"1"}},[e._v(e._s(e.items_name(i)))]),i.narration?t("q-item-label",{staticClass:"text-red",staticStyle:{"font-size":"0.70rem"},attrs:{caption:""}},[e._v(e._s(i.narration))]):e._e()],1),t("q-item-section",{staticClass:"text-center",attrs:{side:""}},[t("span",{staticStyle:{"font-size":"0.65rem"}},[e._v(e._s(e.token_progress(i))+" "),t("q-spinner-dots",{directives:[{name:"show",rawName:"v-show",value:"Processing"===e.token_progress(i),expression:"token_progress(token) === 'Processing'"}],attrs:{color:"red",size:"xs"}})],1),t("q-rating",{attrs:{value:e.progress_rating[e.token_progress(i)],max:3,size:"xs",color:"green-5",icon:"star",readonly:""}})],1)]},proxy:!0}],null,!0)},[t("q-card",[t("q-list",{attrs:{separator:""}},[t("q-item",{staticStyle:{"font-size":"0.65rem"}},[t("q-item-section",{staticClass:"text-primary"},[t("q-item-label",[e._v("Time: "+e._s(e.time(i.date)))]),t("q-item-label",[e._v("User: "+e._s(e.lget(i,["waiter","name"])))])],1),t("q-item-section",{staticClass:"text-positive"},[t("q-item-label",[e._v("Payable: "+e._s(i.payable))]),t("q-item-label",[e._v("Balance: "+e._s(i.balance))])],1)],1),e._l(i.items,(function(s){return t("q-item",{key:"token-"+i.id+"-item-"+s.id,attrs:{clickable:"Completed"===s.progress},on:{click:function(t){return e.select(i,s)}}},[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",{attrs:{size:"md",color:e.include(i,s)?"positive":""}},[t("q-icon",{attrs:{name:"Served"===s.progress?"done_all":"done",color:"Served"===s.progress?"green-4":"grey-4"}})],1)],1),t("q-item-section",{staticStyle:{"font-size":"0.65rem"}},[t("q-item-label",[e._v(e._s(e.lget(s,["item","name"])))]),t("q-item-label",{staticStyle:{"font-size":"0.65rem"}},[e._v(e._s(e.lget(s,"quantity"))+"x "+e._s(e.lget(s,["price"])))])],1),t("q-item-section",{staticClass:"text-primary text-weight-bold",attrs:{side:""}},[e._v(e._s(e.lget(s,"quantity")*e.lget(s,["price"])))]),t("q-item-section",{attrs:{side:""}},[t("q-badge",{staticStyle:{"font-size":"0.55rem"},attrs:{color:"primary",label:e.lget(s,"progress"),outline:""}})],1)],1)}))],2),i.balance?t("q-card-section",{staticClass:"bg-light-blue-1"},[t("q-card-section",{staticClass:"q-pa-none row items-center justify-end q-col-gutter-xs"},[i.bill&&i.customer?[t("PaymentTypeSelectDropDown",{staticClass:"col",attrs:{outlined:"",dense:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),t("q-input",{staticClass:"col",attrs:{outlined:"",type:"number",label:"Amount",dense:""},model:{value:e.amount,callback:function(t){e.amount=e._n(t)},expression:"amount"}})]:[t("div",{staticClass:"col-7"},[t("OrderCustomer",{attrs:{get:"id",outlined:"",dense:""},model:{value:e.customer,callback:function(t){e.customer=t},expression:"customer"}})],1),t("div",{staticClass:"col-5"},[t("TaxNatureSelectDropDown",{attrs:{label:"Tax",outlined:"",dense:""},model:{value:e.tax,callback:function(t){e.tax=t},expression:"tax"}})],1),t("div",{staticClass:"col-3"},[t("PaymentTypeSelectDropDown",{attrs:{outlined:"",dense:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),t("div",{staticClass:"col-4"},[t("q-input",{attrs:{type:"number",outlined:"",dense:"",label:"Discount"},on:{keyup:e.discount_percent},model:{value:e.discount,callback:function(t){e.discount=e._n(t)},expression:"discount"}})],1),t("div",{staticClass:"col-5"},[t("q-input",{attrs:{type:"number",outlined:"",dense:"",label:"Amount"},model:{value:e.amount,callback:function(t){e.amount=e._n(t)},expression:"amount"}})],1)]],2)],1):e._e(),t("q-card-actions",{staticClass:"q-px-lg"},[e.progress_rating[e.token_progress(i)]<3?t("q-btn",{staticClass:"q-px-md",attrs:{label:"Serve Selected","no-caps":"",color:"primary",disabled:!(e.selected[i.id]&&e.selected[i.id].length)},on:{click:function(t){return e.serve(i)}}}):e._e(),t("q-space"),t("q-btn",{directives:[{name:"show",rawName:"v-show",value:i.balance,expression:"token.balance"}],staticClass:"q-px-md",attrs:{label:"Add Payment",color:"positive",disabled:0===e.amount},on:{click:function(t){return e.pay(i)}}})],1),t("BrowserPrintCardActions",{attrs:{token:i}}),t("q-inner-loading",{attrs:{showing:e.loading}},[t("q-spinner-facebook",{attrs:{color:"positive",size:"2em"}})],1)],1)],1)})),1)]}}])}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.more,expression:"more"}],staticClass:"q-pa-lg flex flex-center absolute-bottom"},[t("q-pagination",{attrs:{color:"primary",min:1,max:Math.ceil(e.AllTokens.length/e.ipp),"max-pages":7,ellipses:!0,"boundary-numbers":!0},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),t("div",{staticClass:"q-mb-xl"},[e._v("Â ")]),t("q-page-sticky",{attrs:{position:"bottom-right",offset:e.offset}},[t("transition",{attrs:{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"}},[e.pl_mode?e._e():t("q-fab",{attrs:{icon:"add","active-icon":"add",color:"primary",glossy:""},on:{click:e.add_order}})],1)],1),e.params.price_list?e._e():t("q-dialog",{attrs:{persistent:""},model:{value:e.pl_mode,callback:function(t){e.pl_mode=t},expression:"pl_mode"}},[t("q-card",{style:e.popup_width()},[t("q-bar",{staticClass:"text-white bg-info q-py-lg items-center"},[t("q-icon",{attrs:{name:"receipt",color:"white",left:""}}),t("span",[e._v("Select Price List")]),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"clear",flat:"",round:"",color:"white"}})],1),t("q-card-section",[t("PriceListSelectDropDown",{attrs:{outlined:"",dense:"","input-debounce":"0",value:e.params.price_list,label:"Select Price List",get:"id",clearable:""},on:{input:e.add_order_new}})],1)],1)],1)],1)},a=[],n=(s("caad"),s("14d9"),s("b1c1")),r=s("9061"),l=s("c624"),o=s("58d1"),c=s("232e"),d=s("2943"),p=s("9afe"),m=s("9708"),u=s("5ab9"),h=s("36d9"),g={name:"PageTakeAway",components:{BrowserPrintCardActions:h["a"],FilterInputText:u["a"],OrderCustomer:m["a"],PaymentTypeSelectDropDown:p["a"],TaxNatureSelectDropDown:d["a"],Masonry:l["a"],PriceListSelectDropDown:r["a"]},mixins:[o["a"]],data(){return{pl_mode:!1,min_width:390,fab:!0,offset:[12,12],filter:"",params:{type:"Take Away",price_list:null,seat:!1,user:null,after:"take_away",payment:!0},progress_rating:{New:0,Processing:1,Completed:2,Served:3,Paid:4},active:[],selected:{},customer:null,tax:null,options:c["PaymentsTypes"],type:c["PaymentsTypes"][0],discount:0,amount:0,loading:!1,page:1}},computed:{ipp(){return this.$store.getters["settings/items_per_page"]},waiter_filter(){let e=_.get(this.$route,["meta","me"]),t=Object(n["B"])(settings("take_away_waiter_own_order"));return!0===t&&"Waiter"===e.role&&e.id},AllTokens(){return _(this.tokens).filter((e=>"Take Away"===e.type&&!_.includes(["Cancelled","Paid"],e.progress))).filter((e=>!this.waiter_filter||e.user===this.waiter_filter)).map((e=>Object.assign({},e,{bill:_.get(this.token_bill,e.id),payable:this.payable(e),balance:this.balance(e),slug:y(e)}))).sortBy("id").reverse().value()},FilteredTokens(){return this.filter?_.filter(this.AllTokens,(e=>_.includes(e.slug,_.toLower(this.filter)))):_.slice(this.AllTokens,(this.page-1)*this.ipp,this.page*this.ipp)},Tokens(){return _.chunk(this.FilteredTokens,_.ceil(_.size(this.FilteredTokens)/(_.floor(this.$q.screen.width/this.min_width)||1)))},Token(){return this.active.length?_.get(this.Tokens,[this.active[0],this.active[1]]):null},more(){return!this.filter&&_.size(this.AllTokens)&&_.size(this.AllTokens)>_.size(this.FilteredTokens)}},methods:{popup_width:n["y"],lget:_.get,time:n["D"],hKey({item:e}){return Object(n["e"])(e)},header_class(e){return _.get(this.Token,"id")===e.id?"bg-grey-4":""},getPriceList(){if(!_.has(this.$store.state.public,"take_away_price_list")){let e=_.get(this.$store.getters["prices/take_away"],"id");e&&this.$store.commit("public",{take_away_price_list:e})}return _.get(this.$store.state.public,"take_away_price_list",void 0)},add_order(){this.params.price_list?this.add_order_new():this.pl_mode=!0},add_order_new(e){e&&(this.params.price_list=e,this.$store.commit("public",{take_away_price_list:e})),this.pl_mode=!1,this.params.price_list&&this.$router.push({name:"order_new",params:this.params})},items_name(e){return _.truncate(_.map(e.items,(({item:e})=>_.truncate(e.name,{length:15,omission:".."}))).join(", "),{length:105})},token_progress({progress:e,items:t}){return"Processing"===e&&b(t)?"Completed":["Completed","Billed","Pending","Partial"].includes(e)?"Served":e},show(e,t){let s=this.Tokens[e][t];this.active=[e,t],_.has(this.selected,s.id)||this.$set(this.selected,s.id,[]),this.selected[s.id]=_(s.items).map((({id:e,progress:t})=>"Completed"===t?e:null)).filter().value(),this.discount=0,this.amount=this.balance(s),this.tax=null,this.type=c["PaymentsTypes"][0],this.customer=_.get(s,["customer","id"])},select({id:e},t){"Completed"===t.progress&&(_.includes(this.selected[e],t.id)?this.selected[e]=_.difference(this.selected[e],[t.id]):this.selected[e].push(t.id))},discount_percent(e){Object(n["n"])(e.keyCode)&&(this.prv_per||_.includes(_.toString(this.discount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.discount=this.discount*this.balance(this.Token)*.01,e.target.blur(),e.target.focus()}))}),250),this.prv_per=Object(n["n"])(e.keyCode)},include({id:e},t){return _.has(this.selected,e)&&_.includes(this.selected[e],t.id)},payable(e){return e.payable?e.payable:_.find(this.bills,(t=>t.token.id===e.id))?_.get(_.find(this.bills,(t=>t.token.id===e.id)),"payable"):_.sumBy(e.items,(({quantity:e,price:t})=>e*t))},balance(e){return e.balance?e.balance:this.payable(e)-(_.find(this.bills,(t=>t.token.id===e.id))?_.get(_.find(this.bills,(t=>t.token.id===e.id)),"paid"):0)},serve(e){this.loading=!0;let t=this.selected[e.id];if(!t.length)return this.loading=!1;setTimeout((function(s){post("token","served",{id:t}).then((()=>{s.loading=!1,s.selected[e.id]=[]}))}),750,this)},pay(e){if(this.loading=!0,0===this.amount)return alert("Enter paying amount.."+((this.loading=!1)||""));let t="payment",s={};e.bill?s={bill:e.bill.id,amount:this.amount,type:this.type}:(t="bill",s={token:e.id,customer:this.customer,discount:this.discount,nature:this.tax,advance_type:this.type,advance_amount:this.amount}),post(t,"create",s).then((()=>this.$store.dispatch("server/ping",null,{root:!0}))).catch().finally((()=>this.loading=!1))}},created(){this.params.user=this.$route.meta.me.id,this.params.price_list=this.getPriceList()},watch:{discount(e){this.amount=this.balance(this.Token)-e}}};function b(e){return _.every(e,(({progress:e})=>["Completed","Served","Cancelled"].includes(e)))}function y(e){let t=e.id,s=_.pick(_.get(e,"customer"),["name","phone"]),i=_.map(_.get(e,"items"),"item.name"),a=_.get(e,["waiter","name"]);return _.toLower(_.join(_.concat(t,i,_.values(s),a)," "))}var v=g,f=s("2877"),k=s("9989"),q=s("1c1c"),w=s("3b73"),x=s("4074"),C=s("58a8"),T=s("0170"),S=s("8380"),P=s("daf4"),Q=s("f09f"),z=s("66e5"),D=s("cb32"),A=s("0016"),$=s("a370"),I=s("27f9"),L=s("4b7e"),B=s("9c40"),O=s("2c91"),j=s("74f7"),F=s("e669"),N=s("3b16"),M=s("de5e"),E=s("c294"),J=s("24e8"),K=s("d847"),R=s("7f67"),U=s("eebe"),W=s.n(U),G=Object(f["a"])(v,i,a,!1,null,null,null);t["default"]=G.exports;W()(G,"components",{QPage:k["a"],QList:q["a"],QExpansionItem:w["a"],QItemSection:x["a"],QBadge:C["a"],QItemLabel:T["a"],QSpinnerDots:S["a"],QRating:P["a"],QCard:Q["a"],QItem:z["a"],QAvatar:D["a"],QIcon:A["a"],QCardSection:$["a"],QInput:I["a"],QCardActions:L["a"],QBtn:B["a"],QSpace:O["a"],QInnerLoading:j["a"],QSpinnerFacebook:F["a"],QPagination:N["a"],QPageSticky:M["a"],QFab:E["a"],QDialog:J["a"],QBar:K["a"]}),W()(G,"directives",{ClosePopup:R["a"]})}}]);