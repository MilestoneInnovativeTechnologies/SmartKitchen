(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[57],{ed22:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[a("q-list",{staticClass:"rounded-borders",attrs:{bordered:""}},[a("q-expansion-item",{attrs:{"expand-separator":"","switch-toggle-side":"",label:"Customer and Order Details",caption:"Manage Customer/Items selected"},model:{value:t.expanded,callback:function(e){t.expanded=e},expression:"expanded"}},[a("q-card",[a("q-card-section",{staticClass:"row q-px-none q-py-none"},[a("q-card-section",{staticClass:"col-xs-12 col-sm-6 q-col-gutter-y-xs q-pt-none"},[a("div",{staticClass:"text-subtitle1"},[t._v("Customer")]),a("OrderCustomer",{attrs:{get:"id",outlined:"",dense:""},model:{value:t.params.customer,callback:function(e){t.$set(t.params,"customer",e)},expression:"params.customer"}}),a("PriceListSelectDropDown",{attrs:{outlined:"",dense:"","input-debounce":"0",label:"Select Price List",get:"id"},model:{value:t.params.price_list,callback:function(e){t.$set(t.params,"price_list",e)},expression:"params.price_list"}}),a("DateTime",{attrs:{outlined:"",dense:"",label:"Delivery Date",value:t.deliver},on:{input:function(e){t.deliver=e}}})],1),a("q-card-section",{directives:[{name:"show",rawName:"v-show",value:t.params.items.length,expression:"params.items.length"}],staticClass:"col-xs-12 col-sm-6 q-col-gutter-y-xs q-pt-none q-px-none"},[a("div",{staticClass:"text-subtitle1 q-ml-md"},[t._v("Items")]),a("q-list",{staticClass:"q-pt-none"},[a("transition-group",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut",mode:"out-in"}},t._l(t.params.items,(function(e,s){return a("q-item",{key:"roi-"+e.item+"-"+s,class:{"bg-grey-2":!(s%2)}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{rounded:""}},[a("img",{attrs:{src:t.image(e)}})])],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.quantity)),a("span",{staticClass:"text-caption q-ml-xs q-mr-sm"},[t._v("x")]),t._v(t._s(t.items[parseInt(e.item)].name))]),a("q-item-label",{attrs:{lines:"1",caption:""}},[t._v("Rate: "+t._s(t.prices[parseInt(e.item)])+", Delivery: "+t._s(e.deliver))]),a("q-item-label",{directives:[{name:"show",rawName:"v-show",value:e.narration,expression:"item.narration"}],attrs:{lines:"2",caption:""}},[t._v(t._s(e.narration))])],1),a("q-item-section",{staticClass:"text-weight-bolder text-body1",attrs:{side:""}},[t._v(t._s(parseFloat(t.prices[parseInt(e.item)]*e.quantity).toFixed(2)))]),a("q-item-section",{attrs:{side:""}},[a("q-btn",{attrs:{round:"",dense:"",flat:"",color:"warning",icon:"edit"},on:{click:function(e){t.edit=s}}}),a("q-btn",{attrs:{icon:"delete",round:"",dense:"",flat:"",color:"red"},on:{click:function(e){return t.remove(s)}}})],1)],1)})),1)],1),a("div",{staticClass:"text-subtitle1 q-ml-md"},[t._v("Advance Payment")]),a("q-card-section",{staticClass:"q-gutter-y-xs q-ml-xl"},[a("q-select",{attrs:{label:"Tax",dense:"",options:t.natures,outlined:""},model:{value:t.params.nature,callback:function(e){t.$set(t.params,"nature",e)},expression:"params.nature"}}),a("q-input",{attrs:{type:"number",dense:"",label:"Discount",outlined:""},on:{keypress:t.discount_percent},model:{value:t.params.discount,callback:function(e){t.$set(t.params,"discount",t._n(e))},expression:"params.discount"}}),a("q-select",{attrs:{dense:"",outlined:"",options:t.payment_types,label:"Payment Type"},model:{value:t.params.advance_type,callback:function(e){t.$set(t.params,"advance_type",e)},expression:"params.advance_type"}}),a("q-input",{attrs:{outlined:"",dense:"",type:"number",label:"Amount"},on:{keypress:t.amount_percent},model:{value:t.params.advance_amount,callback:function(e){t.$set(t.params,"advance_amount",t._n(e))},expression:"params.advance_amount"}}),a("q-card-actions",{staticClass:"q-px-none row"},[a("q-input",{staticClass:"col",attrs:{borderless:"","input-class":"text-weight-bold text-body1 text-primary","label-color":"primary",readonly:"",label:"Order Total",value:t.total}}),a("q-space"),a("q-input",{staticClass:"col",attrs:{borderless:"","input-class":"text-weight-bold text-body1 text-primary","label-color":"primary",readonly:"",label:"Amount Payable",value:t.total-t.params.discount}}),a("q-space"),a("q-btn",{attrs:{label:"Submit",color:"primary",padding:"sm lg",loading:t.loading},on:{click:t.save}})],1)],1)],1)],1)],1)],1),a("q-inner-loading",{attrs:{showing:t.loading}},[a("q-spinner-ios",{attrs:{size:"25%",color:"primary"}})],1)],1),a("Masonry",{attrs:{items:t.remote_items},scopedSlots:t._u([{key:"item",fn:function(e){return[a("ItemSelectCard",{attrs:{id:e.item,price_list:t.params.price_list,remote:!0},on:{selected:t.selected}})]}}])}),a("q-dialog",{attrs:{persistent:"",value:t.edit>-1,"transition-show":"scale","transition-hide":"scale"},on:{hide:function(e){t.edit=-1}}},[t.edit>-1?a("RemoteOrderItemUpdateForm",{staticStyle:{width:"700px","max-width":"90vw"},attrs:{item:t.params.items[t.edit]},on:{close:function(e){t.edit=-1},update:t.update}}):t._e()],1)],1)},i=[],n=(a("13d5"),a("a434"),a("ded3")),r=a.n(n),o=a("2f62"),l=a("c624"),c=a("7a7c"),p=a("9708"),d=a("9061"),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",[a("q-card-section",{staticClass:"row items-center q-py-xs bg-secondary text-white"},[a("div",{staticClass:"text-h6"},[t._v("Update Order Item")]),a("q-space"),a("q-btn",{attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:function(e){return t.$emit("close",null)}}})],1),a("q-card-section",{staticClass:"q-gutter-xs q-pb-none"},[a("q-input",{attrs:{dense:"",outlined:"",type:"number",label:"Quantity"},model:{value:t.quantity,callback:function(e){t.quantity=t._n(e)},expression:"quantity"}}),a("q-input",{staticStyle:{height:"6rem"},attrs:{dense:"",type:"textarea",outlined:"",label:"Narration"},model:{value:t.narration,callback:function(e){t.narration=e},expression:"narration"}}),a("Date",{attrs:{outlined:"",dense:"",label:"Delivery Date",value:t.deliver},on:{input:function(e){t.deliver=e}}}),a("StorageImageUpload",{attrs:{outlined:"",dense:"",label:"Upload image"},on:{uploading:function(e){t.uploading=e}},model:{value:t.photo,callback:function(e){t.photo=e},expression:"photo"}})],1),a("q-card-actions",{staticClass:"q-px-md q-pt-xs",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Update",type:"submit",disable:t.uploading},on:{click:function(e){return e.preventDefault(),t.update(e)}}})],1)],1)},u=[],h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-input",t._b({scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Ok",color:"primary",flat:""},on:{click:function(e){return t.$emit("input",t.date)}}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},"q-input",t.$attrs,!1))},b=[],v=a("b1c1"),g={name:"Date",props:["value"],data(){return{date:null}},created(){this.date=this.value||Object(v["D"])("YYYY-MM-DD",new Date)},watch:{date:{immediate:!0,handler(t){this.$emit("input",t)}}}},y=g,q=a("2877"),f=a("27f9"),x=a("0016"),C=a("7cbe"),k=a("52ee"),w=a("9c40"),I=a("7f67"),Q=a("eebe"),$=a.n(Q),O=Object(q["a"])(y,h,b,!1,null,null,null),D=O.exports;$()(O,"components",{QInput:f["a"],QIcon:x["a"],QPopupProxy:C["a"],QDate:k["a"],QBtn:w["a"]}),$()(O,"directives",{ClosePopup:I["a"]});var S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-file",t._b({attrs:{label:"Browse Image","bottom-slots":"","hide-bottom-space":"",clearable:"",counter:""},scopedSlots:t._u([{key:"append",fn:function(){return[t.uploading?a("div",{staticClass:"text-caption text-warning q-mr-sm",staticStyle:{"font-size":"0.75rem"}},[t._v("uploading..")]):t._e(),t.uploading?a("q-spinner-pie",{attrs:{color:"warning"}}):t._e()]},proxy:!0},{key:"hint",fn:function(){return[t.value?a("q-btn",{attrs:{label:t.storage_name(t.value)+" (click to remove)",outline:"",icon:t.image?"done_all":"highlight_off",color:t.image?"positive":"negative",size:"sm",padding:"xs none",flat:""},on:{click:function(e){return e.preventDefault(),t.remove(e)}}}):t._e()]},proxy:!0},{key:"counter",fn:function(){return[t.progress&&t.uploading?a("div",{staticClass:"text-caption text-secondary",staticStyle:{"font-size":"0.75rem"}},[t._v(t._s(t.progress))]):t._e()]},proxy:!0}]),model:{value:t.image,callback:function(e){t.image=e},expression:"image"}},"q-file",t.$attrs,!1),[a("q-inner-loading",{attrs:{color:"warning",showing:t.deleting}},[a("q-spinner-pie",{attrs:{color:"warning"}})],1)],1)},j=[],P=a("1732"),T=a("de36"),N={name:"StorageImageUpload",props:["value"],data(){return{image:null,uploading:!1,deleting:!1,progress:""}},methods:{storage_name:T["j"],remove(){this.deleting=!0,Object(T["b"])(this.value).then((()=>this.$emit("input",this.deleting=!1,this.image=null)))},name(){return _BRANCH+"/"+Object(P["a"])()},upload(t,e){if(this.uploading=!0,!t)return this.uploading=!1;let a=this;Object(T["l"])(t,e).then((t=>{let s=t();s.then((function(t){a.$emit("input",e),a.uploading=!1})),s.on("state_changed",(function({bytesTransferred:t,totalBytes:e}){a.progress=(t/e*100).toFixed(1)+"%"}))}))}},watch:{image(t){if(t)return this.upload(t,Object(T["j"])(this.value||this.name()))},uploading(t){this.$emit("uploading",t)}}},U=N,F=a("7d53"),B=a("163c"),L=a("74f7"),Y=Object(q["a"])(U,S,j,!1,null,null,null),A=Y.exports;$()(Y,"components",{QFile:F["a"],QSpinnerPie:B["a"],QBtn:w["a"],QInnerLoading:L["a"]});var E={name:"RemoteOrderItemUpdateForm",components:{StorageImageUpload:A,Date:D},props:["item"],data(){return{quantity:1,narration:null,deliver:null,photo:null,uploading:!1}},created(){_.forEach(["quantity","deliver","narration","photo"],(t=>this[t]=_.toNumber(this.item[t])==this.item[t]?_.toNumber(this.item[t]):this.item[t]))},methods:{update(){this.$emit("update",{quantity:_.toNumber(this.quantity),narration:_.toNumber(this.narration)==this.narration?_.toNumber(this.narration):this.narration,deliver:this.deliver||Object(v["F"])(),photo:this.photo||""})}}},M=E,R=a("f09f"),z=a("a370"),J=a("2c91"),H=a("4b7e"),G=Object(q["a"])(M,m,u,!1,null,null,null),K=G.exports;$()(G,"components",{QCard:R["a"],QCardSection:z["a"],QSpace:J["a"],QBtn:w["a"],QInput:f["a"],QCardActions:H["a"]});var V=a("5dee"),W=a("232e"),X={name:"PageRemoteOrdersNew",components:{DateTime:V["a"],RemoteOrderItemUpdateForm:K,PriceListSelectDropDown:d["a"],OrderCustomer:p["a"],ItemSelectCard:c["a"],Masonry:l["a"]},data(){return{expanded:!0,payment_types:W["PaymentsTypes"],loading:!1,deliver:null,params:{type:"Remote",price_list:null,customer:null,items:[],nature:null,discount:0,advance_type:W["PaymentsTypes"][0],advance_amount:0},edit:-1}},computed:r()(r()(r()({},Object(o["b"])({remote_items:"kitchens/remote_items",natures:"tax/natures",price_items:"prices/items"})),Object(o["d"])("items",{items:"data"})),{},{prices(){return _.get(this.price_items,this.params.price_list)},total(){let t=this.prices;return _.reduce(this.params.items,(function(e,{item:a,quantity:s}){return t[parseInt(a)]*parseInt(s)+e}),0)}}),methods:{selected({id:t}){let e=_.findIndex(this.params.items,["item",t]);-1===e||this.params.items[e].narration||this.params.items[e].deliver!==this.deliver?e=this.params.items.push({item:t,quantity:1,narration:null,deliver:this.deliver,photo:null})-1:this.params.items[e].quantity++,this.$q.notify(`${this.params.items.length} x Items <br>${_.sumBy(this.params.items,"quantity")} x Quantities`)},image({item:t}){return Object(v["h"])(this.items[parseInt(t)].image)},update(t){_.forEach(t,((t,e)=>this.params.items[this.edit][e]=t)),this.edit=-1},remove(t){this.params.items[t].photo&&Object(T["b"])(this.params.items[t].photo),setTimeout((function(e){e.params.items.splice(t,1)}),330,this)},save(){if(!this.params.customer)return alert("Choose Customer");this.loading=!0,post("token","create",this.params).then(this.saved)},saved(t){this.loading=!1,this.$nextTick((function(){this.$router.push({name:"orders_remote"})}))},discount_percent(t){Object(v["m"])(t.keyCode)&&(this.prv_per1||_.includes(_.toString(this.params.discount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.params.discount=this.params.discount*this.total*.01,t.target.blur(),t.target.focus()}))}),250),this.prv_per1=Object(v["m"])(t.keyCode)},amount_percent(t){Object(v["m"])(t.keyCode)&&(this.prv_per2||_.includes(_.toString(this.params.advance_amount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.params.advance_amount=this.params.advance_amount*(this.total-this.params.discount)*.01,t.target.blur(),t.target.focus()}))}),250),this.prv_per2=Object(v["m"])(t.keyCode)}},created(){if(this.$q.notify.setDefaults({position:"top-right",timeout:1e3,color:"positive",group:!1,html:!0,caption:"Items Updated !!"}),this.deliver=Object(v["F"])(),!_.has(this.$store.state.public,"remote_price_list")){let t=_.get(settings("price_list",this.params.type),"id",null);t&&this.$store.commit("public",{remote_price_list:t})}this.params.price_list=_.get(this.$store.state.public,"remote_price_list",1)},watch:{"params.price_list":function(t){let e=_.snakeCase(this.params.type+" Price List");this.$store.state.public[e]!==parseInt(t)&&this.$store.commit("public",{[e]:parseInt(t)})}}},Z=X,tt=a("9989"),et=a("1c1c"),at=a("3b73"),st=a("66e5"),it=a("4074"),nt=a("cb32"),rt=a("0170"),ot=a("ddd8"),lt=a("d9b2"),ct=a("24e8"),pt=Object(q["a"])(Z,s,i,!1,null,null,null);e["default"]=pt.exports;$()(pt,"components",{QPage:tt["a"],QList:et["a"],QExpansionItem:at["a"],QCard:R["a"],QCardSection:z["a"],QInput:f["a"],QItem:st["a"],QItemSection:it["a"],QAvatar:nt["a"],QItemLabel:rt["a"],QBtn:w["a"],QSelect:ot["a"],QCardActions:H["a"],QSpace:J["a"],QInnerLoading:L["a"],QSpinnerIos:lt["a"],QDialog:ct["a"]})}}]);