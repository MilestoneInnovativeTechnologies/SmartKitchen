(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[110],{"7be2":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[e.token_text?t("q-card",[t("q-card-section",{staticClass:"bg-blue-grey-6 text-white text-bold flex justify-between items-center"},[e._v("Token Text "),t("q-btn",{attrs:{icon:"close",round:"",dense:"",flat:"",color:"white"},on:{click:function(t){e.token_text=""}}})],1),t("q-card-section",[t("q-input",{attrs:{type:"textarea",outlined:""},model:{value:e.token_text,callback:function(t){e.token_text=t},expression:"token_text"}})],1)],1):e._e(),e.size(e.store_sms)?e._e():t("div",{staticClass:"text-center q-py-xl q-my-xl text-caption text-uppercase"},[e._v("no any templates found"),t("br"),t("q-btn",{attrs:{label:"Add New Template",color:"primary"},on:{click:function(t){e.visible.create_new=!0}}})],1),e._l(e.store_sms,(function(s,a){return t("q-card",{key:a},[t("q-card-section",{staticClass:"flex justify-between items-center bg-primary"},[t("div",{staticClass:"text-white text-bold"},[t("span",{staticClass:"text-h6"},[e._v(e._s(s.name))]),e._l(["what","when","action"],(function(o){return s[o]?t("q-badge",{key:"stv-"+a+o,staticClass:"q-ml-sm",attrs:{label:e.title(s[o]),outline:""}}):e._e()}))],2),t("q-toggle",{staticClass:"text-white",attrs:{label:"Disable","true-value":"1","false-value":"0",color:"white"},on:{input:function(t){return e.update(a,"disable")}},model:{value:e.store_sms[a].disable,callback:function(t){e.$set(e.store_sms[a],"disable",t)},expression:"store_sms[name].disable"}})],1),t("q-card-section",[t("div",{staticClass:"row q-col-gutter-xs q-py-xs items-start"},[t("div",{staticClass:"col-xs-12 col-md-6 q-gutter-y-xs"},[t("q-input",{attrs:{outlined:"",type:"textarea",label:"Condition",autogrow:""},on:{change:function(t){return e.update(a,"condition")}},model:{value:e.store_sms[a].condition,callback:function(t){e.$set(e.store_sms[a],"condition",t)},expression:"store_sms[name].condition"}}),t("q-input",{attrs:{outlined:"",label:"Numbers"},on:{change:function(t){return e.update(a,"to")}},model:{value:e.store_sms[a].to,callback:function(t){e.$set(e.store_sms[a],"to",t)},expression:"store_sms[name].to"}})],1),t("q-input",{staticClass:"col-xs-12 col-md-6",attrs:{outlined:"",type:"textarea",label:"Template"},on:{change:function(t){return e.update(a,"template")}},model:{value:e.store_sms[a].template,callback:function(t){e.$set(e.store_sms[a],"template",t)},expression:"store_sms[name].template"}})],1),e.store_sms[a].advanced?t("div",{staticClass:"q-mt-xs"},[e.custom?t("div",{staticClass:"q-gutter-y-xs"},[t("q-input",{attrs:{outlined:"",label:"URL"},model:{value:e.store_sms[a].url,callback:function(t){e.$set(e.store_sms[a],"url",t)},expression:"store_sms[name].url"}}),t("div",{staticClass:"row q-col-gutter-x-xs"},[t("div",{staticClass:"col"},[t("q-select",{attrs:{outlined:"",label:"Post Method",options:["get","post"]},on:{change:function(t){return e.update(a,"method")}},model:{value:e.store_sms[a].method,callback:function(t){e.$set(e.store_sms[a],"method",t)},expression:"store_sms[name].method"}})],1),t("div",{staticClass:"col"},[t("q-input",{attrs:{outlined:"",label:"Params"},on:{change:function(t){return e.update(a,"params")}},model:{value:e.store_sms[a].params,callback:function(t){e.$set(e.store_sms[a],"params",t)},expression:"store_sms[name].params"}})],1)]),t("div",{staticClass:"flex items-center justify-between q-col-gutter-x-xs"},[t("div",{staticClass:"col"},[t("q-input",{attrs:{outlined:"",label:"To Parameter"},on:{change:function(t){return e.update(a,"param_to")}},model:{value:e.store_sms[a].param_to,callback:function(t){e.$set(e.store_sms[a],"param_to",t)},expression:"store_sms[name].param_to"}})],1),t("div",{staticClass:"col"},[t("q-input",{attrs:{outlined:"",label:"Message Parameter"},on:{change:function(t){return e.update(a,"param_message")}},model:{value:e.store_sms[a].param_message,callback:function(t){e.$set(e.store_sms[a],"param_message",t)},expression:"store_sms[name].param_message"}})],1)])],1):t("div",[t("q-input",{attrs:{outlined:"",label:"Params"},on:{change:function(t){return e.update(a,"params")}},model:{value:e.store_sms[a].params,callback:function(t){e.$set(e.store_sms[a],"params",t)},expression:"store_sms[name].params"}})],1)]):e._e()]),t("q-card-actions",{staticClass:"bg-grey-3"},[t("q-toggle",{attrs:{label:"Advanced Options"},model:{value:e.store_sms[a].advanced,callback:function(t){e.$set(e.store_sms[a],"advanced",t)},expression:"store_sms[name].advanced"}}),t("q-space"),t("q-btn",{attrs:{label:"Delete",color:"negative",padding:"sm lg"},on:{click:function(t){return e.delete_sms(a)}}})],1)],1)})),e.custom?t("q-dialog",{attrs:{persistent:""},model:{value:e.visible.defaults,callback:function(t){e.$set(e.visible,"defaults",t)},expression:"visible.defaults"}},[t("q-card",{style:e.popup_width},[t("q-card-section",{staticClass:"bg-secondary text-white text-bold flex justify-between items-center"},[e._v("SMS Default Settings"),t("q-btn",{attrs:{icon:"close",round:"",dense:"",flat:"",color:"white"},on:{click:function(t){e.visible.defaults=!1}}})],1),t("q-card-section",{staticClass:"q-gutter-y-xs"},[t("q-input",{attrs:{outlined:"",label:"URL"},model:{value:e.defaults["url"],callback:function(t){e.$set(e.defaults,"url",t)},expression:"defaults['url']"}}),t("q-input",{attrs:{outlined:"",label:"Params (route=32&DCS=0&flashsms=0)"},model:{value:e.defaults["params"],callback:function(t){e.$set(e.defaults,"params",t)},expression:"defaults['params']"}}),t("div",{staticClass:"flex items-center justify-between q-col-gutter-x-xs"},[t("div",{staticClass:"col"},[t("q-select",{attrs:{outlined:"",label:"Post Method",options:["get","post"]},model:{value:e.defaults["method"],callback:function(t){e.$set(e.defaults,"method",t)},expression:"defaults['method']"}})],1),t("q-toggle",{attrs:{label:"Disable SMS","true-value":"1","false-value":"0"},model:{value:e.defaults.disable,callback:function(t){e.$set(e.defaults,"disable",t)},expression:"defaults.disable"}})],1),t("div",{staticClass:"flex items-center justify-between q-col-gutter-x-xs"},[t("div",{staticClass:"col"},[t("q-input",{attrs:{outlined:"",label:"To Parameter"},model:{value:e.defaults["param_to"],callback:function(t){e.$set(e.defaults,"param_to",t)},expression:"defaults['param_to']"}})],1),t("div",{staticClass:"col"},[t("q-input",{attrs:{outlined:"",label:"Message Parameter"},model:{value:e.defaults["param_message"],callback:function(t){e.$set(e.defaults,"param_message",t)},expression:"defaults['param_message']"}})],1)])],1),t("q-card-actions",{staticClass:"bg-grey-3",attrs:{align:"right"}},[t("q-btn",{attrs:{label:"Save Default",color:"secondary",loading:e.loading},on:{click:e.SaveDefaults}})],1)],1)],1):e._e(),t("q-dialog",{attrs:{persistent:""},model:{value:e.visible.create_new,callback:function(t){e.$set(e.visible,"create_new",t)},expression:"visible.create_new"}},[t("q-card",{style:e.popup_width(420)},[t("q-card-section",{staticClass:"bg-indigo text-white text-bold flex justify-between items-center"},[e._v("Create New SMS"),t("q-btn",{attrs:{icon:"close",round:"",dense:"",flat:"",color:"white"},on:{click:function(t){e.visible.create_new=!1}}})],1),t("q-card-section",{staticClass:"q-gutter-y-xs"},[t("div",{staticClass:"row q-col-gutter-x-xs q-mb-md"},[t("div",{staticClass:"col"},[t("q-select",{attrs:{outlined:"",options:["Token","Bill","Payment"]},model:{value:e.sms_new.what,callback:function(t){e.$set(e.sms_new,"what",t)},expression:"sms_new.what"}})],1),t("div",{staticClass:"col"},[e.sms_new.what?t("q-select",{attrs:{outlined:"",options:["Created","Updated"]},model:{value:e.sms_new.when,callback:function(t){e.$set(e.sms_new,"when",t)},expression:"sms_new.when"}}):e._e()],1),t("div",{staticClass:"col"},["Token"===e.sms_new.what&&"Updated"===e.sms_new.when?t("q-select",{attrs:{outlined:"",options:["Customer","Progress"]},model:{value:e.sms_new.action,callback:function(t){e.$set(e.sms_new,"action",t)},expression:"sms_new.action"}}):e._e()],1)]),t("q-input",{attrs:{outlined:"",label:"Name"},model:{value:e.sms_new.name,callback:function(t){e.$set(e.sms_new,"name",t)},expression:"sms_new.name"}}),t("q-input",{attrs:{outlined:"",type:"textarea",label:"Condition",autogrow:""},model:{value:e.sms_new.condition,callback:function(t){e.$set(e.sms_new,"condition",t)},expression:"sms_new.condition"}}),t("q-input",{attrs:{outlined:"",label:"Numbers"},model:{value:e.sms_new.to,callback:function(t){e.$set(e.sms_new,"to",t)},expression:"sms_new.to"}}),t("q-input",{attrs:{outlined:"",type:"textarea",label:"Template"},model:{value:e.sms_new.template,callback:function(t){e.$set(e.sms_new,"template",t)},expression:"sms_new.template"}})],1),t("q-card-actions",{staticClass:"bg-grey-3",attrs:{align:"right"}},[t("q-btn",{attrs:{label:"Save",color:"primary",loading:e.loading},on:{click:e.save_new}})],1)],1)],1),t("q-inner-loading",{attrs:{showing:e.loading,size:"xl"}}),t("q-page-sticky",{attrs:{position:"bottom-left",offset:[18,18]}},[t("q-fab",{attrs:{"vertical-actions-align":"left",color:"primary",glossy:"",icon:"keyboard_arrow_right",direction:"right"},model:{value:e.options,callback:function(t){e.options=t},expression:"options"}},[t("q-fab-action",{attrs:{"label-position":"left",color:"primary",label:"Token Text"},on:{click:e.getTokenText}}),e.custom?t("q-fab-action",{attrs:{"label-position":"left",color:"primary",label:"Update Defaults"},on:{click:function(t){e.visible.defaults=!0}}}):e._e(),t("q-fab-action",{attrs:{"label-position":"left",color:"primary",label:"Create New SMS"},on:{click:function(t){e.visible.create_new=!0}}})],1)],1)],2)},o=[],n=(s("14d9"),s("caad"),s("5319"),s("b1c1"));const{GQ85V:i}=s("adfa").FEATURES,l={when:"",what:"",action:"",template:"",disable:"0",condition:"",method:"get",advanced:!1};var r={name:"SMSManage",data(){return{custom:"Yes"===i,sms_props:["to","template","disable","condition","url","method","params","param_to","param_message"],store_sms:{},defaults:{url:"",params:"",method:"get",disable:"0",param_to:"",param_message:""},loading:!1,token_text:"",options:!1,visible:{defaults:!1,create_new:!1},sms_new:{name:"",when:"",what:"",action:"",template:"",condition:"",to:""}}},methods:{title:_.startCase,popup_width:n["y"],size:_.size,SaveDefaults(){this.loading=!0,post("sms","store_defaults",this.defaults).then((()=>this.visible.defaults=!1)).then((()=>this.loading=!1))},update(e,t){let s="_sms_"+e+"_"+t,a={[s]:this.store_sms[e][t]};this.do_update(a)},do_update(e){this.loading=!0,post("sms","update",e).then((()=>this.loading=!1))},getTokenText(){this.loading=!0,post("sms","token_text").then((e=>this.token_text=e)).then((()=>this.loading=!1))},delete_sms(e){this.loading=!0,post("sms","delete",{name:e}).then((e=>this.$delete(this.store_sms,e))).then((()=>setTimeout(this.setStoreSMS,1e3))).then((()=>this.loading=!1))},save_new(){this.loading=!0;let{what:e,when:t,action:s,name:a,template:o,to:n}=this.sms_new;if(!e||!t)return this.error_notify("Trigger is mandatory. Select Token/Bill/Payment and Created/Updated");if("Token"===e&&"Updated"===t&&!s)return this.error_notify("For Token Update trigger, Action is mandatory. Please select Customer/Progress");if(!a)return this.error_notify("Name is mandatory. Please provide and meaning full name for the template!");if(!n)return this.error_notify("Number not provided. To whom the sms to be sent must have provided.");if(!o)return this.error_notify("Template is mandatory. Please set a template for sms to be sent!");const i=[e,t];"Token"===e&&"Updated"===t&&i.push(s);const l=i.join(":").toLowerCase();a=_.snakeCase(a);let r="_sms_"+a,c={name:a,trigger:l,[r]:o};["to","condition"].forEach((e=>c[r+"_"+e]=this.sms_new[e])),post("sms","add_new",c).then((()=>setTimeout(this.setStoreSMS,1e3))).then((()=>this.visible.create_new=!1)).then((()=>this.loading=!1))},error_notify(e){this.$q.notify({type:"negative",message:e,position:"center",actions:[{label:"Close",color:"white"}]}),this.loading=!1},setStoreSMS(){_.forEach(this.$store.getters["settings/settings"],((e,t)=>{if(t.startsWith("_sms_"))if(["_sms_param_to","_sms_param_message"].includes(t)){let s=t.slice(5);this.defaults.hasOwnProperty(s)?this.defaults[s]=e:this.$set(this.defaults,s,e)}else{let s="",a=t.slice(t.lastIndexOf("_")+1);if(this.sms_props.includes(a))t!=="_sms_"+a?(s=t.slice(5).replace("_"+a,""),this.store_sms.hasOwnProperty(s)||this.$set(this.store_sms,s,{name:this.title(s),...l}),this.store_sms[s].hasOwnProperty(s)||this.$set(this.store_sms[s],a,""),this.store_sms[s][a]=e):this.defaults.hasOwnProperty(a)?this.defaults[a]=e:this.$set(this.defaults,a,e);else if(s=t.slice(5),_.includes(s,":")){let t=s.split(":"),a=e.split(",");_.forEach(a,(e=>{this.store_sms.hasOwnProperty(e)||this.$set(this.store_sms,e,{name:this.title(e),...l}),t[0]&&(this.store_sms[e].what=t[0]),t[1]&&(this.store_sms[e].when=t[1]),t[2]&&(this.store_sms[e].action=t[2])}))}else this.sms_props.includes(s)?this.defaults.hasOwnProperty(s)?this.defaults[s]=e:this.$set(this.defaults,s,e):(this.store_sms.hasOwnProperty(s)||this.$set(this.store_sms,s,{name:this.title(s),...l}),this.store_sms[s].template=e)}}))}},created(){this.setStoreSMS()}},c=r,d=s("2877"),m=s("9989"),u=s("f09f"),p=s("a370"),h=s("9c40"),f=s("27f9"),b=s("58a8"),g=s("9564"),w=s("ddd8"),v=s("4b7e"),x=s("2c91"),q=s("24e8"),k=s("74f7"),y=s("de5e"),C=s("c294"),$=s("72db"),S=s("eebe"),T=s.n(S),P=Object(d["a"])(c,a,o,!1,null,null,null);t["default"]=P.exports;T()(P,"components",{QPage:m["a"],QCard:u["a"],QCardSection:p["a"],QBtn:h["a"],QInput:f["a"],QBadge:b["a"],QToggle:g["a"],QSelect:w["a"],QCardActions:v["a"],QSpace:x["a"],QDialog:q["a"],QInnerLoading:k["a"],QPageSticky:y["a"],QFab:C["a"],QFabAction:$["a"]})}}]);