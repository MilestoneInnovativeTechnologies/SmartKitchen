(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{ef79:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{attrs:{padding:""}},[i("q-list",[i("q-item-label",{staticClass:"text-h6",attrs:{header:""}},[e._v("Own")]),e.own.length?e._e():i("q-item-label",{staticClass:"q-pl-lg",attrs:{caption:""}},[e._v("No Own Tokens")]),e._l(e.own,(function(t){return i("TokenDetailDeliveryBoyExpansion",{key:"dbc-own-"+t.id,attrs:{token:t,group:"own",color:"positive",popup:"",label:t.customer.name,caption:e.time(t.date)},on:{deliver:function(i){return e.deliver(t)},bill:function(i){return e.bill(t)}}})})),i("q-item-label",{staticClass:"text-h6",attrs:{header:""}},[e._v("Orphan")]),e.orphan.length?e._e():i("q-item-label",{staticClass:"q-pl-lg",attrs:{caption:""}},[e._v("No Orphan Tokens")]),e._l(e.orphan,(function(t){return i("TokenDetailDeliveryBoyExpansion",{key:"dbc-own-"+t.id,attrs:{token:t,group:"orphan",color:"accent",popup:"",label:t.customer.name,caption:e.pa(t)},on:{deliver:function(i){return e.deliver(t)},bill:function(i){return e.bill(t)}}})})),i("q-item-label",{staticClass:"text-h6",attrs:{header:""}},[e._v("Other")]),e.other.length?e._e():i("q-item-label",{staticClass:"q-pl-lg",attrs:{caption:""}},[e._v("No Others Tokens")]),e._l(e.other,(function(t){return i("TokenDetailDeliveryBoyExpansion",{key:"dbc-own-"+t.id,attrs:{token:t,group:"other",color:"secondary",popup:"",label:e.np(t),caption:e.wa(t)},on:{deliver:function(i){return e.deliver(t)},bill:function(i){return e.bill(t)}}})}))],2),i("q-dialog",{attrs:{persistent:""},on:{"before-hide":function(t){e.bill_mode=!1}},model:{value:e.bill_mode,callback:function(t){e.bill_mode=t},expression:"bill_mode"}},[e.selected?i("BillGenerateCard",{style:e.popup_width(),attrs:{token:e.selected},on:{generated:function(t){e.bill_mode=!1}}}):e._e()],1),i("q-dialog",{attrs:{persistent:""},on:{"before-hide":function(t){e.deliver_mode=!1}},model:{value:e.deliver_mode,callback:function(t){e.deliver_mode=t},expression:"deliver_mode"}},[e.selected?i("DeliveryBoyPaymentCard",{style:e.popup_width(),attrs:{token:e.selected},on:{paid:function(t){e.deliver_mode=!1}}}):e._e()],1),i("OrderNewFabDeliveryBoy")],1)},n=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-expansion-item",e._b({scopedSlots:e._u([{key:"header",fn:function(){return[i("q-item-section",{attrs:{avatar:"",top:""}},[i("q-avatar",{attrs:{rounded:""}},[i("q-img",{attrs:{src:e.image(e.token.customer.image)}})],1)],1),i("q-item-section",[i("q-item-label",{class:"text-"+e.clr},[e._v(e._s(e.token.id)+", "+e._s(e.label))]),i("q-item-label",{attrs:{caption:""},domProps:{innerHTML:e._s(e.caption)}}),e.Bill?i("q-item-label",{staticClass:"text-red",attrs:{caption:""}},[i("q-icon",{attrs:{name:"done_all",size:"sm"}}),e._v(" Billed")],1):e._e()],1),i("q-item-section",{attrs:{side:""}},[i("q-badge",{staticClass:"q-py-xs q-px-sm",attrs:{outline:"",color:e.clr,label:e.precision(e.total)}})],1)]},proxy:!0}])},"q-expansion-item",e.$attrs,!1),[i("q-card",[i("q-card-section",[i("q-card-section",{staticClass:"q-pa-none row items-center justify-between q-col-gutter-xs"},[i("q-badge",{staticClass:"q-pa-sm",attrs:{label:e.token.date_human,outline:"","text-color":e.clr}}),i("q-badge",{staticClass:"q-pa-sm",attrs:{label:e.items.length+" Items",outline:"","text-color":e.clr}}),i("q-badge",{staticClass:"q-pa-sm",attrs:{label:e.quantities+" Quantities",outline:"","text-color":e.clr}})],1),e.token.narration?i("div",{staticClass:"q-py-sm",class:"text-"+e.clr,domProps:{textContent:e._s(e.token.narration)}}):e._e()],1),i("q-list",{attrs:{bordered:"",separator:""}},e._l(e.items,(function(t){return i("q-item",{key:"dbe-t"+e.token.id+"-ti-"+t.id+"-i-"+t.item.id},[i("q-item-section",{attrs:{avatar:""}},[i("q-avatar",{attrs:{rounded:""}},[i("q-img",{attrs:{src:e.image(t.item.image)}})],1)],1),i("q-item-section",[i("q-item-label",{staticClass:"text-bold",class:"text-"+e.clr},[e._v(e._s(t.quantity)+"x "+e._s(t.item.name))]),t.narration?i("q-item-label",{staticClass:"text-red",attrs:{caption:""}},[e._v(e._s(t.narration))]):e._e(),i("q-item-label",{attrs:{caption:""}},[e._v("Rate: "+e._s(e.precision(t.price)))]),t.kitchen?i("q-item-label",{attrs:{caption:""}},[e._v("Kitchen: "+e._s(t.kitchen.name))]):e._e()],1),i("q-item-section",{staticClass:"text-bold",class:"text-"+e.clr,attrs:{side:""}},[e._v(e._s(e.precision(t.price*t.quantity)))])],1)})),1),e.token.customer.id?i("q-card-section",{staticClass:"q-gutter-y-xs bg-grey-1"},[i("q-input",{attrs:{label:"Customer Phone",value:e.token.customer.phone,outlined:"",dense:"",color:e.clr}}),i("q-input",{attrs:{label:"Customer Address",type:"textarea",value:e.token.customer.address,readonly:"",outlined:"",dense:"",autogrow:""}})],1):e._e(),i("q-card-actions",{staticClass:"row items-center justify-between q-px-md"},[e.Bill?i("div",[i("q-btn",{attrs:{flat:"",padding:"none",color:"positive",icon:"done_all",label:"Billed: "+e.Bill.payable}}),i("div",{staticClass:"q-pl-sm q-ml-lg",staticStyle:{"line-height":"0.75rem"}},[e._v(e._s(e.Bill.user.name))])],1):i("q-btn",{attrs:{label:"Generate Bill",color:"red",padding:"xs md"},on:{click:function(t){return e.$emit("bill")}}}),e.Bill?i("q-btn",{attrs:{label:"Delivered",color:"positive",padding:"xs md"},on:{click:function(t){return e.$emit("deliver")}}}):e._e()],1)],1)],1)},s=[],l=i("b1c1"),o=i("58d1"),c={name:"TokenDetailDeliveryBoyExpansion",props:["label","caption","token","color"],mixins:[o["a"]],computed:{clr(){return this.color||"primary"},items(){return _.get(this.token,"items")},quantities(){return _.sumBy(this.items,(({quantity:e})=>_.toNumber(e)))},total(){return _.sumBy(this.items,(({quantity:e,price:t})=>_.toNumber(e)*_.toNumber(t)))},Bill(){return _.find(this.bills,(e=>parseInt(_.get(e,["token","id"]))===parseInt(this.token.id)))}},methods:{precision:l["y"],image:l["h"]}},d=c,u=i("2877"),m=i("3b73"),p=i("4074"),b=i("cb32"),h=i("068f"),q=i("0170"),v=i("0016"),y=i("58a8"),g=i("f09f"),f=i("a370"),k=i("1c1c"),x=i("66e5"),C=i("27f9"),w=i("4b7e"),B=i("9c40"),D=i("eebe"),Q=i.n(D),I=Object(u["a"])(d,r,s,!1,null,null,null),T=I.exports;Q()(I,"components",{QExpansionItem:m["a"],QItemSection:p["a"],QAvatar:b["a"],QImg:h["a"],QItemLabel:q["a"],QIcon:v["a"],QBadge:y["a"],QCard:g["a"],QCardSection:f["a"],QList:k["a"],QItem:x["a"],QInput:C["a"],QCardActions:w["a"],QBtn:B["a"]});var O=i("bf22"),N=i("1cd8"),j=i("232e"),E=i("9416"),P={name:"DeliveryBoyCompleted",components:{OrderNewFabDeliveryBoy:E["a"],DeliveryBoyPaymentCard:N["a"],BillGenerateCard:O["a"],TokenDetailDeliveryBoyExpansion:T},mixins:[o["a"]],data(){return{me:parseInt(this.$route.meta.me.id),bill_mode:!1,deliver_mode:!1,selected:null}},computed:{hide_others(){return!0===Object(l["A"])(settings("delivery_boy_hide_others_billed"))},hide_tokens(){return this.hide_others?_(this.bills).filter((e=>["Pending","Partial"].includes(e.progress))).filter((e=>L(e,this.me))).map((e=>_.toInteger(e.token.id))).value():[]},Tokens(){return _(this.tokens).filter(["type","Home Delivery"]).filter($).map((e=>e.customer?e:Object.assign({},e,{customer:j["NoCustomer"]}))).filter((e=>!this.hide_others||!_.includes(this.hide_tokens,e.id))).value()},own(){return _.filter(this.Tokens,["user",this.me])},orphan(){return _.filter(this.Tokens,(({user:e})=>_.isNull(e)))},other(){return _.filter(this.Tokens,(({user:e})=>!_.isNull(e)&&e!==this.me))}},methods:{time:l["C"],popup_width:l["x"],np({customer:e}){return[e.name,e.phone].join(", ")},pa({customer:e}){return[e.phone,e.address].join("<br />")},wa({waiter:e,customer:t}){return[t.address,"(User: "+e.name+")"].join("<br />")},bill({id:e}){this.selected=e,this.bill_mode=!0},deliver({id:e}){this.selected=e,this.deliver_mode=!0}}};function $({items:e}){return e.length&&_.every(e,(({progress:e})=>_.includes(["Cancelled","Completed"],e)))}function L({user:e},t){return e&&"Delivery Boy"===e.role&&e.id!==t}var A=P,S=i("9989"),G=i("24e8"),F=Object(u["a"])(A,a,n,!1,null,null,null);t["default"]=F.exports;Q()(F,"components",{QPage:S["a"],QList:k["a"],QItemLabel:q["a"],QDialog:G["a"]})}}]);