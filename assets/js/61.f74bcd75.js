(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[61],{ed22:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("q-page",{staticClass:"q-gutter-y-sm",attrs:{padding:""}},[e("q-list",{staticClass:"rounded-borders",attrs:{bordered:""}},[e("q-expansion-item",{attrs:{"expand-separator":"","switch-toggle-side":"",label:"Customer and Order Details",caption:"Manage Customer/Items selected"},model:{value:t.expanded,callback:function(e){t.expanded=e},expression:"expanded"}},[e("q-card",[e("q-card-section",{staticClass:"row q-px-none q-py-none"},[e("q-card-section",{staticClass:"col-xs-12 col-sm-6 q-col-gutter-y-xs q-pt-none"},[e("div",{staticClass:"text-subtitle1"},[t._v("Customer")]),e("OrderCustomer",{attrs:{get:"id",outlined:"",dense:""},model:{value:t.params.customer,callback:function(e){t.$set(t.params,"customer",e)},expression:"params.customer"}}),e("PriceListSelectDropDown",{attrs:{outlined:"",dense:"","input-debounce":"0",label:"Select Price List",get:"id"},model:{value:t.params.price_list,callback:function(e){t.$set(t.params,"price_list",e)},expression:"params.price_list"}}),e("DateTime",{attrs:{outlined:"",dense:"",label:"Delivery Date",value:t.deliver},on:{input:function(e){t.deliver=e}}})],1),e("q-card-section",{directives:[{name:"show",rawName:"v-show",value:t.params.items.length,expression:"params.items.length"}],staticClass:"col-xs-12 col-sm-6 q-col-gutter-y-xs q-pt-none q-px-none"},[e("div",{staticClass:"text-subtitle1 q-ml-md"},[t._v("Items")]),e("q-list",{staticClass:"q-pt-none"},[e("transition-group",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut",mode:"out-in"}},t._l(t.params.items,(function(a,s){return e("q-item",{key:"roi-"+a.item+"-"+s,class:{"bg-grey-2":!(s%2)}},[e("q-item-section",{attrs:{avatar:""}},[e("q-avatar",{attrs:{rounded:""}},[e("img",{attrs:{src:t.image(a)}})])],1),e("q-item-section",[e("q-item-label",[t._v(t._s(a.quantity)),e("span",{staticClass:"text-caption q-ml-xs q-mr-sm"},[t._v("x")]),t._v(t._s(t.items[parseInt(a.item)].name))]),e("q-item-label",{attrs:{lines:"1",caption:""}},[t._v("Rate: "+t._s(t.prices[parseInt(a.item)])+", Delivery: "+t._s(a.deliver))]),e("q-item-label",{directives:[{name:"show",rawName:"v-show",value:a.narration,expression:"item.narration"}],attrs:{lines:"2",caption:""}},[t._v(t._s(a.narration))])],1),e("q-item-section",{staticClass:"text-weight-bolder text-body1",attrs:{side:""}},[t._v(t._s(parseFloat(t.prices[parseInt(a.item)]*a.quantity).toFixed(2)))]),e("q-item-section",{attrs:{side:""}},[e("q-btn",{attrs:{round:"",dense:"",flat:"",color:"warning",icon:"edit"},on:{click:function(e){t.edit=s}}}),e("q-btn",{attrs:{icon:"delete",round:"",dense:"",flat:"",color:"red"},on:{click:function(e){return t.remove(s)}}})],1)],1)})),1)],1),e("div",{staticClass:"text-subtitle1 q-ml-md"},[t._v("Advance Payment")]),e("q-card-section",{staticClass:"q-gutter-y-xs q-ml-xl"},[e("q-select",{attrs:{label:"Tax",dense:"",options:t.natures,outlined:""},model:{value:t.params.nature,callback:function(e){t.$set(t.params,"nature",e)},expression:"params.nature"}}),e("q-input",{attrs:{type:"number",dense:"",label:"Discount",outlined:""},on:{keypress:t.discount_percent},model:{value:t.params.discount,callback:function(e){t.$set(t.params,"discount",t._n(e))},expression:"params.discount"}}),e("q-select",{attrs:{dense:"",outlined:"",options:t.payment_types,label:"Payment Type"},model:{value:t.params.advance_type,callback:function(e){t.$set(t.params,"advance_type",e)},expression:"params.advance_type"}}),e("q-input",{attrs:{outlined:"",dense:"",type:"number",label:"Amount"},on:{keypress:t.amount_percent},model:{value:t.params.advance_amount,callback:function(e){t.$set(t.params,"advance_amount",t._n(e))},expression:"params.advance_amount"}}),e("q-card-actions",{staticClass:"q-px-none row"},[e("q-input",{staticClass:"col",attrs:{borderless:"","input-class":"text-weight-bold text-body1 text-primary","label-color":"primary",readonly:"",label:"Order Total",value:t.total}}),e("q-space"),e("q-input",{staticClass:"col",attrs:{borderless:"","input-class":"text-weight-bold text-body1 text-primary","label-color":"primary",readonly:"",label:"Amount Payable",value:t.total-t.params.discount}}),e("q-space"),e("q-btn",{attrs:{label:"Submit",color:"primary",padding:"sm lg",disable:t.loading,loading:t.loading},on:{click:t.save}})],1)],1)],1)],1)],1)],1),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-ios",{attrs:{size:"25%",color:"primary"}})],1)],1),e("Masonry",{attrs:{items:t.remote_items},scopedSlots:t._u([{key:"item",fn:function(a){return[e("ItemSelectCard",{attrs:{id:a.item,price_list:t.params.price_list,remote:!0},on:{selected:t.selected}})]}}])}),e("q-dialog",{attrs:{persistent:"",value:t.edit>-1,"transition-show":"scale","transition-hide":"scale"},on:{hide:function(e){t.edit=-1}}},[t.edit>-1?e("RemoteOrderItemUpdateForm",{staticStyle:{width:"700px","max-width":"90vw"},attrs:{item:t.params.items[t.edit]},on:{close:function(e){t.edit=-1},update:t.update}}):t._e()],1)],1)},i=[],n=(a("14d9"),a("caad"),a("2f62")),r=a("c624"),o=a("7a7c"),l=a("9708"),c=a("9061"),p=function(){var t=this,e=t._self._c;return e("q-card",[e("q-card-section",{staticClass:"row items-center q-py-xs bg-secondary text-white"},[e("div",{staticClass:"text-h6"},[t._v("Update Order Item")]),e("q-space"),e("q-btn",{attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:function(e){return t.$emit("close",null)}}})],1),e("q-card-section",{staticClass:"q-gutter-xs q-pb-none"},[e("q-input",{attrs:{dense:"",outlined:"",type:"number",label:"Quantity"},model:{value:t.quantity,callback:function(e){t.quantity=t._n(e)},expression:"quantity"}}),e("q-input",{staticStyle:{height:"6rem"},attrs:{dense:"",type:"textarea",outlined:"",label:"Narration"},model:{value:t.narration,callback:function(e){t.narration=e},expression:"narration"}}),e("Date",{attrs:{outlined:"",dense:"",label:"Delivery Date",value:t.deliver},on:{input:function(e){t.deliver=e}}}),e("StorageImageUpload",{attrs:{outlined:"",dense:"",label:"Upload image"},on:{uploading:function(e){t.uploading=e}},model:{value:t.photo,callback:function(e){t.photo=e},expression:"photo"}})],1),e("q-card-actions",{staticClass:"q-px-md q-pt-xs",attrs:{align:"right"}},[e("q-btn",{attrs:{color:"primary",label:"Update",type:"submit",disable:t.uploading},on:{click:function(e){return e.preventDefault(),t.update.apply(null,arguments)}}})],1)],1)},d=[],u=function(){var t=this,e=t._self._c;return e("q-input",t._b({scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[e("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},[e("div",{staticClass:"row items-center justify-end"},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Ok",color:"primary",flat:""},on:{click:function(e){return t.$emit("input",t.date)}}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},"q-input",t.$attrs,!1))},m=[],h=a("b1c1"),b={name:"Date",props:["value"],data(){return{date:null}},created(){this.date=this.value||Object(h["E"])("YYYY-MM-DD",new Date)},watch:{date:{immediate:!0,handler(t){this.$emit("input",t)}}}},v=b,g=a("2877"),y=a("27f9"),q=a("0016"),f=a("7cbe"),x=a("52ee"),C=a("9c40"),k=a("7f67"),w=a("eebe"),I=a.n(w),Q=Object(g["a"])(v,u,m,!1,null,null,null),O=Q.exports;I()(Q,"components",{QInput:y["a"],QIcon:q["a"],QPopupProxy:f["a"],QDate:x["a"],QBtn:C["a"]}),I()(Q,"directives",{ClosePopup:k["a"]});var $=function(){var t=this,e=t._self._c;return e("q-file",t._b({attrs:{label:"Browse Image","bottom-slots":"","hide-bottom-space":"",clearable:"",counter:""},scopedSlots:t._u([{key:"append",fn:function(){return[t.uploading?e("div",{staticClass:"text-caption text-warning q-mr-sm",staticStyle:{"font-size":"0.75rem"}},[t._v("uploading..")]):t._e(),t.uploading?e("q-spinner-pie",{attrs:{color:"warning"}}):t._e()]},proxy:!0},{key:"hint",fn:function(){return[t.value?e("q-btn",{attrs:{label:t.storage_name(t.value)+" (click to remove)",outline:"",icon:t.image?"done_all":"highlight_off",color:t.image?"positive":"negative",size:"sm",padding:"xs none",flat:""},on:{click:function(e){return e.preventDefault(),t.remove.apply(null,arguments)}}}):t._e()]},proxy:!0},{key:"counter",fn:function(){return[t.progress&&t.uploading?e("div",{staticClass:"text-caption text-secondary",staticStyle:{"font-size":"0.75rem"}},[t._v(t._s(t.progress))]):t._e()]},proxy:!0}]),model:{value:t.image,callback:function(e){t.image=e},expression:"image"}},"q-file",t.$attrs,!1),[e("q-inner-loading",{attrs:{color:"warning",showing:t.deleting}},[e("q-spinner-pie",{attrs:{color:"warning"}})],1)],1)},D=[],S=a("1732"),j=a("de36"),P=a("adfa"),T={name:"StorageImageUpload",props:["value"],data(){return{image:null,uploading:!1,deleting:!1,progress:""}},methods:{storage_name:j["i"],remove(){this.deleting=!0,Object(j["b"])(this.value).then((()=>this.$emit("input",this.deleting=!1,this.image=null)))},name(){return P["BRANCH_CODE"]+"/"+Object(S["a"])()},upload(t,e){if(this.uploading=!0,!t)return this.uploading=!1;let a=this;Object(j["k"])(t,e).then((t=>{let s=t();s.then((function(t){a.$emit("input",e),a.uploading=!1})),s.on("state_changed",(function({bytesTransferred:t,totalBytes:e}){a.progress=(t/e*100).toFixed(1)+"%"}))}))}},watch:{image(t){if(t)return this.upload(t,Object(j["i"])(this.value||this.name()))},uploading(t){this.$emit("uploading",t)}}},N=T,U=a("7d53"),B=a("163c"),A=a("74f7"),L=Object(g["a"])(N,$,D,!1,null,null,null),R=L.exports;I()(L,"components",{QFile:U["a"],QSpinnerPie:B["a"],QBtn:C["a"],QInnerLoading:A["a"]});var Y={name:"RemoteOrderItemUpdateForm",components:{StorageImageUpload:R,Date:O},props:["item"],data(){return{quantity:1,narration:null,deliver:null,photo:null,uploading:!1}},created(){_.forEach(["quantity","deliver","narration","photo"],(t=>this[t]=_.toNumber(this.item[t])==this.item[t]?_.toNumber(this.item[t]):this.item[t]))},methods:{update(){this.$emit("update",{quantity:_.toNumber(this.quantity),narration:_.toNumber(this.narration)==this.narration?_.toNumber(this.narration):this.narration,deliver:this.deliver||Object(h["G"])(),photo:this.photo||""})}}},E=Y,F=a("f09f"),M=a("a370"),z=a("2c91"),G=a("4b7e"),H=Object(g["a"])(E,p,d,!1,null,null,null),J=H.exports;I()(H,"components",{QCard:F["a"],QCardSection:M["a"],QSpace:z["a"],QBtn:C["a"],QInput:y["a"],QCardActions:G["a"]});var K=a("5dee"),V=a("232e"),W={name:"PageRemoteOrdersNew",components:{DateTime:K["a"],RemoteOrderItemUpdateForm:J,PriceListSelectDropDown:c["a"],OrderCustomer:l["a"],ItemSelectCard:o["a"],Masonry:r["a"]},data(){return{expanded:!0,payment_types:V["PaymentsTypes"],loading:!1,deliver:null,params:{type:"Remote",price_list:null,customer:null,items:[],nature:null,discount:0,advance_type:V["PaymentsTypes"][0],advance_amount:0,_location:P["BRANCH_CODE"]},edit:-1}},computed:{...Object(n["b"])({remote_items:"kitchens/cloud_items",natures:"tax/natures",price_items:"prices/items"}),...Object(n["d"])("items",{items:"data"}),prices(){return _.get(this.price_items,this.params.price_list)},total(){let t=this.prices;return _.reduce(this.params.items,(function(e,{item:a,quantity:s}){return t[parseInt(a)]*parseInt(s)+e}),0)}},methods:{selected({id:t}){let e=_.findIndex(this.params.items,["item",t]);-1===e||this.params.items[e].narration||this.params.items[e].deliver!==this.deliver?e=this.params.items.push({item:t,quantity:1,narration:null,deliver:this.deliver,photo:null})-1:this.params.items[e].quantity++,this.$q.notify(`${this.params.items.length} x Items <br>${_.sumBy(this.params.items,"quantity")} x Quantities`)},image({item:t}){return Object(h["i"])(this.items[parseInt(t)].image)},update(t){_.forEach(t,((t,e)=>this.params.items[this.edit][e]=t)),this.edit=-1},remove(t){this.params.items[t].photo&&Object(j["b"])(this.params.items[t].photo),setTimeout((function(e){e.params.items.splice(t,1)}),330,this)},save(){if(!this.params.customer)return alert("Choose Customer");this.loading=!0,post("token","create",this.params).then(this.saved)},saved(){this.loading=!1,this.$nextTick((function(){this.$router.push({name:"orders_remote"})}))},discount_percent(t){Object(h["n"])(t.keyCode)&&(this.prv_per1||_.includes(_.toString(this.params.discount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.params.discount=this.params.discount*this.total*.01,t.target.blur(),t.target.focus()}))}),250),this.prv_per1=Object(h["n"])(t.keyCode)},amount_percent(t){Object(h["n"])(t.keyCode)&&(this.prv_per2||_.includes(_.toString(this.params.advance_amount),"."))&&setTimeout((()=>{this.$nextTick((()=>{this.params.advance_amount=this.params.advance_amount*(this.total-this.params.discount)*.01,t.target.blur(),t.target.focus()}))}),250),this.prv_per2=Object(h["n"])(t.keyCode)}},created(){if(this.$q.notify.setDefaults({position:"top-right",timeout:1e3,color:"positive",group:!1,html:!0,caption:"Items Updated !!"}),this.deliver=Object(h["G"])(),!_.has(this.$store.state.public,"remote_price_list")){let t=_.get(this.$store.getters["prices/remote"],"id",null);t&&this.$store.commit("public",{remote_price_list:t})}this.params.price_list=_.get(this.$store.state.public,"remote_price_list",1)},watch:{"params.price_list":function(t){let e=_.snakeCase(this.params.type+" Price List");this.$store.state.public[e]!==parseInt(t)&&this.$store.commit("public",{[e]:parseInt(t)})},deliver(t){t&&_.forEach(this.params.items,((e,a)=>this.$set(this.params.items[a],"deliver",t)))}}},X=W,Z=a("9989"),tt=a("1c1c"),et=a("3b73"),at=a("66e5"),st=a("4074"),it=a("cb32"),nt=a("0170"),rt=a("ddd8"),ot=a("d9b2"),lt=a("24e8"),ct=Object(g["a"])(X,s,i,!1,null,null,null);e["default"]=ct.exports;I()(ct,"components",{QPage:Z["a"],QList:tt["a"],QExpansionItem:et["a"],QCard:F["a"],QCardSection:M["a"],QInput:y["a"],QItem:at["a"],QItemSection:st["a"],QAvatar:it["a"],QItemLabel:nt["a"],QBtn:C["a"],QSelect:rt["a"],QCardActions:G["a"],QSpace:z["a"],QInnerLoading:A["a"],QSpinnerIos:ot["a"],QDialog:lt["a"]})}}]);